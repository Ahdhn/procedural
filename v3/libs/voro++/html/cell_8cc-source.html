<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Voro++: cell.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>cell.cc</h1><a href="cell_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Voro++, a 3D cell-based Voronoi library</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// Author   : Chris H. Rycroft (LBL / UC Berkeley)</span>
<a name="l00004"></a>00004 <span class="comment">// Email    : chr@alum.mit.edu</span>
<a name="l00005"></a>00005 <span class="comment">// Date     : July 1st 2008</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">/** \file cell.cc</span>
<a name="l00008"></a>00008 <span class="comment"> * \brief Function implementations for the voronoicell_base template and</span>
<a name="l00009"></a>00009 <span class="comment"> * related classes. */</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="cell_8hh.html" title="Header file for the voronoicell_base template and related classes.">cell.hh</a>"</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">/** Constructs a Voronoi cell and sets up the initial memory. */</span>
<a name="l00014"></a>00014 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00015"></a><a class="code" href="classvoronoicell__base.html#f75ecf89b61663d683bdcddac37e72d7">00015</a> <a class="code" href="classvoronoicell__base.html#f75ecf89b61663d683bdcddac37e72d7">voronoicell_base&lt;n_option&gt;::voronoicell_base</a>() :
<a name="l00016"></a>00016         current_vertices(<a class="code" href="config_8hh.html#92b404782cc95077368cb853b2452e4d">init_vertices</a>), current_vertex_order(<a class="code" href="config_8hh.html#5cfedf143c02c4ab8b2ef06c73a91bfc">init_vertex_order</a>),
<a name="l00017"></a>00017         current_delete_size(<a class="code" href="config_8hh.html#f592ab3d4dac31e4fdb6e9ceb44daf0c">init_delete_size</a>), current_delete2_size(<a class="code" href="config_8hh.html#9e94777d94073c74dd568bd36953f61f">init_delete2_size</a>),
<a name="l00018"></a>00018         neighbor(this) {
<a name="l00019"></a>00019         <span class="keywordtype">int</span> i;
<a name="l00020"></a>00020         ds=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classvoronoicell__base.html#ba57ebcf710b899119e3e6808bf9ffd3">current_delete_size</a>];
<a name="l00021"></a>00021         ds2=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classvoronoicell__base.html#c24fdead81ae8e351c42a950aba416f7">current_delete2_size</a>];
<a name="l00022"></a>00022         mem=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classvoronoicell__base.html#2ed244530d520c44b15e1fda58c851e5">current_vertex_order</a>];
<a name="l00023"></a>00023         mec=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classvoronoicell__base.html#2ed244530d520c44b15e1fda58c851e5">current_vertex_order</a>];
<a name="l00024"></a>00024         mep=<span class="keyword">new</span> <span class="keywordtype">int</span>*[<a class="code" href="classvoronoicell__base.html#2ed244530d520c44b15e1fda58c851e5">current_vertex_order</a>];
<a name="l00025"></a>00025         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>=<span class="keyword">new</span> <span class="keywordtype">int</span>*[<a class="code" href="classvoronoicell__base.html#8377a6f596e11724fd9117ea1f54b974">current_vertices</a>];
<a name="l00026"></a>00026         <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classvoronoicell__base.html#8377a6f596e11724fd9117ea1f54b974">current_vertices</a>];
<a name="l00027"></a>00027         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>=<span class="keyword">new</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a>[3*<a class="code" href="classvoronoicell__base.html#8377a6f596e11724fd9117ea1f54b974">current_vertices</a>];
<a name="l00028"></a>00028         <a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#b6c572acf6422cf04c25c9f2dccba21d">p</a>=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>;
<a name="l00029"></a>00029         <span class="keywordflow">for</span>(i=0;i&lt;3;i++) {
<a name="l00030"></a>00030                 mem[i]=<a class="code" href="config_8hh.html#54dfde30057ff6daba861ac3dcea7c93">init_n_vertices</a>;
<a name="l00031"></a>00031                 mep[i]=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="config_8hh.html#54dfde30057ff6daba861ac3dcea7c93">init_n_vertices</a>*(2*i+1)];
<a name="l00032"></a>00032                 mec[i]=0;
<a name="l00033"></a>00033         }
<a name="l00034"></a>00034         mem[3]=<a class="code" href="config_8hh.html#6fc50d4f33fe39dcd146b6108de77515">init_3_vertices</a>;
<a name="l00035"></a>00035         mep[3]=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="config_8hh.html#6fc50d4f33fe39dcd146b6108de77515">init_3_vertices</a>*7];
<a name="l00036"></a>00036         mec[3]=0;
<a name="l00037"></a>00037         <span class="keywordflow">for</span>(i=4;i&lt;<a class="code" href="classvoronoicell__base.html#2ed244530d520c44b15e1fda58c851e5">current_vertex_order</a>;i++) {
<a name="l00038"></a>00038                 mem[i]=<a class="code" href="config_8hh.html#54dfde30057ff6daba861ac3dcea7c93">init_n_vertices</a>;
<a name="l00039"></a>00039                 mep[i]=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="config_8hh.html#54dfde30057ff6daba861ac3dcea7c93">init_n_vertices</a>*(2*i+1)];
<a name="l00040"></a>00040                 mec[i]=0;
<a name="l00041"></a>00041         }
<a name="l00042"></a>00042 }
<a name="l00043"></a>00043 <span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">/** The voronoicell destructor deallocates all the dynamic memory. */</span>
<a name="l00045"></a>00045 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00046"></a><a class="code" href="classvoronoicell__base.html#ea2284a3722dce4a763d9c7e364adbc0">00046</a> <a class="code" href="classvoronoicell__base.html#ea2284a3722dce4a763d9c7e364adbc0">voronoicell_base&lt;n_option&gt;::~voronoicell_base</a>() {
<a name="l00047"></a>00047         <span class="keyword">delete</span> [] ds;
<a name="l00048"></a>00048         <span class="keyword">delete</span> [] ds2;
<a name="l00049"></a>00049         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;current_vertex_order;i++) if (mem[i]&gt;0) <span class="keyword">delete</span> [] mep[i];
<a name="l00050"></a>00050         <span class="keyword">delete</span> [] mem;
<a name="l00051"></a>00051         <span class="keyword">delete</span> [] mec;
<a name="l00052"></a>00052         <span class="keyword">delete</span> [] mep;
<a name="l00053"></a>00053         <span class="keyword">delete</span> [] <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>;
<a name="l00054"></a>00054         <span class="keyword">delete</span> [] <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>;
<a name="l00055"></a>00055         <span class="keyword">delete</span> [] <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>;
<a name="l00056"></a>00056 }
<a name="l00057"></a>00057 <span class="comment"></span>
<a name="l00058"></a>00058 <span class="comment">/** Increases the memory storage for a particular vertex order, by increasing</span>
<a name="l00059"></a>00059 <span class="comment"> * the size of the of the mep and mne &lt;em&gt;(neighbor option only)&lt;/em&gt; arrays.</span>
<a name="l00060"></a>00060 <span class="comment"> * If the arrays already exist, their size is doubled; if they don't exist,</span>
<a name="l00061"></a>00061 <span class="comment"> * then new ones of size init_n_vertices are allocated. The routine also ensures</span>
<a name="l00062"></a>00062 <span class="comment"> * that the pointers in the ed array are updated, by making use of the back</span>
<a name="l00063"></a>00063 <span class="comment"> * pointers. For the cases where the back pointer has been temporarily</span>
<a name="l00064"></a>00064 <span class="comment"> * overwritten in the marginal vertex code, the auxiliary delete stack is</span>
<a name="l00065"></a>00065 <span class="comment"> * scanned to find out how to update the ed value.</span>
<a name="l00066"></a>00066 <span class="comment"> * \param[in] i The order of the vertex memory to be increased.*/</span>
<a name="l00067"></a>00067 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00068"></a>00068 <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::add_memory</a>(<span class="keywordtype">int</span> i) {
<a name="l00069"></a>00069         <span class="keywordtype">int</span> s=2*i+1;
<a name="l00070"></a>00070         <span class="keywordflow">if</span>(mem[i]==0) {
<a name="l00071"></a>00071                 neighbor.allocate(i,<a class="code" href="config_8hh.html#54dfde30057ff6daba861ac3dcea7c93">init_n_vertices</a>);
<a name="l00072"></a>00072                 mep[i]=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="config_8hh.html#54dfde30057ff6daba861ac3dcea7c93">init_n_vertices</a>*s];
<a name="l00073"></a>00073                 mem[i]=<a class="code" href="config_8hh.html#54dfde30057ff6daba861ac3dcea7c93">init_n_vertices</a>;
<a name="l00074"></a>00074 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=2</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>                cerr &lt;&lt; <span class="stringliteral">"Order "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" vertex memory created "</span> &lt;&lt; endl;
<a name="l00076"></a>00076 <span class="preprocessor">#endif</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> {
<a name="l00078"></a>00078                 <span class="keywordtype">int</span> j=0,k,*l;
<a name="l00079"></a>00079                 mem[i]*=2;
<a name="l00080"></a>00080                 <span class="keywordflow">if</span> (mem[i]&gt;<a class="code" href="config_8hh.html#6115bcee05a06faeeaf51d7eed1ebe73">max_n_vertices</a>) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Point memory allocation exceeded absolute maximum"</span>,<a class="code" href="config_8hh.html#5dc0616f8a67ae3d1c2ba8a3dcf5612b">VOROPP_MEMORY_ERROR</a>);
<a name="l00081"></a>00081 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=2</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>                cerr &lt;&lt; <span class="stringliteral">"Order "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" vertex memory scaled up to "</span> &lt;&lt; mem[i] &lt;&lt; endl;
<a name="l00083"></a>00083 <span class="preprocessor">#endif</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>                l=<span class="keyword">new</span> <span class="keywordtype">int</span>[s*mem[i]];
<a name="l00085"></a>00085                 <span class="keywordtype">int</span> m=0;
<a name="l00086"></a>00086                 neighbor.allocate_aux1(i);
<a name="l00087"></a>00087                 <span class="keywordflow">while</span>(j&lt;s*mec[i]) {
<a name="l00088"></a>00088                         k=mep[i][j+2*i];
<a name="l00089"></a>00089                         <span class="keywordflow">if</span>(k&gt;=0) {
<a name="l00090"></a>00090                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k]=l+j;
<a name="l00091"></a>00091                                 neighbor.set_to_aux1_offset(k,m);
<a name="l00092"></a>00092                         } <span class="keywordflow">else</span> {
<a name="l00093"></a>00093                                 <span class="keywordtype">int</span> o;
<a name="l00094"></a>00094                                 <span class="keywordflow">for</span>(o=0;o&lt;stack2;o++) {
<a name="l00095"></a>00095                                         <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[ds2[o]]==mep[i]+j) {
<a name="l00096"></a>00096                                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[ds2[o]]=l+j;
<a name="l00097"></a>00097                                                 neighbor.set_to_aux1_offset(ds2[o],m);
<a name="l00098"></a>00098                                                 <span class="keywordflow">break</span>;
<a name="l00099"></a>00099                                         }
<a name="l00100"></a>00100                                 }
<a name="l00101"></a>00101                                 <span class="keywordflow">if</span>(o==stack2) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Couldn't relocate dangling pointer"</span>,<a class="code" href="config_8hh.html#d8e0de9d48da06e86dd87884e4a2d47e">VOROPP_INTERNAL_ERROR</a>);
<a name="l00102"></a>00102 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=3</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>                                cerr &lt;&lt; <span class="stringliteral">"Relocated dangling pointer"</span> &lt;&lt; endl;
<a name="l00104"></a>00104 <span class="preprocessor">#endif</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>                        }
<a name="l00106"></a>00106                         <span class="keywordflow">for</span>(k=0;k&lt;s;k++,j++) l[j]=mep[i][j];
<a name="l00107"></a>00107                         <span class="keywordflow">for</span>(k=0;k&lt;i;k++,m++) neighbor.copy_to_aux1(i,m);
<a name="l00108"></a>00108                 }
<a name="l00109"></a>00109                 <span class="keyword">delete</span> [] mep[i];
<a name="l00110"></a>00110                 mep[i]=l;
<a name="l00111"></a>00111                 neighbor.switch_to_aux1(i);
<a name="l00112"></a>00112         }
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 <span class="comment"></span>
<a name="l00115"></a>00115 <span class="comment">/** Doubles the maximum number of vertices allowed, by reallocating the ed, nu,</span>
<a name="l00116"></a>00116 <span class="comment"> * pts, and ne &lt;em&gt;(neighbor option only)&lt;/em&gt; arrays. If the allocation</span>
<a name="l00117"></a>00117 <span class="comment"> * exceeds the absolute maximum set in max_vertices, then the routine exits</span>
<a name="l00118"></a>00118 <span class="comment"> * with a fatal error. */</span>
<a name="l00119"></a>00119 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00120"></a>00120 <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::add_memory_vertices</a>() {
<a name="l00121"></a>00121         <span class="keywordtype">int</span> i=2*<a class="code" href="classvoronoicell__base.html#8377a6f596e11724fd9117ea1f54b974">current_vertices</a>,j,**pp,*pnu;
<a name="l00122"></a>00122         <span class="keywordflow">if</span> (i&gt;<a class="code" href="config_8hh.html#bbe379231ea5470f40d1b24320206846">max_vertices</a>) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Vertex memory allocation exceeded absolute maximum"</span>,<a class="code" href="config_8hh.html#5dc0616f8a67ae3d1c2ba8a3dcf5612b">VOROPP_MEMORY_ERROR</a>);
<a name="l00123"></a>00123 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=2</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>        cerr &lt;&lt; <span class="stringliteral">"Vertex memory scaled up to "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l00125"></a>00125 <span class="preprocessor">#endif</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span>        <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> *ppts;
<a name="l00127"></a>00127         pp=<span class="keyword">new</span> <span class="keywordtype">int</span>*[i];
<a name="l00128"></a>00128         <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classvoronoicell__base.html#8377a6f596e11724fd9117ea1f54b974">current_vertices</a>;j++) pp[j]=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j];
<a name="l00129"></a>00129         <span class="keyword">delete</span> [] <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>=pp;
<a name="l00130"></a>00130         neighbor.add_memory_vertices(i);
<a name="l00131"></a>00131         pnu=<span class="keyword">new</span> <span class="keywordtype">int</span>[i];
<a name="l00132"></a>00132         <span class="keywordflow">for</span>(j=0;j&lt;current_vertices;j++) pnu[j]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[j];
<a name="l00133"></a>00133         <span class="keyword">delete</span> [] <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>=pnu;
<a name="l00134"></a>00134         ppts=<span class="keyword">new</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a>[3*i];
<a name="l00135"></a>00135         <span class="keywordflow">for</span>(j=0;j&lt;3*current_vertices;j++) ppts[j]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[j];
<a name="l00136"></a>00136         <span class="keyword">delete</span> [] <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>;<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#b6c572acf6422cf04c25c9f2dccba21d">p</a>=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>=ppts;
<a name="l00137"></a>00137         current_vertices=i;
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 <span class="comment"></span>
<a name="l00140"></a>00140 <span class="comment">/** Doubles the maximum allowed vertex order, by reallocating mem, mep, mec,</span>
<a name="l00141"></a>00141 <span class="comment"> * and mnu &lt;em&gt;(neighbor option only)&lt;/em&gt; arrays. If the allocation exceeds</span>
<a name="l00142"></a>00142 <span class="comment"> * the absolute maximum set in max_vertex_order, then the routine causes a fatal</span>
<a name="l00143"></a>00143 <span class="comment"> * error. */</span>
<a name="l00144"></a>00144 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00145"></a>00145 <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::add_memory_vorder</a>() {
<a name="l00146"></a>00146         <span class="keywordtype">int</span> i=2*<a class="code" href="classvoronoicell__base.html#2ed244530d520c44b15e1fda58c851e5">current_vertex_order</a>,j,*p1,**p2;
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (i&gt;<a class="code" href="config_8hh.html#117e99fe94fcd4ed0b8558a8fb3ad1b5">max_vertex_order</a>) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Vertex order memory allocation exceeded absolute maximum"</span>,<a class="code" href="config_8hh.html#5dc0616f8a67ae3d1c2ba8a3dcf5612b">VOROPP_MEMORY_ERROR</a>);
<a name="l00148"></a>00148 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=2</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>        cerr &lt;&lt; <span class="stringliteral">"Vertex order memory scaled up to "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l00150"></a>00150 <span class="preprocessor">#endif</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>        p1=<span class="keyword">new</span> <span class="keywordtype">int</span>[i];
<a name="l00152"></a>00152         <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classvoronoicell__base.html#2ed244530d520c44b15e1fda58c851e5">current_vertex_order</a>;j++) p1[j]=mem[j];<span class="keywordflow">while</span>(j&lt;i) p1[j++]=0;
<a name="l00153"></a>00153         <span class="keyword">delete</span> [] mem;mem=p1;
<a name="l00154"></a>00154         p2=<span class="keyword">new</span> <span class="keywordtype">int</span>*[i];
<a name="l00155"></a>00155         <span class="keywordflow">for</span>(j=0;j&lt;current_vertex_order;j++) p2[j]=mep[j];
<a name="l00156"></a>00156         <span class="keyword">delete</span> [] mep;mep=p2;
<a name="l00157"></a>00157         p1=<span class="keyword">new</span> <span class="keywordtype">int</span>[i];
<a name="l00158"></a>00158         <span class="keywordflow">for</span>(j=0;j&lt;current_vertex_order;j++) p1[j]=mec[j];<span class="keywordflow">while</span>(j&lt;i) p1[j++]=0;
<a name="l00159"></a>00159         <span class="keyword">delete</span> [] mec;mec=p1;
<a name="l00160"></a>00160         neighbor.add_memory_vorder(i);
<a name="l00161"></a>00161         current_vertex_order=i;
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 <span class="comment"></span>
<a name="l00164"></a>00164 <span class="comment">/** Doubles the size allocation of the main delete stack. If the allocation</span>
<a name="l00165"></a>00165 <span class="comment"> * exceeds the absolute maximum set in max_delete_size, then routine causes a</span>
<a name="l00166"></a>00166 <span class="comment"> * fatal error. */</span>
<a name="l00167"></a>00167 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00168"></a>00168 <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::add_memory_ds</a>() {
<a name="l00169"></a>00169         <span class="keywordtype">int</span> i=2*<a class="code" href="classvoronoicell__base.html#ba57ebcf710b899119e3e6808bf9ffd3">current_delete_size</a>,j,*pds;
<a name="l00170"></a>00170         <span class="keywordflow">if</span> (i&gt;<a class="code" href="config_8hh.html#9eeea65c3e4ea2555054496053f103fb">max_delete_size</a>) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Delete stack 1 memory allocation exceeded absolute maximum"</span>,<a class="code" href="config_8hh.html#5dc0616f8a67ae3d1c2ba8a3dcf5612b">VOROPP_MEMORY_ERROR</a>);
<a name="l00171"></a>00171 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=2</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>        cerr &lt;&lt; <span class="stringliteral">"Delete stack 1 memory scaled up to "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l00173"></a>00173 <span class="preprocessor">#endif</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>        pds=<span class="keyword">new</span> <span class="keywordtype">int</span>[i];
<a name="l00175"></a>00175         <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classvoronoicell__base.html#ba57ebcf710b899119e3e6808bf9ffd3">current_delete_size</a>;j++) pds[j]=ds[j];
<a name="l00176"></a>00176         <span class="keyword">delete</span> [] ds;ds=pds;
<a name="l00177"></a>00177         current_delete_size=i;
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 <span class="comment"></span>
<a name="l00180"></a>00180 <span class="comment">/** Doubles the size allocation of the auxiliary delete stack. If the</span>
<a name="l00181"></a>00181 <span class="comment"> * allocation exceeds the absolute maximum set in max_delete2_size, then the</span>
<a name="l00182"></a>00182 <span class="comment"> * routine causes a fatal error. */</span>
<a name="l00183"></a>00183 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00184"></a>00184 <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::add_memory_ds2</a>() {
<a name="l00185"></a>00185         <span class="keywordtype">int</span> i=2*<a class="code" href="classvoronoicell__base.html#c24fdead81ae8e351c42a950aba416f7">current_delete2_size</a>,j,*pds2;
<a name="l00186"></a>00186         <span class="keywordflow">if</span> (i&gt;<a class="code" href="config_8hh.html#cd642e37ba48a6d25118a18fe180a45a">max_delete2_size</a>) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Delete stack 2 memory allocation exceeded absolute maximum"</span>,<a class="code" href="config_8hh.html#5dc0616f8a67ae3d1c2ba8a3dcf5612b">VOROPP_MEMORY_ERROR</a>);
<a name="l00187"></a>00187 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=2</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>        cerr &lt;&lt; <span class="stringliteral">"Delete stack 2 memory scaled up to "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l00189"></a>00189 <span class="preprocessor">#endif</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>        pds2=<span class="keyword">new</span> <span class="keywordtype">int</span>[i];
<a name="l00191"></a>00191         <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classvoronoicell__base.html#c24fdead81ae8e351c42a950aba416f7">current_delete2_size</a>;j++) pds2[j]=ds2[j];
<a name="l00192"></a>00192         <span class="keyword">delete</span> [] ds2;ds2=pds2;
<a name="l00193"></a>00193         current_delete2_size=i;
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 <span class="comment"></span>
<a name="l00196"></a>00196 <span class="comment">/** Initializes a Voronoi cell as a rectangular box with the given dimensions */</span>
<a name="l00197"></a>00197 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00198"></a><a class="code" href="classvoronoicell__base.html#e6f3362a8981a741ec6d6a25f7e1bec7">00198</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#e6f3362a8981a741ec6d6a25f7e1bec7">voronoicell_base&lt;n_option&gt;::init</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xmin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xmax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ymin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ymax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zmin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zmax) {
<a name="l00199"></a>00199         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;current_vertex_order;i++) mec[i]=0;<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=0;
<a name="l00200"></a>00200         mec[3]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>=8;xmin*=2;xmax*=2;ymin*=2;ymax*=2;zmin*=2;zmax*=2;
<a name="l00201"></a>00201         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[0]=xmin;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[1]=ymin;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[2]=zmin;
<a name="l00202"></a>00202         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3]=xmax;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[4]=ymin;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[5]=zmin;
<a name="l00203"></a>00203         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[6]=xmin;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[7]=ymax;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[8]=zmin;
<a name="l00204"></a>00204         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[9]=xmax;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[10]=ymax;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[11]=zmin;
<a name="l00205"></a>00205         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[12]=xmin;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[13]=ymin;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[14]=zmax;
<a name="l00206"></a>00206         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[15]=xmax;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[16]=ymin;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[17]=zmax;
<a name="l00207"></a>00207         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[18]=xmin;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[19]=ymax;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[20]=zmax;
<a name="l00208"></a>00208         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[21]=xmax;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[22]=ymax;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[23]=zmax;
<a name="l00209"></a>00209         <span class="keywordtype">int</span> *q=mep[3];
<a name="l00210"></a>00210         q[0]=1;q[1]=4;q[2]=2;q[3]=2;q[4]=1;q[5]=0;q[6]=0;
<a name="l00211"></a>00211         q[7]=3;q[8]=5;q[9]=0;q[10]=2;q[11]=1;q[12]=0;q[13]=1;
<a name="l00212"></a>00212         q[14]=0;q[15]=6;q[16]=3;q[17]=2;q[18]=1;q[19]=0;q[20]=2;
<a name="l00213"></a>00213         q[21]=2;q[22]=7;q[23]=1;q[24]=2;q[25]=1;q[26]=0;q[27]=3;
<a name="l00214"></a>00214         q[28]=6;q[29]=0;q[30]=5;q[31]=2;q[32]=1;q[33]=0;q[34]=4;
<a name="l00215"></a>00215         q[35]=4;q[36]=1;q[37]=7;q[38]=2;q[39]=1;q[40]=0;q[41]=5;
<a name="l00216"></a>00216         q[42]=7;q[43]=2;q[44]=4;q[45]=2;q[46]=1;q[47]=0;q[48]=6;
<a name="l00217"></a>00217         q[49]=5;q[50]=3;q[51]=6;q[52]=2;q[53]=1;q[54]=0;q[55]=7;
<a name="l00218"></a>00218         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[0]=q;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[1]=q+7;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[2]=q+14;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[3]=q+21;
<a name="l00219"></a>00219         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[4]=q+28;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[5]=q+35;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[6]=q+42;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[7]=q+49;
<a name="l00220"></a>00220         neighbor.init();
<a name="l00221"></a>00221         <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[0]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[1]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[2]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[3]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[4]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[5]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[6]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[7]=3;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 <span class="comment"></span>
<a name="l00224"></a>00224 <span class="comment">/** Initializes a Voronoi cell as a regular octahedron.</span>
<a name="l00225"></a>00225 <span class="comment"> * \param[in] l The distance from the octahedron center to a vertex. Six vertices</span>
<a name="l00226"></a>00226 <span class="comment"> * are initialized at (-l,0,0), (l,0,0), (0,-l,0), (0,l,0), (0,0,-l), and (0,0,l).*/</span>
<a name="l00227"></a>00227 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00228"></a><a class="code" href="classvoronoicell__base.html#a5ddfdf62baf30e6f8b606cdb7725dae">00228</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#a5ddfdf62baf30e6f8b606cdb7725dae">voronoicell_base&lt;n_option&gt;::init_octahedron</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> l) {
<a name="l00229"></a>00229         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;current_vertex_order;i++) mec[i]=0;<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=0;
<a name="l00230"></a>00230         mec[4]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>=6;l*=2;
<a name="l00231"></a>00231         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[0]=-l;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[1]=0;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[2]=0;
<a name="l00232"></a>00232         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3]=l;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[4]=0;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[5]=0;
<a name="l00233"></a>00233         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[6]=0;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[7]=-l;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[8]=0;
<a name="l00234"></a>00234         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[9]=0;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[10]=l;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[11]=0;
<a name="l00235"></a>00235         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[12]=0;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[13]=0;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[14]=-l;
<a name="l00236"></a>00236         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[15]=0;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[16]=0;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[17]=l;
<a name="l00237"></a>00237         <span class="keywordtype">int</span> *q=mep[4];
<a name="l00238"></a>00238         q[0]=2;q[1]=5;q[2]=3;q[3]=4;q[4]=0;q[5]=0;q[6]=0;q[7]=0;q[8]=0;
<a name="l00239"></a>00239         q[9]=2;q[10]=4;q[11]=3;q[12]=5;q[13]=2;q[14]=2;q[15]=2;q[16]=2;q[17]=1;
<a name="l00240"></a>00240         q[18]=0;q[19]=4;q[20]=1;q[21]=5;q[22]=0;q[23]=3;q[24]=0;q[25]=1;q[26]=2;
<a name="l00241"></a>00241         q[27]=0;q[28]=5;q[29]=1;q[30]=4;q[31]=2;q[32]=3;q[33]=2;q[34]=1;q[35]=3;
<a name="l00242"></a>00242         q[36]=0;q[37]=3;q[38]=1;q[39]=2;q[40]=3;q[41]=3;q[42]=1;q[43]=1;q[44]=4;
<a name="l00243"></a>00243         q[45]=0;q[46]=2;q[47]=1;q[48]=3;q[49]=1;q[50]=3;q[51]=3;q[52]=1;q[53]=5;
<a name="l00244"></a>00244         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[0]=q;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[1]=q+9;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[2]=q+18;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[3]=q+27;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[4]=q+36;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[5]=q+45;
<a name="l00245"></a>00245         neighbor.init_octahedron();
<a name="l00246"></a>00246         <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[0]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[1]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[2]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[3]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[4]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[5]=4;
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 <span class="comment"></span>
<a name="l00249"></a>00249 <span class="comment">/** Initializes a Voronoi cell as a tetrahedron. It assumes that the normal to</span>
<a name="l00250"></a>00250 <span class="comment"> * the face for the first three vertices points inside.</span>
<a name="l00251"></a>00251 <span class="comment"> * \param (x0,y0,z0) A position vector for the first vertex.</span>
<a name="l00252"></a>00252 <span class="comment"> * \param (x1,y1,z1) A position vector for the second vertex.</span>
<a name="l00253"></a>00253 <span class="comment"> * \param (x2,y2,z2) A position vector for the third vertex.</span>
<a name="l00254"></a>00254 <span class="comment"> * \param (x3,y3,z3) A position vector for the fourth vertex. */</span>
<a name="l00255"></a>00255 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00256"></a><a class="code" href="classvoronoicell__base.html#fcbe7586b8f0d2404a59939e4d084941">00256</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#fcbe7586b8f0d2404a59939e4d084941">voronoicell_base&lt;n_option&gt;::init_tetrahedron</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x1,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y1,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z1,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x2,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y2,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z2,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x3,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y3,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z3) {
<a name="l00257"></a>00257         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;current_vertex_order;i++) mec[i]=0;<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=0;
<a name="l00258"></a>00258         mec[3]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>=4;
<a name="l00259"></a>00259         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[0]=x0*2;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[1]=y0*2;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[2]=z0*2;
<a name="l00260"></a>00260         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3]=x1*2;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[4]=y1*2;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[5]=z1*2;
<a name="l00261"></a>00261         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[6]=x2*2;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[7]=y2*2;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[8]=z2*2;
<a name="l00262"></a>00262         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[9]=x3*2;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[10]=y3*2;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[11]=z3*2;
<a name="l00263"></a>00263         <span class="keywordtype">int</span> *q=mep[3];
<a name="l00264"></a>00264         q[0]=1;q[1]=3;q[2]=2;q[3]=0;q[4]=0;q[5]=0;q[6]=0;
<a name="l00265"></a>00265         q[7]=0;q[8]=2;q[9]=3;q[10]=0;q[11]=2;q[12]=1;q[13]=1;
<a name="l00266"></a>00266         q[14]=0;q[15]=3;q[16]=1;q[17]=2;q[18]=2;q[19]=1;q[20]=2;
<a name="l00267"></a>00267         q[21]=0;q[22]=1;q[23]=2;q[24]=1;q[25]=2;q[26]=1;q[27]=3;
<a name="l00268"></a>00268         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[0]=q;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[1]=q+7;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[2]=q+14;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[3]=q+21;
<a name="l00269"></a>00269         neighbor.init_tetrahedron();
<a name="l00270"></a>00270         <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[0]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[1]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[2]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[3]=3;
<a name="l00271"></a>00271 }
<a name="l00272"></a>00272 <span class="comment"></span>
<a name="l00273"></a>00273 <span class="comment">/** Initializes an arbitrary test object using the add_vertex() and</span>
<a name="l00274"></a>00274 <span class="comment"> * construct_relations() routines. See the source code for information about</span>
<a name="l00275"></a>00275 <span class="comment"> * the specific objects.</span>
<a name="l00276"></a>00276 <span class="comment"> * \param[in] n the number of the test object (from 0 to 9)</span>
<a name="l00277"></a>00277 <span class="comment"> */</span>
<a name="l00278"></a>00278 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00279"></a><a class="code" href="classvoronoicell__base.html#46dbb6c18bcab07304ed90e6a77305bf">00279</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#46dbb6c18bcab07304ed90e6a77305bf">voronoicell_base&lt;n_option&gt;::init_test</a>(<span class="keywordtype">int</span> n) {
<a name="l00280"></a>00280         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;current_vertex_order;i++) mec[i]=0;<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>=0;
<a name="l00281"></a>00281         <span class="keywordflow">switch</span>(n) {
<a name="l00282"></a>00282                 <span class="keywordflow">case</span> 0:
<a name="l00283"></a>00283                         <span class="comment">// A peaked object, with a high vertex 6, and a ridge</span>
<a name="l00284"></a>00284                         <span class="comment">// at z=0 from vertex 1 to 2. This can be used to test</span>
<a name="l00285"></a>00285                         <span class="comment">// the order 1 vertex collapse routine.</span>
<a name="l00286"></a>00286                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,-2,-1,3,1,5);
<a name="l00287"></a>00287                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,-1,1,5,0,2);
<a name="l00288"></a>00288                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,1,0,1,3,6,4);
<a name="l00289"></a>00289                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,4,-1,4,6,2,0);
<a name="l00290"></a>00290                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,4,-1,3,5,2,6);
<a name="l00291"></a>00291                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,-2,-1,4,0,1);
<a name="l00292"></a>00292                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,3,0,4,2,3);
<a name="l00293"></a>00293                         <span class="keywordflow">break</span>;
<a name="l00294"></a>00294                 <span class="keywordflow">case</span> 1:
<a name="l00295"></a>00295                         <span class="comment">// A truncated pyramid shape, with vertex 4 in the z=0</span>
<a name="l00296"></a>00296                         <span class="comment">// plane. This can be used to test order 4 vertex</span>
<a name="l00297"></a>00297                         <span class="comment">// generation.</span>
<a name="l00298"></a>00298                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-2,2,-1,3,4,1);
<a name="l00299"></a>00299                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(2,2,-1,0,5,2);
<a name="l00300"></a>00300                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(2,-2,-1,1,6,3);
<a name="l00301"></a>00301                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-2,-2,-1,2,7,0);
<a name="l00302"></a>00302                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,1,0,0,7,5);
<a name="l00303"></a>00303                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,1,1,1,4,6);
<a name="l00304"></a>00304                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,-1,1,7,2,5);
<a name="l00305"></a>00305                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,-1,1,4,3,6);
<a name="l00306"></a>00306                         <span class="keywordflow">break</span>;
<a name="l00307"></a>00307                 <span class="keywordflow">case</span> 2:
<a name="l00308"></a>00308                         <span class="comment">// An object with two peaks at vertices 4 and 6,</span>
<a name="l00309"></a>00309                         <span class="comment">// connected with a trough at vertex 5. It can be used</span>
<a name="l00310"></a>00310                         <span class="comment">// to test the part of the routine that deals with</span>
<a name="l00311"></a>00311                         <span class="comment">// augmenting existing vertices.</span>
<a name="l00312"></a>00312                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,-2,-1,1,3,4);
<a name="l00313"></a>00313                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,-2,-1,2,0,4,5);
<a name="l00314"></a>00314                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,2,-1,1,6,3);
<a name="l00315"></a>00315                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,2,-1,2,6,5,0);
<a name="l00316"></a>00316                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,-1,1,5,1,0);
<a name="l00317"></a>00317                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,0,0,1,4,3,6);
<a name="l00318"></a>00318                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,1,1,2,5,3);
<a name="l00319"></a>00319                         <span class="keywordflow">break</span>;
<a name="l00320"></a>00320                 <span class="keywordflow">case</span> 3:
<a name="l00321"></a>00321                         <span class="comment">// A box with a pyramid on top of it. This a good</span>
<a name="l00322"></a>00322                         <span class="comment">// test object to make sure that the code can handle</span>
<a name="l00323"></a>00323                         <span class="comment">// object with vertices of different orders.</span>
<a name="l00324"></a>00324                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,-1,-1,4,3,1);
<a name="l00325"></a>00325                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,-1,-1,0,2,5);
<a name="l00326"></a>00326                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,1,-1,6,1,3);
<a name="l00327"></a>00327                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,1,-1,2,0,7);
<a name="l00328"></a>00328                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,-1,1,7,0,5,8);
<a name="l00329"></a>00329                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,-1,1,4,1,6,8);
<a name="l00330"></a>00330                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,1,1,5,2,7,8);
<a name="l00331"></a>00331                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,1,1,6,3,4,8);
<a name="l00332"></a>00332                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,0,2,7,4,5,6);
<a name="l00333"></a>00333                         <span class="keywordflow">break</span>;
<a name="l00334"></a>00334                 <span class="keywordflow">case</span> 4:
<a name="l00335"></a>00335                         <span class="comment">// A shape with two peaks (vertices 6 and 9) connected</span>
<a name="l00336"></a>00336                         <span class="comment">// with a trough (vertices 7 and 8). It can be used as</span>
<a name="l00337"></a>00337                         <span class="comment">// a basic test of the double edge skipping in the plane</span>
<a name="l00338"></a>00338                         <span class="comment">// generation routine, whereby an edge is omitted if</span>
<a name="l00339"></a>00339                         <span class="comment">// the routine is tracing along a part it has already</span>
<a name="l00340"></a>00340                         <span class="comment">// been down.</span>
<a name="l00341"></a>00341                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,-3,-1,5,6,1);
<a name="l00342"></a>00342                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,-3,-1,0,6,2);
<a name="l00343"></a>00343                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-3,0,-1,1,7,8,3);
<a name="l00344"></a>00344                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,3,-1,2,9,4);
<a name="l00345"></a>00345                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,3,-1,3,9,5);
<a name="l00346"></a>00346                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(3,0,-1,4,8,7,0);
<a name="l00347"></a>00347                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,-2,1,7,1,0);
<a name="l00348"></a>00348                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,-1,0,8,2,6,5);
<a name="l00349"></a>00349                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,1,0,9,2,7,5);
<a name="l00350"></a>00350                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,2,1,3,8,4);
<a name="l00351"></a>00351                         <span class="keywordflow">break</span>;
<a name="l00352"></a>00352                 <span class="keywordflow">case</span> 5:
<a name="l00353"></a>00353                         <span class="comment">// An object with four peaks (vertices 8 to 11)</span>
<a name="l00354"></a>00354                         <span class="comment">// connected by a trough (vertex 16). It can be used to</span>
<a name="l00355"></a>00355                         <span class="comment">// the test multiple augmentation of edges of a</span>
<a name="l00356"></a>00356                         <span class="comment">// particular vertex.</span>
<a name="l00357"></a>00357                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,-3,-1,7,1,8,12);
<a name="l00358"></a>00358                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,-3,-1,2,12,8,0);
<a name="l00359"></a>00359                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(3,-1,-1,3,9,13,1);
<a name="l00360"></a>00360                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(3,1,-1,4,13,9,2);
<a name="l00361"></a>00361                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,3,-1,5,10,14,3);
<a name="l00362"></a>00362                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,3,-1,6,14,10,4);
<a name="l00363"></a>00363                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-3,1,-1,7,11,15,5);
<a name="l00364"></a>00364                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-3,-1,-1,0,15,11,6);
<a name="l00365"></a>00365                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,-2,1,0,1,12);
<a name="l00366"></a>00366                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(2,0,1,2,3,13);
<a name="l00367"></a>00367                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,2,1,14,4,5);
<a name="l00368"></a>00368                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-2,0,1,7,15,6);
<a name="l00369"></a>00369                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,-1,0.5,0,8,1,16);
<a name="l00370"></a>00370                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,0,0.5,2,9,3,16);
<a name="l00371"></a>00371                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,1,0.5,4,10,5,16);
<a name="l00372"></a>00372                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,0,0.5,6,11,7,16);
<a name="l00373"></a>00373                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,0,0,15,12,13,14);
<a name="l00374"></a>00374                         <span class="keywordflow">break</span>;
<a name="l00375"></a>00375                 <span class="keywordflow">case</span> 6:
<a name="l00376"></a>00376                         <span class="comment">// An object with four peaks (vertices 8 to 11)</span>
<a name="l00377"></a>00377                         <span class="comment">// connected by a sequence of ridges. It can be used to</span>
<a name="l00378"></a>00378                         <span class="comment">// the test multiple cases of double edge skipping</span>
<a name="l00379"></a>00379                         <span class="comment">// on the same vertex.</span>
<a name="l00380"></a>00380                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,-3,-1,7,1,8,12);
<a name="l00381"></a>00381                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,-3,-1,2,12,8,0);
<a name="l00382"></a>00382                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(3,-1,-1,3,9,13,1);
<a name="l00383"></a>00383                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(3,1,-1,4,13,9,2);
<a name="l00384"></a>00384                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,3,-1,5,10,14,3);
<a name="l00385"></a>00385                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,3,-1,6,14,10,4);
<a name="l00386"></a>00386                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-3,1,-1,7,11,15,5);
<a name="l00387"></a>00387                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-3,-1,-1,0,15,11,6);
<a name="l00388"></a>00388                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,-2,1,0,1,12);
<a name="l00389"></a>00389                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(2,0,1,2,3,13);
<a name="l00390"></a>00390                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,2,1,14,4,5);
<a name="l00391"></a>00391                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-2,0,1,7,15,6);
<a name="l00392"></a>00392                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,-1,0,0,8,1,16);
<a name="l00393"></a>00393                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,0,0,2,9,3,16);
<a name="l00394"></a>00394                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,1,0,4,10,5,16);
<a name="l00395"></a>00395                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,0,0,6,11,7,16);
<a name="l00396"></a>00396                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,0,0,15,12,13,14);
<a name="l00397"></a>00397                         <span class="keywordflow">break</span>;
<a name="l00398"></a>00398                 <span class="keywordflow">case</span> 7:
<a name="l00399"></a>00399                         <span class="comment">// A variation on the zeroth test shape, with a peak</span>
<a name="l00400"></a>00400                         <span class="comment">// (vertices 7 and 8) connected to a ridge at z=0</span>
<a name="l00401"></a>00401                         <span class="comment">// (vertices 4 and 5)</span>
<a name="l00402"></a>00402                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(2,-3,-1,3,4,1);
<a name="l00403"></a>00403                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-2,-3,-1,0,4,2);
<a name="l00404"></a>00404                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-2,3,-1,1,7,3);
<a name="l00405"></a>00405                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(2,3,-1,2,6,0);
<a name="l00406"></a>00406                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,-2,0,0,5,1);
<a name="l00407"></a>00407                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,1,0,4,6,7);
<a name="l00408"></a>00408                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,2,1,7,5,3);
<a name="l00409"></a>00409                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1,2,1,5,6,2);
<a name="l00410"></a>00410                         <span class="keywordflow">break</span>;
<a name="l00411"></a>00411                 <span class="keywordflow">case</span> 8:
<a name="l00412"></a>00412                         <span class="comment">// A triangular object with a skewed peak, that can be used to</span>
<a name="l00413"></a>00413                         <span class="comment">// test the order two vertex removal routine</span>
<a name="l00414"></a>00414                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(3,-2,-1,2,3,1);
<a name="l00415"></a>00415                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-3,-2,-1,0,4,2);
<a name="l00416"></a>00416                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,4,-1,1,5,0);
<a name="l00417"></a>00417                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1.5,-1,0,7,0,6);
<a name="l00418"></a>00418                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-1.5,-1,0,1,7,8);
<a name="l00419"></a>00419                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,2,0,8,6,2);
<a name="l00420"></a>00420                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0.75,0.5,0,9,3,5);
<a name="l00421"></a>00421                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,-1,0,4,3,9);
<a name="l00422"></a>00422                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(-0.75,0.5,0,4,9,5);
<a name="l00423"></a>00423                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,0,1,8,7,6);
<a name="l00424"></a>00424                         <span class="keywordflow">break</span>;
<a name="l00425"></a>00425                 <span class="keywordflow">case</span> 9:
<a name="l00426"></a>00426                         <span class="comment">// This a tetrahedron with some low-order extraneous edges, and can</span>
<a name="l00427"></a>00427                         <span class="comment">// be used to test the order 1 and order 2 removal routines</span>
<a name="l00428"></a>00428                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(0,0,0,3,1,2);
<a name="l00429"></a>00429                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,0,1,3,2,0);
<a name="l00430"></a>00430                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(1,1,0,3,0,1);
<a name="l00431"></a>00431                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(2,0,0,6,4,2,1,0);
<a name="l00432"></a>00432                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(3,1,0,3,6,8,5);
<a name="l00433"></a>00433                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(3,2,0,4);
<a name="l00434"></a>00434                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(4,0,0,4,3,7,8);
<a name="l00435"></a>00435                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(5,0,0,6);
<a name="l00436"></a>00436                         <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">add_vertex</a>(4,1,0,6,4);
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439         <a class="code" href="classvoronoicell__base.html#a80520b028fc65ef39b39b24605a0f79">construct_relations</a>();
<a name="l00440"></a>00440         neighbor.label_facets();
<a name="l00441"></a>00441 }
<a name="l00442"></a>00442 <span class="comment"></span>
<a name="l00443"></a>00443 <span class="comment">/** Adds an order one vertex to the memory structure, and specifies its edge.</span>
<a name="l00444"></a>00444 <span class="comment"> * \param[in] (x,y,z) are the coordinates of the vertex</span>
<a name="l00445"></a>00445 <span class="comment"> * \param[in] a is the first and only edge of this vertex</span>
<a name="l00446"></a>00446 <span class="comment"> */</span>
<a name="l00447"></a>00447 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00448"></a><a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">00448</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">voronoicell_base&lt;n_option&gt;::add_vertex</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<span class="keywordtype">int</span> a) {
<a name="l00449"></a>00449         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=x;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1]=y;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2]=z;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=1;
<a name="l00450"></a>00450         <span class="keywordflow">if</span> (mem[1]==mec[1]) add_memory(1);
<a name="l00451"></a>00451         neighbor.set_pointer(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,1);
<a name="l00452"></a>00452         <span class="keywordtype">int</span> *q=mep[1]+3*mec[1]++;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=q;
<a name="l00453"></a>00453         q[0]=a;q[2]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>++;
<a name="l00454"></a>00454 }
<a name="l00455"></a>00455 <span class="comment"></span>
<a name="l00456"></a>00456 <span class="comment">/** Adds an order 2 vertex to the memory structure, and specifies its edges. */</span>
<a name="l00457"></a>00457 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00458"></a><a class="code" href="classvoronoicell__base.html#74692f2d436353a3bb99fa69a0af3b24">00458</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">voronoicell_base&lt;n_option&gt;::add_vertex</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b) {
<a name="l00459"></a>00459         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=x;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1]=y;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2]=z;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=2;
<a name="l00460"></a>00460         <span class="keywordflow">if</span> (mem[2]==mec[2]) add_memory(2);
<a name="l00461"></a>00461         neighbor.set_pointer(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,2);
<a name="l00462"></a>00462         <span class="keywordtype">int</span> *q=mep[2]+5*mec[2]++;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=q;
<a name="l00463"></a>00463         q[0]=a;q[1]=b;q[4]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>++;
<a name="l00464"></a>00464 }
<a name="l00465"></a>00465 <span class="comment"></span>
<a name="l00466"></a>00466 <span class="comment">/** Adds an order 3 vertex to the memory structure, and specifies its edges. */</span>
<a name="l00467"></a>00467 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00468"></a><a class="code" href="classvoronoicell__base.html#bef94e2999f1e3766dcbc12af51cf3c0">00468</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">voronoicell_base&lt;n_option&gt;::add_vertex</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b,<span class="keywordtype">int</span> c) {
<a name="l00469"></a>00469         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=x;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1]=y;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2]=z;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=3;
<a name="l00470"></a>00470         <span class="keywordflow">if</span> (mem[3]==mec[3]) add_memory(3);
<a name="l00471"></a>00471         neighbor.set_pointer(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,3);
<a name="l00472"></a>00472         <span class="keywordtype">int</span> *q=mep[3]+7*mec[3]++;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=q;
<a name="l00473"></a>00473         q[0]=a;q[1]=b;q[2]=c;q[6]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>++;
<a name="l00474"></a>00474 }
<a name="l00475"></a>00475 <span class="comment"></span>
<a name="l00476"></a>00476 <span class="comment">/** Adds an order 4 vertex to the memory structure, and specifies its edges. */</span>
<a name="l00477"></a>00477 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00478"></a><a class="code" href="classvoronoicell__base.html#e4410e4cd9460c7de4c7bfea99455ec6">00478</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">voronoicell_base&lt;n_option&gt;::add_vertex</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b,<span class="keywordtype">int</span> c,<span class="keywordtype">int</span> d) {
<a name="l00479"></a>00479         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=x;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1]=y;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2]=z;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=4;
<a name="l00480"></a>00480         <span class="keywordflow">if</span> (mem[4]==mec[4]) add_memory(4);
<a name="l00481"></a>00481         neighbor.set_pointer(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,4);
<a name="l00482"></a>00482         <span class="keywordtype">int</span> *q=mep[4]+9*mec[4]++;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=q;
<a name="l00483"></a>00483         q[0]=a;q[1]=b;q[2]=c;q[3]=d;q[8]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>++;
<a name="l00484"></a>00484 }
<a name="l00485"></a>00485 <span class="comment"></span>
<a name="l00486"></a>00486 <span class="comment">/** Adds an order 5 vertex to the memory structure, and specifies its edges. */</span>
<a name="l00487"></a>00487 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00488"></a><a class="code" href="classvoronoicell__base.html#98d841346914f71549ba683dc42eaa20">00488</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#4510e7ee937a29843eedd0885dbfbd9a">voronoicell_base&lt;n_option&gt;::add_vertex</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b,<span class="keywordtype">int</span> c,<span class="keywordtype">int</span> d,<span class="keywordtype">int</span> e) {
<a name="l00489"></a>00489         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=x;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1]=y;<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2]=z;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=5;
<a name="l00490"></a>00490         <span class="keywordflow">if</span> (mem[5]==mec[5]) add_memory(5);
<a name="l00491"></a>00491         neighbor.set_pointer(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,5);
<a name="l00492"></a>00492         <span class="keywordtype">int</span> *q=mep[5]+11*mec[5]++;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=q;
<a name="l00493"></a>00493         q[0]=a;q[1]=b;q[2]=c;q[3]=d;q[4]=e;q[10]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>++;
<a name="l00494"></a>00494 }
<a name="l00495"></a>00495 <span class="comment"></span>
<a name="l00496"></a>00496 <span class="comment">/** Checks that the relational table of the Voronoi cell is accurate, and prints</span>
<a name="l00497"></a>00497 <span class="comment"> * out any errors. This algorithm is O(p), so running it every time the plane</span>
<a name="l00498"></a>00498 <span class="comment"> * routine is called will result in a significant slowdown. */</span>
<a name="l00499"></a>00499 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00500"></a><a class="code" href="classvoronoicell__base.html#e5f15b30a1e703f23e7e2578ab97606a">00500</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#e5f15b30a1e703f23e7e2578ab97606a">voronoicell_base&lt;n_option&gt;::check_relations</a>() {
<a name="l00501"></a>00501         <span class="keywordtype">int</span> i,j;
<a name="l00502"></a>00502         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i++) {
<a name="l00503"></a>00503                 <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[i];j++) {
<a name="l00504"></a>00504                         <span class="keywordflow">if</span> (<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j]][<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][nu[i]+j]]!=i) cout &lt;&lt; <span class="stringliteral">"Relational error at point "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">", edge "</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">"."</span> &lt;&lt; endl;
<a name="l00505"></a>00505                 }
<a name="l00506"></a>00506         }
<a name="l00507"></a>00507 }
<a name="l00508"></a>00508 <span class="comment"></span>
<a name="l00509"></a>00509 <span class="comment">/** This routine checks for any two vertices that are connected by more than one</span>
<a name="l00510"></a>00510 <span class="comment"> * edge. The plane algorithm is designed so that this should not happen, so any</span>
<a name="l00511"></a>00511 <span class="comment"> * occurrences are most likely errors. Note that the routine is O(p), so</span>
<a name="l00512"></a>00512 <span class="comment"> * running it every time the plane routine is called will result in a significant</span>
<a name="l00513"></a>00513 <span class="comment"> * slowdown. */</span>
<a name="l00514"></a>00514 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00515"></a><a class="code" href="classvoronoicell__base.html#491b2196d78bcb1a4cee8faae9200d55">00515</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#491b2196d78bcb1a4cee8faae9200d55">voronoicell_base&lt;n_option&gt;::check_duplicates</a>() {
<a name="l00516"></a>00516         <span class="keywordtype">int</span> i,j,k;
<a name="l00517"></a>00517         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i++) {
<a name="l00518"></a>00518                 <span class="keywordflow">for</span>(j=1;j&lt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[i];j++) {
<a name="l00519"></a>00519                         <span class="keywordflow">for</span>(k=0;k&lt;j;k++) {
<a name="l00520"></a>00520                                 <span class="keywordflow">if</span> (<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j]==<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][k]) cout &lt;&lt; <span class="stringliteral">"Duplicate edges: ("</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">") and ("</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; k &lt;&lt; <span class="stringliteral">") ["</span> &lt;&lt; <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j] &lt;&lt; <span class="stringliteral">"]"</span> &lt;&lt; endl;
<a name="l00521"></a>00521                         }
<a name="l00522"></a>00522                 }
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 <span class="comment"></span>
<a name="l00526"></a>00526 <span class="comment">/** Constructs the relational table if the edges have been specified. */</span>
<a name="l00527"></a>00527 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00528"></a><a class="code" href="classvoronoicell__base.html#a80520b028fc65ef39b39b24605a0f79">00528</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#a80520b028fc65ef39b39b24605a0f79">voronoicell_base&lt;n_option&gt;::construct_relations</a>() {
<a name="l00529"></a>00529         <span class="keywordtype">int</span> i,j,k,l;
<a name="l00530"></a>00530         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i++) <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[i];j++) {
<a name="l00531"></a>00531                 k=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j];
<a name="l00532"></a>00532                 l=0;
<a name="l00533"></a>00533                 <span class="keywordflow">while</span>(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l]!=i) {
<a name="l00534"></a>00534                         l++;
<a name="l00535"></a>00535                         <span class="keywordflow">if</span> (l==nu[k]) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Relation table construction failed"</span>,<a class="code" href="config_8hh.html#d8e0de9d48da06e86dd87884e4a2d47e">VOROPP_INTERNAL_ERROR</a>);
<a name="l00536"></a>00536                 }
<a name="l00537"></a>00537                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][nu[i]+j]=l;
<a name="l00538"></a>00538         }
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 <span class="comment"></span>
<a name="l00541"></a>00541 <span class="comment">/** Cuts the Voronoi cell by a particle whose center is at a separation of</span>
<a name="l00542"></a>00542 <span class="comment"> * (x,y,z) from the cell center. The value of rsq should be initially set to</span>
<a name="l00543"></a>00543 <span class="comment"> * \f$x^2+y^2+z^2\f$. */</span>
<a name="l00544"></a>00544 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00545"></a><a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">00545</a> <span class="keywordtype">bool</span> <a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">voronoicell_base&lt;n_option&gt;::nplane</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> rsq,<span class="keywordtype">int</span> p_id) {
<a name="l00546"></a>00546         <span class="keywordtype">int</span> count=0,i,j,k,lp=<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>,cp,qp,rp,stack=0;stack2=0;
<a name="l00547"></a>00547         <span class="keywordtype">int</span> us=0,ls=0,qs,iqs,cs,uw,qw,lw;
<a name="l00548"></a>00548         <span class="keywordtype">int</span> *edp,*edd;
<a name="l00549"></a>00549         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> u,l,r,q;<span class="keywordtype">bool</span> complicated_setup=<span class="keyword">false</span>,new_double_edge=<span class="keyword">false</span>,double_edge=<span class="keyword">false</span>;
<a name="l00550"></a>00550         <span class="comment">//Initialize the safe testing routine</span>
<a name="l00551"></a>00551         <a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#fd632ead9ca1cd643accdaf2c5ed7bbd">init</a>(x,y,z,rsq);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553         <span class="comment">//Test approximately sqrt(n)/4 points for their proximity to the plane</span>
<a name="l00554"></a>00554         <span class="comment">//and keep the one which is closest</span>
<a name="l00555"></a>00555         uw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>,u);
<a name="l00556"></a>00556 
<a name="l00557"></a>00557         <span class="comment">// Starting from an initial guess, we now move from vertex to vertex,</span>
<a name="l00558"></a>00558         <span class="comment">// to try and find an edge which intersects the cutting plane,</span>
<a name="l00559"></a>00559         <span class="comment">// or a vertex which is on the plane</span>
<a name="l00560"></a>00560         <span class="keywordflow">try</span> {
<a name="l00561"></a>00561                 <span class="keywordflow">if</span>(uw==1) {
<a name="l00562"></a>00562                         <span class="comment">// The test point is inside the cutting plane.</span>
<a name="l00563"></a>00563                         us=0;
<a name="l00564"></a>00564                         <span class="keywordflow">do</span> {
<a name="l00565"></a>00565                                 lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][us];
<a name="l00566"></a>00566                                 lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l00567"></a>00567                                 <span class="keywordflow">if</span>(l&lt;u) <span class="keywordflow">break</span>;
<a name="l00568"></a>00568                                 us++;
<a name="l00569"></a>00569                         } <span class="keywordflow">while</span> (us&lt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]);
<a name="l00570"></a>00570 
<a name="l00571"></a>00571                         <span class="keywordflow">if</span>(us==<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[up]) {
<a name="l00572"></a>00572                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00573"></a>00573                         }
<a name="l00574"></a>00574                         
<a name="l00575"></a>00575                         ls=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[up]+us];
<a name="l00576"></a>00576                         <span class="keywordflow">while</span>(lw==1) {
<a name="l00577"></a>00577                                 <span class="keywordflow">if</span>(++count&gt;=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>) <span class="keywordflow">throw</span> <span class="keyword">true</span>;
<a name="l00578"></a>00578                                 u=l;up=lp;
<a name="l00579"></a>00579                                 <span class="keywordflow">for</span>(us=0;us&lt;ls;us++) {
<a name="l00580"></a>00580                                         lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][us];
<a name="l00581"></a>00581                                         lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l00582"></a>00582                                         <span class="keywordflow">if</span>(l&lt;u) <span class="keywordflow">break</span>;
<a name="l00583"></a>00583                                 }
<a name="l00584"></a>00584                                 <span class="keywordflow">if</span>(us==ls) {
<a name="l00585"></a>00585                                         us++;
<a name="l00586"></a>00586                                         <span class="keywordflow">while</span>(us&lt;nu[up]) {
<a name="l00587"></a>00587                                                 lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][us];
<a name="l00588"></a>00588                                                 lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l00589"></a>00589                                                 <span class="keywordflow">if</span>(l&lt;u) <span class="keywordflow">break</span>;
<a name="l00590"></a>00590                                                 us++;
<a name="l00591"></a>00591                                         }
<a name="l00592"></a>00592                                         <span class="keywordflow">if</span>(us==nu[up]) {
<a name="l00593"></a>00593                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00594"></a>00594                                         }
<a name="l00595"></a>00595                                 }
<a name="l00596"></a>00596                                 ls=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][nu[up]+us];
<a name="l00597"></a>00597                         }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599                         <span class="comment">// If the last point in the iteration is within the</span>
<a name="l00600"></a>00600                         <span class="comment">// plane, we need to do the complicated setup</span>
<a name="l00601"></a>00601                         <span class="comment">// routine. Otherwise, we use the regular iteration.</span>
<a name="l00602"></a>00602                         <span class="keywordflow">if</span> (lw==0) {
<a name="l00603"></a>00603                                 up=lp;
<a name="l00604"></a>00604                                 complicated_setup=<span class="keyword">true</span>;
<a name="l00605"></a>00605                         } <span class="keywordflow">else</span> complicated_setup=<span class="keyword">false</span>;
<a name="l00606"></a>00606                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uw==-1) {
<a name="l00607"></a>00607                         us=0;
<a name="l00608"></a>00608                         <span class="keywordflow">do</span> {
<a name="l00609"></a>00609                                 qp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][us];
<a name="l00610"></a>00610                                 qw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(qp,q);
<a name="l00611"></a>00611                                 <span class="keywordflow">if</span>(u&lt;q) <span class="keywordflow">break</span>;
<a name="l00612"></a>00612                                 us++;
<a name="l00613"></a>00613                         } <span class="keywordflow">while</span> (us&lt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]);
<a name="l00614"></a>00614                         <span class="keywordflow">if</span>(us==<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[up]) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616                         <span class="keywordflow">while</span>(qw==-1) {
<a name="l00617"></a>00617                                 qs=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[up]+us];
<a name="l00618"></a>00618                                 <span class="keywordflow">if</span>(++count&gt;=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>) <span class="keywordflow">throw</span> <span class="keyword">true</span>;
<a name="l00619"></a>00619                                 u=q;up=qp;
<a name="l00620"></a>00620                                 <span class="keywordflow">for</span>(us=0;us&lt;qs;us++) {
<a name="l00621"></a>00621                                         qp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][us];
<a name="l00622"></a>00622                                         qw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(qp,q);
<a name="l00623"></a>00623                                         <span class="keywordflow">if</span>(u&lt;q) <span class="keywordflow">break</span>;
<a name="l00624"></a>00624                                 }
<a name="l00625"></a>00625                                 <span class="keywordflow">if</span>(us==qs) {
<a name="l00626"></a>00626                                         us++;
<a name="l00627"></a>00627                                         <span class="keywordflow">while</span>(us&lt;nu[up]) {
<a name="l00628"></a>00628                                                 qp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][us];
<a name="l00629"></a>00629                                                 qw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(qp,q);
<a name="l00630"></a>00630                                                 <span class="keywordflow">if</span>(u&lt;q) <span class="keywordflow">break</span>;
<a name="l00631"></a>00631                                                 us++;
<a name="l00632"></a>00632                                         }
<a name="l00633"></a>00633                                         <span class="keywordflow">if</span>(us==nu[up]) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00634"></a>00634                                 }
<a name="l00635"></a>00635                         }
<a name="l00636"></a>00636                         <span class="keywordflow">if</span> (qw==1) {
<a name="l00637"></a>00637                                 lp=up;ls=us;l=u;
<a name="l00638"></a>00638                                 up=qp;us=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[lp][<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[lp]+ls];u=q;
<a name="l00639"></a>00639                                 complicated_setup=<span class="keyword">false</span>;
<a name="l00640"></a>00640                         } <span class="keywordflow">else</span> {
<a name="l00641"></a>00641                                 up=qp;
<a name="l00642"></a>00642                                 complicated_setup=<span class="keyword">true</span>;
<a name="l00643"></a>00643                         }
<a name="l00644"></a>00644                 } <span class="keywordflow">else</span> {
<a name="l00645"></a>00645 
<a name="l00646"></a>00646                         <span class="comment">// Our original test point was on the plane, so we</span>
<a name="l00647"></a>00647                         <span class="comment">// automatically head for the complicated setup</span>
<a name="l00648"></a>00648                         <span class="comment">// routine</span>
<a name="l00649"></a>00649                         complicated_setup=<span class="keyword">true</span>;
<a name="l00650"></a>00650                 }
<a name="l00651"></a>00651         }
<a name="l00652"></a>00652         <span class="keywordflow">catch</span>(<span class="keywordtype">bool</span> except) {
<a name="l00653"></a>00653                 <span class="comment">// This routine is a fall-back, in case floating point errors</span>
<a name="l00654"></a>00654                 <span class="comment">// cause the usual search routine to fail. In the fall-back</span>
<a name="l00655"></a>00655                 <span class="comment">// routine, we just test every edge to find one straddling</span>
<a name="l00656"></a>00656                 <span class="comment">// the plane.</span>
<a name="l00657"></a>00657 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=1</span>
<a name="l00658"></a>00658 <span class="preprocessor"></span>                cerr &lt;&lt; <span class="stringliteral">"Bailed out of convex calculation\n"</span>;
<a name="l00659"></a>00659 <span class="preprocessor">#endif</span>
<a name="l00660"></a>00660 <span class="preprocessor"></span>                qw=1;lw=0;
<a name="l00661"></a>00661                 <span class="keywordflow">for</span>(qp=0;qp&lt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;qp++) {
<a name="l00662"></a>00662                         qw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(qp,q);
<a name="l00663"></a>00663                         <span class="keywordflow">if</span> (qw==1) {
<a name="l00664"></a>00664 
<a name="l00665"></a>00665                                 <span class="comment">// The point is inside the cutting space. Now</span>
<a name="l00666"></a>00666                                 <span class="comment">// see if we can find a neighbor which isn't.</span>
<a name="l00667"></a>00667                                 <span class="keywordflow">for</span>(us=0;us&lt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[qp];us++) {
<a name="l00668"></a>00668                                         lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][us];
<a name="l00669"></a>00669                                         <span class="keywordflow">if</span>(lp&lt;qp) {
<a name="l00670"></a>00670                                                 lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l00671"></a>00671                                                 <span class="keywordflow">if</span> (lw!=1) <span class="keywordflow">break</span>;
<a name="l00672"></a>00672                                         }
<a name="l00673"></a>00673                                 }
<a name="l00674"></a>00674                                 <span class="keywordflow">if</span>(us&lt;nu[qp]) {
<a name="l00675"></a>00675                                         <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=qp;
<a name="l00676"></a>00676                                         <span class="keywordflow">if</span>(lw==0) {
<a name="l00677"></a>00677                                                 complicated_setup=<span class="keyword">true</span>;
<a name="l00678"></a>00678                                         } <span class="keywordflow">else</span> {
<a name="l00679"></a>00679                                                 complicated_setup=<span class="keyword">false</span>;
<a name="l00680"></a>00680                                                 u=q;
<a name="l00681"></a>00681                                                 ls=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][nu[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]+us];
<a name="l00682"></a>00682                                         }
<a name="l00683"></a>00683                                         <span class="keywordflow">break</span>;
<a name="l00684"></a>00684                                 }
<a name="l00685"></a>00685                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (qw==-1) {
<a name="l00686"></a>00686 
<a name="l00687"></a>00687                                 <span class="comment">// The point is outside the cutting space. See</span>
<a name="l00688"></a>00688                                 <span class="comment">// if we can find a neighbor which isn't.</span>
<a name="l00689"></a>00689                                 <span class="keywordflow">for</span>(ls=0;ls&lt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[qp];ls++) {
<a name="l00690"></a>00690                                         <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][ls];
<a name="l00691"></a>00691                                         <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>&lt;qp) {
<a name="l00692"></a>00692                                                 uw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>,u);
<a name="l00693"></a>00693                                                 <span class="keywordflow">if</span> (uw!=-1) <span class="keywordflow">break</span>;
<a name="l00694"></a>00694                                         }
<a name="l00695"></a>00695                                 }
<a name="l00696"></a>00696                                 <span class="keywordflow">if</span>(ls&lt;nu[qp]) {
<a name="l00697"></a>00697                                         <span class="keywordflow">if</span>(uw==0) {
<a name="l00698"></a>00698                                                 <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=qp;
<a name="l00699"></a>00699                                                 complicated_setup=<span class="keyword">true</span>;
<a name="l00700"></a>00700                                         } <span class="keywordflow">else</span> {
<a name="l00701"></a>00701                                                 complicated_setup=<span class="keyword">false</span>;
<a name="l00702"></a>00702                                                 lp=qp;l=q;
<a name="l00703"></a>00703                                                 us=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[lp][nu[lp]+ls];
<a name="l00704"></a>00704                                         }
<a name="l00705"></a>00705                                         <span class="keywordflow">break</span>;
<a name="l00706"></a>00706                                 }
<a name="l00707"></a>00707                         } <span class="keywordflow">else</span> {
<a name="l00708"></a>00708                                 
<a name="l00709"></a>00709                                 <span class="comment">// The point is in the plane, so we just</span>
<a name="l00710"></a>00710                                 <span class="comment">// proceed with the complicated setup routine</span>
<a name="l00711"></a>00711                                 <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=qp;
<a name="l00712"></a>00712                                 complicated_setup=<span class="keyword">true</span>;
<a name="l00713"></a>00713                                 <span class="keywordflow">break</span>;
<a name="l00714"></a>00714                         }
<a name="l00715"></a>00715                 }
<a name="l00716"></a>00716                 <span class="keywordflow">if</span>(qp==p) <span class="keywordflow">return</span> qw==-1?<span class="keyword">true</span>:<span class="keyword">false</span>;
<a name="l00717"></a>00717         }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719         <span class="comment">// We're about to add the first point of the new facet. In either</span>
<a name="l00720"></a>00720         <span class="comment">// routine, we have to add a point, so first check there's space for</span>
<a name="l00721"></a>00721         <span class="comment">// it.</span>
<a name="l00722"></a>00722         <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>==current_vertices) add_memory_vertices();
<a name="l00723"></a>00723 
<a name="l00724"></a>00724         <span class="keywordflow">if</span> (complicated_setup) {
<a name="l00725"></a>00725                 <span class="comment">// The search algorithm found a point which is on the cutting</span>
<a name="l00726"></a>00726                 <span class="comment">// plane. We leave that point in place, and create a new one at</span>
<a name="l00727"></a>00727                 <span class="comment">// the same location.</span>
<a name="l00728"></a>00728                 <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>];
<a name="l00729"></a>00729                 <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>+1];
<a name="l00730"></a>00730                 <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>+2];
<a name="l00731"></a>00731                 
<a name="l00732"></a>00732                 <span class="comment">// Search for a collection of edges of the test vertex which</span>
<a name="l00733"></a>00733                 <span class="comment">// are outside of the cutting space. Begin by testing the</span>
<a name="l00734"></a>00734                 <span class="comment">// zeroth edge.</span>
<a name="l00735"></a>00735                 i=0;
<a name="l00736"></a>00736                 lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][0];
<a name="l00737"></a>00737                 lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l00738"></a>00738                 <span class="keywordflow">if</span>(lw!=-1) {
<a name="l00739"></a>00739 
<a name="l00740"></a>00740                         <span class="comment">// The first edge is either inside the cutting space,</span>
<a name="l00741"></a>00741                         <span class="comment">// or lies within the cutting plane. Test the edges</span>
<a name="l00742"></a>00742                         <span class="comment">// sequentially until we find one that is outside.</span>
<a name="l00743"></a>00743                         rp=lw;
<a name="l00744"></a>00744                         <span class="keywordflow">do</span> {
<a name="l00745"></a>00745                                 i++;
<a name="l00746"></a>00746 
<a name="l00747"></a>00747                                 <span class="comment">// If we reached the last edge with no luck</span>
<a name="l00748"></a>00748                                 <span class="comment">// then all of the vertices are inside</span>
<a name="l00749"></a>00749                                 <span class="comment">// or on the plane, so the cell is completely</span>
<a name="l00750"></a>00750                                 <span class="comment">// deleted</span>
<a name="l00751"></a>00751                                 <span class="keywordflow">if</span> (i==<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00752"></a>00752                                 lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][i];
<a name="l00753"></a>00753                                 lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l00754"></a>00754                         } <span class="keywordflow">while</span> (lw!=-1);
<a name="l00755"></a>00755                         j=i+1;
<a name="l00756"></a>00756 
<a name="l00757"></a>00757                         <span class="comment">// We found an edge outside the cutting space. Keep</span>
<a name="l00758"></a>00758                         <span class="comment">// moving through these edges until we find one that's</span>
<a name="l00759"></a>00759                         <span class="comment">// inside or on the plane.</span>
<a name="l00760"></a>00760                         <span class="keywordflow">while</span>(j&lt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]) {
<a name="l00761"></a>00761                                 lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][j];
<a name="l00762"></a>00762                                 lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l00763"></a>00763                                 <span class="keywordflow">if</span> (lw!=-1) <span class="keywordflow">break</span>;
<a name="l00764"></a>00764                                 j++;
<a name="l00765"></a>00765                         }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767                         <span class="comment">// Compute the number of edges for the new vertex. In</span>
<a name="l00768"></a>00768                         <span class="comment">// general it will be the number of outside edges</span>
<a name="l00769"></a>00769                         <span class="comment">// found, plus two. But we need to recognize the</span>
<a name="l00770"></a>00770                         <span class="comment">// special case when all but one edge is outside, and</span>
<a name="l00771"></a>00771                         <span class="comment">// the remaining one is on the plane. For that case we</span>
<a name="l00772"></a>00772                         <span class="comment">// have to reduce the edge count by one to prevent</span>
<a name="l00773"></a>00773                         <span class="comment">// doubling up.</span>
<a name="l00774"></a>00774                         <span class="keywordflow">if</span>(j==<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[up]&amp;&amp;i==1&amp;&amp;rp==0) {
<a name="l00775"></a>00775                                 <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[up];
<a name="l00776"></a>00776                                 double_edge=<span class="keyword">true</span>;
<a name="l00777"></a>00777                         } <span class="keywordflow">else</span> <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=j-i+2;
<a name="l00778"></a>00778                         k=1;
<a name="l00779"></a>00779 
<a name="l00780"></a>00780                         <span class="comment">// Add memory for the new vertex if needed, and</span>
<a name="l00781"></a>00781                         <span class="comment">// initialize</span>
<a name="l00782"></a>00782                         <span class="keywordflow">while</span> (<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]&gt;=current_vertex_order) add_memory_vorder();
<a name="l00783"></a>00783                         <span class="keywordflow">if</span> (mec[<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]]==mem[<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]]) add_memory(<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]);
<a name="l00784"></a>00784                         neighbor.set_pointer(p,<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]);
<a name="l00785"></a>00785                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[p]=mep[<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]]+(2*<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]+1)*mec[<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]]++;
<a name="l00786"></a>00786                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[p][2*<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]]=p;
<a name="l00787"></a>00787 
<a name="l00788"></a>00788                         <span class="comment">// Copy the edges of the original vertex into the new</span>
<a name="l00789"></a>00789                         <span class="comment">// one. Delete the edges of the original vertex, and</span>
<a name="l00790"></a>00790                         <span class="comment">// update the relational table.</span>
<a name="l00791"></a>00791                         us=cycle_down(i,up);
<a name="l00792"></a>00792                         <span class="keywordflow">while</span>(i&lt;j) {
<a name="l00793"></a>00793                                 qp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][i];
<a name="l00794"></a>00794                                 qs=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][nu[up]+i];
<a name="l00795"></a>00795                                 neighbor.copy(p,k,up,i);
<a name="l00796"></a>00796                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[p][k]=qp;
<a name="l00797"></a>00797                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[p][nu[p]+k]=qs;
<a name="l00798"></a>00798                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][qs]=p;
<a name="l00799"></a>00799                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][nu[qp]+qs]=k;
<a name="l00800"></a>00800                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][i]=-1;
<a name="l00801"></a>00801                                 i++;k++;
<a name="l00802"></a>00802                         }
<a name="l00803"></a>00803                         qs=i==nu[up]?0:i;
<a name="l00804"></a>00804                 } <span class="keywordflow">else</span> {
<a name="l00805"></a>00805 
<a name="l00806"></a>00806                         <span class="comment">// In this case, the zeroth edge is outside the cutting</span>
<a name="l00807"></a>00807                         <span class="comment">// plane. Begin by searching backwards from the last</span>
<a name="l00808"></a>00808                         <span class="comment">// edge until we find an edge which isn't outside.</span>
<a name="l00809"></a>00809                         i=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]-1;
<a name="l00810"></a>00810                         lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][i];
<a name="l00811"></a>00811                         lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l00812"></a>00812                         <span class="keywordflow">while</span>(lw==-1) {
<a name="l00813"></a>00813                                 i--;
<a name="l00814"></a>00814 
<a name="l00815"></a>00815                                 <span class="comment">// If i reaches zero, then we have a point in</span>
<a name="l00816"></a>00816                                 <span class="comment">// the plane all of whose edges are outside</span>
<a name="l00817"></a>00817                                 <span class="comment">// the cutting space, so we just exit</span>
<a name="l00818"></a>00818                                 <span class="keywordflow">if</span> (i==0) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00819"></a>00819                                 lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][i];
<a name="l00820"></a>00820                                 lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l00821"></a>00821                         }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823                         <span class="comment">// Now search forwards from zero</span>
<a name="l00824"></a>00824                         j=1;
<a name="l00825"></a>00825                         qp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][j];
<a name="l00826"></a>00826                         qw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(qp,q);
<a name="l00827"></a>00827                         <span class="keywordflow">while</span>(qw==-1) {
<a name="l00828"></a>00828                                 j++;
<a name="l00829"></a>00829                                 qp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][j];
<a name="l00830"></a>00830                                 qw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(qp,l);
<a name="l00831"></a>00831                         }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833                         <span class="comment">// Compute the number of edges for the new vertex. In</span>
<a name="l00834"></a>00834                         <span class="comment">// general it will be the number of outside edges</span>
<a name="l00835"></a>00835                         <span class="comment">// found, plus two. But we need to recognize the</span>
<a name="l00836"></a>00836                         <span class="comment">// special case when all but one edge is outside, and</span>
<a name="l00837"></a>00837                         <span class="comment">// the remaining one is on the plane. For that case we</span>
<a name="l00838"></a>00838                         <span class="comment">// have to reduce the edge count by one to prevent</span>
<a name="l00839"></a>00839                         <span class="comment">// doubling up.</span>
<a name="l00840"></a>00840                         <span class="keywordflow">if</span> (i==j&amp;&amp;qw==0) {
<a name="l00841"></a>00841                                 double_edge=<span class="keyword">true</span>;
<a name="l00842"></a>00842                                 <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>];
<a name="l00843"></a>00843                         } <span class="keywordflow">else</span> {
<a name="l00844"></a>00844                                 <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]-i+j+1;
<a name="l00845"></a>00845                         }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847                         <span class="comment">// Add memory to store the vertex if it doesn't exist</span>
<a name="l00848"></a>00848                         <span class="comment">// already</span>
<a name="l00849"></a>00849                         k=1;
<a name="l00850"></a>00850                         <span class="keywordflow">while</span>(<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]&gt;=current_vertex_order) add_memory_vorder();
<a name="l00851"></a>00851                         <span class="keywordflow">if</span> (mec[<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]]==mem[<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]]) add_memory(<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]);
<a name="l00852"></a>00852 
<a name="l00853"></a>00853                         <span class="comment">// Copy the edges of the original vertex into the new</span>
<a name="l00854"></a>00854                         <span class="comment">// one. Delete the edges of the original vertex, and</span>
<a name="l00855"></a>00855                         <span class="comment">// update the relational table.</span>
<a name="l00856"></a>00856                         neighbor.set_pointer(p,<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]);
<a name="l00857"></a>00857                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[p]=mep[<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]]+(2*<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]+1)*mec[<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]]++;
<a name="l00858"></a>00858                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[p][2*<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[p]]=p;
<a name="l00859"></a>00859                         us=i++;
<a name="l00860"></a>00860                         <span class="keywordflow">while</span>(i&lt;nu[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]) {
<a name="l00861"></a>00861                                 qp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][i];
<a name="l00862"></a>00862                                 qs=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][nu[up]+i];
<a name="l00863"></a>00863                                 neighbor.copy(p,k,up,i);
<a name="l00864"></a>00864                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[p][k]=qp;
<a name="l00865"></a>00865                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[p][nu[p]+k]=qs;
<a name="l00866"></a>00866                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][qs]=p;
<a name="l00867"></a>00867                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][nu[qp]+qs]=k;
<a name="l00868"></a>00868                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][i]=-1;
<a name="l00869"></a>00869                                 i++;k++;
<a name="l00870"></a>00870                         }
<a name="l00871"></a>00871                         i=0;
<a name="l00872"></a>00872                         <span class="keywordflow">while</span>(i&lt;j) {
<a name="l00873"></a>00873                                 qp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][i];
<a name="l00874"></a>00874                                 qs=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][nu[up]+i];
<a name="l00875"></a>00875                                 neighbor.copy(p,k,up,i);
<a name="l00876"></a>00876                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[p][k]=qp;
<a name="l00877"></a>00877                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[p][nu[p]+k]=qs;
<a name="l00878"></a>00878                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][qs]=p;
<a name="l00879"></a>00879                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][nu[qp]+qs]=k;
<a name="l00880"></a>00880                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][i]=-1;
<a name="l00881"></a>00881                                 i++;k++;
<a name="l00882"></a>00882                         }
<a name="l00883"></a>00883                         qs=j;
<a name="l00884"></a>00884                 }
<a name="l00885"></a>00885                 <span class="keywordflow">if</span> (!double_edge) {
<a name="l00886"></a>00886                         neighbor.copy(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,k,<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>,qs);
<a name="l00887"></a>00887                         neighbor.set(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,0,p_id);
<a name="l00888"></a>00888                 } <span class="keywordflow">else</span> neighbor.copy(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,0,<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>,qs);
<a name="l00889"></a>00889                 
<a name="l00890"></a>00890                 <span class="comment">// Add this point to the auxiliary delete stack</span>
<a name="l00891"></a>00891                 <span class="keywordflow">if</span> (stack2==<a class="code" href="classvoronoicell__base.html#c24fdead81ae8e351c42a950aba416f7">current_delete2_size</a>) add_memory_ds2();
<a name="l00892"></a>00892                 ds2[stack2++]=<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>;
<a name="l00893"></a>00893 
<a name="l00894"></a>00894                 <span class="comment">// Look at the edges on either side of the group that was</span>
<a name="l00895"></a>00895                 <span class="comment">// detected. We're going to commence facet computation by</span>
<a name="l00896"></a>00896                 <span class="comment">// moving along one of them. We are going to end up coming back</span>
<a name="l00897"></a>00897                 <span class="comment">// along the other one.</span>
<a name="l00898"></a>00898                 cs=k;
<a name="l00899"></a>00899                 qp=<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>;q=u;
<a name="l00900"></a>00900                 i=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][us];
<a name="l00901"></a>00901                 us=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]+us];
<a name="l00902"></a>00902                 <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=i;
<a name="l00903"></a>00903                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][2*nu[qp]]=-<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;
<a name="l00904"></a>00904 
<a name="l00905"></a>00905         } <span class="keywordflow">else</span> {
<a name="l00906"></a>00906 
<a name="l00907"></a>00907                 <span class="comment">// The search algorithm found an intersected edge between the</span>
<a name="l00908"></a>00908                 <span class="comment">// points lp and up. Create a new vertex between them which</span>
<a name="l00909"></a>00909                 <span class="comment">// lies on the cutting plane. Since u and l differ by at least</span>
<a name="l00910"></a>00910                 <span class="comment">// the tolerance, this division should never screw up.</span>
<a name="l00911"></a>00911                 <span class="keywordflow">if</span> (stack==<a class="code" href="classvoronoicell__base.html#ba57ebcf710b899119e3e6808bf9ffd3">current_delete_size</a>) add_memory_ds();
<a name="l00912"></a>00912                 ds[stack++]=<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>;
<a name="l00913"></a>00913                 r=1/(u-l);
<a name="l00914"></a>00914                 <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=(<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*lp]*u-<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]*l)*r;
<a name="l00915"></a>00915                 <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1]=(<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*lp+1]*u-<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>+1]*l)*r;
<a name="l00916"></a>00916                 <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2]=(<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*lp+2]*u-<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>+2]*l)*r;
<a name="l00917"></a>00917 
<a name="l00918"></a>00918                 <span class="comment">// This point will always have three edges. Connect one of them</span>
<a name="l00919"></a>00919                 <span class="comment">// to lp.</span>
<a name="l00920"></a>00920                 <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=3;
<a name="l00921"></a>00921                 <span class="keywordflow">if</span> (mec[3]==mem[3]) add_memory(3);
<a name="l00922"></a>00922                 neighbor.set_pointer(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,3);
<a name="l00923"></a>00923                 neighbor.set(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,0,p_id);
<a name="l00924"></a>00924                 neighbor.copy(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,1,<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>,us);
<a name="l00925"></a>00925                 neighbor.copy(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,2,lp,ls);
<a name="l00926"></a>00926                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=mep[3]+7*mec[3]++;
<a name="l00927"></a>00927                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][6]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;
<a name="l00928"></a>00928                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][us]=-1;
<a name="l00929"></a>00929                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[lp][ls]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;
<a name="l00930"></a>00930                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[lp][<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[lp]+ls]=1;
<a name="l00931"></a>00931                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][1]=lp;
<a name="l00932"></a>00932                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]+1]=ls;
<a name="l00933"></a>00933                 cs=2;
<a name="l00934"></a>00934 
<a name="l00935"></a>00935                 <span class="comment">// Set the direction to move in</span>
<a name="l00936"></a>00936                 qs=cycle_up(us,<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>);
<a name="l00937"></a>00937                 qp=<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>;q=u;
<a name="l00938"></a>00938         }
<a name="l00939"></a>00939 
<a name="l00940"></a>00940         <span class="comment">// When the code reaches here, we have initialized the first point, and</span>
<a name="l00941"></a>00941         <span class="comment">// we have a direction for moving it to construct the rest of the facet</span>
<a name="l00942"></a>00942         cp=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;rp=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>++;
<a name="l00943"></a>00943         <span class="keywordflow">while</span>(qp!=<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>||qs!=us) {
<a name="l00944"></a>00944 
<a name="l00945"></a>00945                 <span class="comment">// We're currently tracing round an intersected facet. Keep</span>
<a name="l00946"></a>00946                 <span class="comment">// moving around it until we find a point or edge which</span>
<a name="l00947"></a>00947                 <span class="comment">// intersects the plane.</span>
<a name="l00948"></a>00948                 lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][qs];
<a name="l00949"></a>00949                 lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l00950"></a>00950                 
<a name="l00951"></a>00951                 <span class="keywordflow">if</span> (lw==1) {
<a name="l00952"></a>00952 
<a name="l00953"></a>00953                         <span class="comment">// The point is still in the cutting space. Just add it</span>
<a name="l00954"></a>00954                         <span class="comment">// to the delete stack and keep moving.</span>
<a name="l00955"></a>00955                         <span class="keywordflow">if</span> (stack==<a class="code" href="classvoronoicell__base.html#ba57ebcf710b899119e3e6808bf9ffd3">current_delete_size</a>) add_memory_ds();
<a name="l00956"></a>00956                         qs=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[qp]+qs],lp);
<a name="l00957"></a>00957                         qp=lp;
<a name="l00958"></a>00958                         q=l;
<a name="l00959"></a>00959                         ds[stack++]=qp;
<a name="l00960"></a>00960                 
<a name="l00961"></a>00961                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lw==-1) {
<a name="l00962"></a>00962 
<a name="l00963"></a>00963                         <span class="comment">// The point is outside of the cutting space, so we've</span>
<a name="l00964"></a>00964                         <span class="comment">// found an intersected edge. Introduce a regular point</span>
<a name="l00965"></a>00965                         <span class="comment">// at the point of intersection. Connect it to the</span>
<a name="l00966"></a>00966                         <span class="comment">// point we just tested. Also connect it to the previous</span>
<a name="l00967"></a>00967                         <span class="comment">// new point in the facet we're constructing.</span>
<a name="l00968"></a>00968                         <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>==current_vertices) add_memory_vertices();
<a name="l00969"></a>00969                         r=1/(q-l);
<a name="l00970"></a>00970                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=(<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*lp]*q-<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*qp]*l)*r;
<a name="l00971"></a>00971                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1]=(<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*lp+1]*q-<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*qp+1]*l)*r;
<a name="l00972"></a>00972                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2]=(<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*lp+2]*q-<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*qp+2]*l)*r;
<a name="l00973"></a>00973                         <a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=3;
<a name="l00974"></a>00974                         <span class="keywordflow">if</span> (mec[3]==mem[3]) add_memory(3);
<a name="l00975"></a>00975                         ls=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][qs+<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[qp]];
<a name="l00976"></a>00976                         neighbor.set_pointer(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,3);
<a name="l00977"></a>00977                         neighbor.set(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,0,p_id);
<a name="l00978"></a>00978                         neighbor.copy(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,1,qp,qs);
<a name="l00979"></a>00979                         neighbor.copy(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,2,lp,ls);
<a name="l00980"></a>00980                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=mep[3]+7*mec[3]++;
<a name="l00981"></a>00981                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][6]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;
<a name="l00982"></a>00982                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[lp][ls]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;
<a name="l00983"></a>00983                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[lp][nu[lp]+ls]=1;
<a name="l00984"></a>00984                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][1]=lp;
<a name="l00985"></a>00985                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][0]=cp;
<a name="l00986"></a>00986                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]+1]=ls;
<a name="l00987"></a>00987                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]]=cs;
<a name="l00988"></a>00988                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[cp][cs]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;
<a name="l00989"></a>00989                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[cp][nu[cp]+cs]=0;
<a name="l00990"></a>00990                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][qs]=-1;
<a name="l00991"></a>00991                         qs=cycle_up(qs,qp);
<a name="l00992"></a>00992                         cp=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>++;
<a name="l00993"></a>00993                         cs=2;
<a name="l00994"></a>00994                 } <span class="keywordflow">else</span> {
<a name="l00995"></a>00995 
<a name="l00996"></a>00996                         <span class="comment">// We've found a point which is on the cutting plane.</span>
<a name="l00997"></a>00997                         <span class="comment">// We're going to introduce a new point right here, but</span>
<a name="l00998"></a>00998                         <span class="comment">// first we need to figure out the number of edges it</span>
<a name="l00999"></a>00999                         <span class="comment">// has.</span>
<a name="l01000"></a>01000                         <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>==current_vertices) add_memory_vertices();
<a name="l01001"></a>01001                         
<a name="l01002"></a>01002                         <span class="comment">// If the previous vertex detected a double edge, our</span>
<a name="l01003"></a>01003                         <span class="comment">// new vertex will have one less edge.</span>
<a name="l01004"></a>01004                         k=double_edge?0:1;
<a name="l01005"></a>01005                         qs=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[qp]+qs];
<a name="l01006"></a>01006                         qp=lp;
<a name="l01007"></a>01007                         iqs=qs;
<a name="l01008"></a>01008 
<a name="l01009"></a>01009                         <span class="comment">// Start testing the edges of the current point until</span>
<a name="l01010"></a>01010                         <span class="comment">// we find one which isn't outside the cutting space</span>
<a name="l01011"></a>01011                         <span class="keywordflow">do</span> {
<a name="l01012"></a>01012                                 k++;
<a name="l01013"></a>01013                                 qs=cycle_up(qs,qp);
<a name="l01014"></a>01014                                 lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][qs];
<a name="l01015"></a>01015                                 lw=<a class="code" href="classvoronoicell__base.html#2b882537bc65115644105304199ee412">sure</a>.<a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">test</a>(lp,l);
<a name="l01016"></a>01016                         } <span class="keywordflow">while</span> (lw==-1);
<a name="l01017"></a>01017                         
<a name="l01018"></a>01018                         <span class="comment">// Now we need to find out whether this marginal vertex</span>
<a name="l01019"></a>01019                         <span class="comment">// we are on has been visited before, because if that's</span>
<a name="l01020"></a>01020                         <span class="comment">// the case, we need to add vertices to the existing</span>
<a name="l01021"></a>01021                         <span class="comment">// new vertex, rather than creating a fresh one. We also</span>
<a name="l01022"></a>01022                         <span class="comment">// need to figure out whether we're in a case where we</span>
<a name="l01023"></a>01023                         <span class="comment">// might be creating a duplicate edge.</span>
<a name="l01024"></a>01024                         j=-<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][2*nu[qp]];
<a name="l01025"></a>01025                         <span class="keywordflow">if</span>(qp==<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>&amp;&amp;qs==us) {
<a name="l01026"></a>01026 
<a name="l01027"></a>01027                                 <span class="comment">// If we're heading into the final part of the</span>
<a name="l01028"></a>01028                                 <span class="comment">// new facet, then we never worry about the</span>
<a name="l01029"></a>01029                                 <span class="comment">// duplicate edge calculation.</span>
<a name="l01030"></a>01030                                 new_double_edge=<span class="keyword">false</span>;
<a name="l01031"></a>01031                                 <span class="keywordflow">if</span>(j&gt;0) k+=nu[j];
<a name="l01032"></a>01032                         } <span class="keywordflow">else</span> {
<a name="l01033"></a>01033                                 <span class="keywordflow">if</span> (j&gt;0) {
<a name="l01034"></a>01034 
<a name="l01035"></a>01035                                         <span class="comment">// This vertex was visited before, so</span>
<a name="l01036"></a>01036                                         <span class="comment">// count those vertices to the ones we</span>
<a name="l01037"></a>01037                                         <span class="comment">// already have.</span>
<a name="l01038"></a>01038                                         k+=nu[j];
<a name="l01039"></a>01039                                         
<a name="l01040"></a>01040                                         <span class="comment">// The only time when we might make a</span>
<a name="l01041"></a>01041                                         <span class="comment">// duplicate edge is if the point we're</span>
<a name="l01042"></a>01042                                         <span class="comment">// going to move to next is also a</span>
<a name="l01043"></a>01043                                         <span class="comment">// marginal point, so test for that</span>
<a name="l01044"></a>01044                                         <span class="comment">// first.</span>
<a name="l01045"></a>01045                                         <span class="keywordflow">if</span>(lw==0) {
<a name="l01046"></a>01046 
<a name="l01047"></a>01047                                                 <span class="comment">// Now see whether this marginal point</span>
<a name="l01048"></a>01048                                                 <span class="comment">// has been visited before.</span>
<a name="l01049"></a>01049                                                 i=-<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[lp][2*nu[lp]];
<a name="l01050"></a>01050                                                 <span class="keywordflow">if</span>(i&gt;0) {
<a name="l01051"></a>01051 
<a name="l01052"></a>01052                                                         <span class="comment">// Now see if the last edge of that other</span>
<a name="l01053"></a>01053                                                         <span class="comment">// marginal point actually ends up here.</span>
<a name="l01054"></a>01054                                                         <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][nu[i]-1]==j) {
<a name="l01055"></a>01055                                                                 new_double_edge=<span class="keyword">true</span>;
<a name="l01056"></a>01056                                                                 k-=1;
<a name="l01057"></a>01057                                                         } <span class="keywordflow">else</span> new_double_edge=<span class="keyword">false</span>;
<a name="l01058"></a>01058                                                 } <span class="keywordflow">else</span> {
<a name="l01059"></a>01059 
<a name="l01060"></a>01060                                                         <span class="comment">// That marginal point hasn't been visited</span>
<a name="l01061"></a>01061                                                         <span class="comment">// before, so we probably don't have to worry</span>
<a name="l01062"></a>01062                                                         <span class="comment">// about duplicate edges, except in the</span>
<a name="l01063"></a>01063                                                         <span class="comment">// case when that's the way into the end</span>
<a name="l01064"></a>01064                                                         <span class="comment">// of the facet, because that way always creates</span>
<a name="l01065"></a>01065                                                         <span class="comment">// an edge.</span>
<a name="l01066"></a>01066                                                         <span class="keywordflow">if</span> (j==rp&amp;&amp;lp==<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>&amp;&amp;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][nu[qp]+qs]==us) {
<a name="l01067"></a>01067                                                                 new_double_edge=<span class="keyword">true</span>;
<a name="l01068"></a>01068                                                                 k-=1;
<a name="l01069"></a>01069                                                         } <span class="keywordflow">else</span> new_double_edge=<span class="keyword">false</span>;
<a name="l01070"></a>01070                                                 }
<a name="l01071"></a>01071                                         } <span class="keywordflow">else</span> new_double_edge=<span class="keyword">false</span>;
<a name="l01072"></a>01072                                 } <span class="keywordflow">else</span> {
<a name="l01073"></a>01073 
<a name="l01074"></a>01074                                         <span class="comment">// The vertex hasn't been visited</span>
<a name="l01075"></a>01075                                         <span class="comment">// before, but let's see if it's</span>
<a name="l01076"></a>01076                                         <span class="comment">// marginal</span>
<a name="l01077"></a>01077                                         <span class="keywordflow">if</span>(lw==0) {
<a name="l01078"></a>01078 
<a name="l01079"></a>01079                                                 <span class="comment">// If it is, we need to check</span>
<a name="l01080"></a>01080                                                 <span class="comment">// for the case that it's a</span>
<a name="l01081"></a>01081                                                 <span class="comment">// small branch, and that we're</span>
<a name="l01082"></a>01082                                                 <span class="comment">// heading right back to where</span>
<a name="l01083"></a>01083                                                 <span class="comment">// we came from</span>
<a name="l01084"></a>01084                                                 i=-<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[lp][2*nu[lp]];
<a name="l01085"></a>01085                                                 <span class="keywordflow">if</span>(i==cp) {
<a name="l01086"></a>01086                                                         new_double_edge=<span class="keyword">true</span>;
<a name="l01087"></a>01087                                                         k-=1;
<a name="l01088"></a>01088                                                 } <span class="keywordflow">else</span> new_double_edge=<span class="keyword">false</span>;
<a name="l01089"></a>01089                                         } <span class="keywordflow">else</span> new_double_edge=<span class="keyword">false</span>;
<a name="l01090"></a>01090                                 }
<a name="l01091"></a>01091                         }
<a name="l01092"></a>01092                         
<a name="l01093"></a>01093                         <span class="comment">// k now holds the number of edges of the new vertex</span>
<a name="l01094"></a>01094                         <span class="comment">// we are forming. Add memory for it if it doesn't exist</span>
<a name="l01095"></a>01095                         <span class="comment">// already.</span>
<a name="l01096"></a>01096                         <span class="keywordflow">while</span>(k&gt;=current_vertex_order) add_memory_vorder();
<a name="l01097"></a>01097                         <span class="keywordflow">if</span> (mec[k]==mem[k]) add_memory(k);
<a name="l01098"></a>01098                         
<a name="l01099"></a>01099                         <span class="comment">// Now create a new vertex with order k, or augment</span>
<a name="l01100"></a>01100                         <span class="comment">// the existing one</span>
<a name="l01101"></a>01101                         <span class="keywordflow">if</span>(j&gt;0) {
<a name="l01102"></a>01102 
<a name="l01103"></a>01103                                 <span class="comment">// If we're augmenting a vertex but we don't</span>
<a name="l01104"></a>01104                                 <span class="comment">// actually need any more edges, just skip this</span>
<a name="l01105"></a>01105                                 <span class="comment">// routine to avoid memory confusion</span>
<a name="l01106"></a>01106                                 <span class="keywordflow">if</span>(nu[j]!=k) {
<a name="l01107"></a>01107                                         <span class="comment">// Allocate memory and copy the edges</span>
<a name="l01108"></a>01108                                         <span class="comment">// of the previous instance into it</span>
<a name="l01109"></a>01109                                         neighbor.set_aux1(k);
<a name="l01110"></a>01110                                         edp=mep[k]+(2*k+1)*mec[k]++;
<a name="l01111"></a>01111                                         i=0;
<a name="l01112"></a>01112                                         <span class="keywordflow">while</span>(i&lt;nu[j]) {
<a name="l01113"></a>01113                                                 neighbor.copy_aux1(j,i);
<a name="l01114"></a>01114                                                 edp[i]=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][i];
<a name="l01115"></a>01115                                                 edp[k+i]=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][nu[j]+i];
<a name="l01116"></a>01116                                                 i++;
<a name="l01117"></a>01117                                         }
<a name="l01118"></a>01118                                         edp[2*k]=j;
<a name="l01119"></a>01119 
<a name="l01120"></a>01120                                         <span class="comment">// Remove the previous instance with</span>
<a name="l01121"></a>01121                                         <span class="comment">// fewer vertices from the memory</span>
<a name="l01122"></a>01122                                         <span class="comment">// structure</span>
<a name="l01123"></a>01123                                         edd=mep[nu[j]]+(2*nu[j]+1)*--mec[nu[j]];
<a name="l01124"></a>01124                                         <span class="keywordflow">if</span>(edd!=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j]) {
<a name="l01125"></a>01125                                                 <span class="keywordflow">for</span>(lw=0;lw&lt;=2*nu[j];lw++) <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][lw]=edd[lw];
<a name="l01126"></a>01126                                                 neighbor.set_aux2_copy(j,nu[j]);
<a name="l01127"></a>01127                                                 neighbor.copy_pointer(edd[2*nu[j]],j);
<a name="l01128"></a>01128                                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[edd[2*nu[j]]]=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j];
<a name="l01129"></a>01129                                         }
<a name="l01130"></a>01130                                         neighbor.set_to_aux1(j);
<a name="l01131"></a>01131                                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j]=edp;
<a name="l01132"></a>01132                                 } <span class="keywordflow">else</span> i=nu[j];
<a name="l01133"></a>01133                         } <span class="keywordflow">else</span> {
<a name="l01134"></a>01134 
<a name="l01135"></a>01135                                 <span class="comment">// Allocate a new vertex of order k</span>
<a name="l01136"></a>01136                                 neighbor.set_pointer(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,k);
<a name="l01137"></a>01137                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=mep[k]+(2*k+1)*mec[k]++;
<a name="l01138"></a>01138                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][2*k]=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;
<a name="l01139"></a>01139                                 <span class="keywordflow">if</span> (stack2==<a class="code" href="classvoronoicell__base.html#c24fdead81ae8e351c42a950aba416f7">current_delete2_size</a>) add_memory_ds2();
<a name="l01140"></a>01140                                 ds2[stack2++]=qp;
<a name="l01141"></a>01141                                 <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*qp];
<a name="l01142"></a>01142                                 <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*qp+1];
<a name="l01143"></a>01143                                 <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*qp+2];
<a name="l01144"></a>01144                                 ed[qp][2*nu[qp]]=-<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;
<a name="l01145"></a>01145                                 j=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>++;
<a name="l01146"></a>01146                                 i=0;
<a name="l01147"></a>01147                         }
<a name="l01148"></a>01148                         nu[j]=k;
<a name="l01149"></a>01149 
<a name="l01150"></a>01150                         <span class="comment">// Unless the previous case was a double edge, connect</span>
<a name="l01151"></a>01151                         <span class="comment">// the first available edge of the new vertex to the</span>
<a name="l01152"></a>01152                         <span class="comment">// last one in the facet</span>
<a name="l01153"></a>01153                         <span class="keywordflow">if</span> (!double_edge) {
<a name="l01154"></a>01154                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][i]=cp;
<a name="l01155"></a>01155                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][nu[j]+i]=cs;
<a name="l01156"></a>01156                                 neighbor.set(j,i,p_id);
<a name="l01157"></a>01157                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[cp][cs]=j;
<a name="l01158"></a>01158                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[cp][nu[cp]+cs]=i;
<a name="l01159"></a>01159                                 i++;
<a name="l01160"></a>01160                         }
<a name="l01161"></a>01161 
<a name="l01162"></a>01162                         <span class="comment">// Copy in the edges of the underlying vertex,</span>
<a name="l01163"></a>01163                         <span class="comment">// and do one less if this was a double edge</span>
<a name="l01164"></a>01164                         qs=iqs;
<a name="l01165"></a>01165                         <span class="keywordflow">while</span>(i&lt;(new_double_edge?k:k-1)) {
<a name="l01166"></a>01166                                 qs=cycle_up(qs,qp);
<a name="l01167"></a>01167                                 lp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][qs];ls=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][nu[qp]+qs];
<a name="l01168"></a>01168                                 neighbor.copy(j,i,qp,qs);
<a name="l01169"></a>01169                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][i]=lp;
<a name="l01170"></a>01170                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][nu[j]+i]=ls;
<a name="l01171"></a>01171                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[lp][ls]=j;
<a name="l01172"></a>01172                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[lp][nu[lp]+ls]=i;
<a name="l01173"></a>01173                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][qs]=-1;
<a name="l01174"></a>01174                                 i++;
<a name="l01175"></a>01175                         }
<a name="l01176"></a>01176                         qs=cycle_up(qs,qp);
<a name="l01177"></a>01177                         cs=i;
<a name="l01178"></a>01178                         cp=j;
<a name="l01179"></a>01179                         neighbor.copy(j,new_double_edge?0:cs,qp,qs);
<a name="l01180"></a>01180 
<a name="l01181"></a>01181                         <span class="comment">// Update the double_edge flag, to pass it</span>
<a name="l01182"></a>01182                         <span class="comment">// to the next instance of this routine</span>
<a name="l01183"></a>01183                         double_edge=new_double_edge;
<a name="l01184"></a>01184                 }
<a name="l01185"></a>01185         }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187         <span class="comment">// Connect the final created vertex to the initial one</span>
<a name="l01188"></a>01188         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[cp][cs]=rp;
<a name="l01189"></a>01189         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[rp][0]=cp;
<a name="l01190"></a>01190         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[cp][<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[cp]+cs]=0;
<a name="l01191"></a>01191         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[rp][nu[rp]+0]=cs;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193         <span class="comment">// Delete points: first, remove any duplicates</span>
<a name="l01194"></a>01194         i=0;
<a name="l01195"></a>01195         <span class="keywordflow">while</span>(i&lt;stack) {
<a name="l01196"></a>01196                 j=ds[i];
<a name="l01197"></a>01197                 <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][nu[j]]!=-1) {
<a name="l01198"></a>01198                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][nu[j]]=-1;
<a name="l01199"></a>01199                         i++;
<a name="l01200"></a>01200                 } <span class="keywordflow">else</span> ds[i]=ds[--stack];
<a name="l01201"></a>01201         }
<a name="l01202"></a>01202         
<a name="l01203"></a>01203         <span class="comment">// Add the points in the auxiliary delete stack,</span>
<a name="l01204"></a>01204         <span class="comment">// and reset their back pointers</span>
<a name="l01205"></a>01205         <span class="keywordflow">for</span>(i=0;i&lt;stack2;i++) {
<a name="l01206"></a>01206                 j=ds2[i];
<a name="l01207"></a>01207                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][2*nu[j]]=j;
<a name="l01208"></a>01208                 <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][nu[j]]!=-1) {
<a name="l01209"></a>01209                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][nu[j]]=-1;
<a name="l01210"></a>01210                         <span class="keywordflow">if</span> (stack==<a class="code" href="classvoronoicell__base.html#ba57ebcf710b899119e3e6808bf9ffd3">current_delete_size</a>) add_memory_ds();
<a name="l01211"></a>01211                         ds[stack++]=j;
<a name="l01212"></a>01212                 }
<a name="l01213"></a>01213         }
<a name="l01214"></a>01214         
<a name="l01215"></a>01215         <span class="comment">// Scan connections and add in extras</span>
<a name="l01216"></a>01216         <span class="keywordflow">for</span>(i=0;i&lt;stack;i++) {
<a name="l01217"></a>01217                 cp=ds[i];
<a name="l01218"></a>01218                 <span class="keywordflow">for</span>(j=0;j&lt;nu[cp];j++) {
<a name="l01219"></a>01219                         qp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[cp][j];
<a name="l01220"></a>01220                         <span class="keywordflow">if</span>(qp!=-1) {
<a name="l01221"></a>01221                                 <span class="keywordflow">if</span> (<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][nu[qp]]!=-1) {
<a name="l01222"></a>01222                                         <span class="keywordflow">if</span> (stack==<a class="code" href="classvoronoicell__base.html#ba57ebcf710b899119e3e6808bf9ffd3">current_delete_size</a>) add_memory_ds();
<a name="l01223"></a>01223                                         ds[stack++]=qp;
<a name="l01224"></a>01224                                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[qp][nu[qp]]=-1;
<a name="l01225"></a>01225                                 }
<a name="l01226"></a>01226                         }
<a name="l01227"></a>01227                 }
<a name="l01228"></a>01228         }
<a name="l01229"></a>01229         <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=0;
<a name="l01230"></a>01230 
<a name="l01231"></a>01231         <span class="comment">// Delete them from the array structure</span>
<a name="l01232"></a>01232         <span class="keywordflow">while</span>(stack&gt;0) {
<a name="l01233"></a>01233                 <span class="keywordflow">while</span>(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[--<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]]==-1) {
<a name="l01234"></a>01234                         j=nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01235"></a>01235                         mec[j]--;
<a name="l01236"></a>01236                         <span class="keywordflow">for</span>(i=0;i&lt;=2*j;i++) <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][i]=(mep[j]+(2*j+1)*mec[j])[i];
<a name="l01237"></a>01237                         neighbor.set_aux2_copy(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>,j);
<a name="l01238"></a>01238                         neighbor.copy_pointer(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][2*j],<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>);
<a name="l01239"></a>01239                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][2*j]]=ed[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01240"></a>01240                 }
<a name="l01241"></a>01241                 <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=ds[--stack];
<a name="l01242"></a>01242                 <span class="keywordflow">if</span> (<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>&lt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>) {
<a name="l01243"></a>01243 
<a name="l01244"></a>01244                         <span class="comment">// Vertex management</span>
<a name="l01245"></a>01245                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01246"></a>01246                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>+1]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1];
<a name="l01247"></a>01247                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>+2]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2];
<a name="l01248"></a>01248 
<a name="l01249"></a>01249                         <span class="comment">// Memory management</span>
<a name="l01250"></a>01250                         j=nu[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>];
<a name="l01251"></a>01251                         mec[j]--;
<a name="l01252"></a>01252                         <span class="keywordflow">for</span>(i=0;i&lt;=2*j;i++) <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][i]=(mep[j]+(2*j+1)*mec[j])[i];
<a name="l01253"></a>01253                         neighbor.set_aux2_copy(<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>,j);
<a name="l01254"></a>01254                         neighbor.copy_pointer(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][2*j],<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>);
<a name="l01255"></a>01255                         neighbor.copy_pointer(<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>,<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>);
<a name="l01256"></a>01256                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][2*j]]=ed[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>];
<a name="l01257"></a>01257 
<a name="l01258"></a>01258                         <span class="comment">// Edge management</span>
<a name="l01259"></a>01259                         ed[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]=ed[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01260"></a>01260                         nu[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]=nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01261"></a>01261                         <span class="keywordflow">for</span>(i=0;i&lt;nu[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>];i++) {
<a name="l01262"></a>01262                                 <span class="keywordflow">if</span> (ed[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][i]==-1)
<a name="l01263"></a>01263                                         <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Dangling edge found"</span>,<a class="code" href="config_8hh.html#d8e0de9d48da06e86dd87884e4a2d47e">VOROPP_INTERNAL_ERROR</a>);
<a name="l01264"></a>01264                                 ed[ed[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][i]][ed[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][nu[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]+i]]=<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>;
<a name="l01265"></a>01265                         }
<a name="l01266"></a>01266                         ed[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][2*nu[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]]=<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>;
<a name="l01267"></a>01267                 } <span class="keywordflow">else</span> <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>++;
<a name="l01268"></a>01268         }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270         <span class="comment">// Check for any vertices of zero order</span>
<a name="l01271"></a>01271         <span class="keywordflow">if</span> (mec[0]&gt;0) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Zero order vertex formed"</span>,<a class="code" href="config_8hh.html#d8e0de9d48da06e86dd87884e4a2d47e">VOROPP_INTERNAL_ERROR</a>);
<a name="l01272"></a>01272 
<a name="l01273"></a>01273         <span class="comment">// Collapse any order 2 vertices and exit</span>
<a name="l01274"></a>01274         <span class="keywordflow">return</span> collapse_order2();
<a name="l01275"></a>01275 }
<a name="l01276"></a>01276 <span class="comment"></span>
<a name="l01277"></a>01277 <span class="comment">/** During the creation of a new facet in the plane routine, it is possible</span>
<a name="l01278"></a>01278 <span class="comment"> * that some order two vertices may arise. This routine removes them.</span>
<a name="l01279"></a>01279 <span class="comment"> * Suppose an order two vertex joins c and d. If there's a edge between</span>
<a name="l01280"></a>01280 <span class="comment"> * c and d already, then the order two vertex is just removed; otherwise,</span>
<a name="l01281"></a>01281 <span class="comment"> * the order two vertex is removed and c and d are joined together directly.</span>
<a name="l01282"></a>01282 <span class="comment"> * It is possible this process will create order two or order one vertices,</span>
<a name="l01283"></a>01283 <span class="comment"> * and the routine is continually run until all of them are removed.</span>
<a name="l01284"></a>01284 <span class="comment"> * \return false if the vertex removal was unsuccessful, indicative of</span>
<a name="l01285"></a>01285 <span class="comment"> * the cell reducing to zero volume and disappearing; true if the vertex</span>
<a name="l01286"></a>01286 <span class="comment"> * removal was successful. */</span>
<a name="l01287"></a>01287 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01288"></a>01288 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::collapse_order2</a>() {
<a name="l01289"></a>01289         <span class="keywordflow">if</span>(!collapse_order1()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01290"></a>01290         <span class="keywordtype">int</span> a,b,i,j,k,l;
<a name="l01291"></a>01291         <span class="keywordflow">while</span>(mec[2]&gt;0) {
<a name="l01292"></a>01292 
<a name="l01293"></a>01293                 <span class="comment">// Pick a order 2 vertex and read in its edges</span>
<a name="l01294"></a>01294                 i=--mec[2];
<a name="l01295"></a>01295                 j=mep[2][5*i];k=mep[2][5*i+1];
<a name="l01296"></a>01296                 <span class="keywordflow">if</span> (j==k) {
<a name="l01297"></a>01297 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=1                  </span>
<a name="l01298"></a>01298 <span class="preprocessor"></span>                        cerr &lt;&lt; <span class="stringliteral">"Order two vertex joins itself"</span> &lt;&lt; endl;
<a name="l01299"></a>01299 <span class="preprocessor">#endif                  </span>
<a name="l01300"></a>01300 <span class="preprocessor"></span>                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01301"></a>01301                 }
<a name="l01302"></a>01302 
<a name="l01303"></a>01303                 <span class="comment">// Scan the edges of j to see if joins k</span>
<a name="l01304"></a>01304                 <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[j];l++) {
<a name="l01305"></a>01305                         <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][l]==k) <span class="keywordflow">break</span>;
<a name="l01306"></a>01306                 }
<a name="l01307"></a>01307 
<a name="l01308"></a>01308                 <span class="comment">// If j doesn't already join k, join them together.</span>
<a name="l01309"></a>01309                 <span class="comment">// Otherwise delete the connection to the current</span>
<a name="l01310"></a>01310                 <span class="comment">// vertex from j and k.</span>
<a name="l01311"></a>01311                 a=mep[2][5*i+2];b=mep[2][5*i+3];i=mep[2][5*i+4];
<a name="l01312"></a>01312                 <span class="keywordflow">if</span>(l==nu[j]) {
<a name="l01313"></a>01313                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][a]=k;
<a name="l01314"></a>01314                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][b]=j;
<a name="l01315"></a>01315                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][nu[j]+a]=b;
<a name="l01316"></a>01316                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][nu[k]+b]=a;
<a name="l01317"></a>01317                 } <span class="keywordflow">else</span> {
<a name="l01318"></a>01318                         <span class="keywordflow">if</span> (!delete_connection(j,a,<span class="keyword">false</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01319"></a>01319                         <span class="keywordflow">if</span> (!delete_connection(k,b,<span class="keyword">true</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01320"></a>01320                 }
<a name="l01321"></a>01321 
<a name="l01322"></a>01322                 <span class="comment">// Compact the memory</span>
<a name="l01323"></a>01323                 --<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;
<a name="l01324"></a>01324                 <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>==i) <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=0;
<a name="l01325"></a>01325                 <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>!=i) {
<a name="l01326"></a>01326                         <span class="keywordflow">if</span> (<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>==<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>) <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=i;
<a name="l01327"></a>01327                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01328"></a>01328                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+1]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1];
<a name="l01329"></a>01329                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+2]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2];
<a name="l01330"></a>01330                         <span class="keywordflow">for</span>(k=0;k&lt;nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];k++) <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][k]][<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]+k]]=i;
<a name="l01331"></a>01331                         neighbor.copy_pointer(i,<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>);
<a name="l01332"></a>01332                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i]=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01333"></a>01333                         nu[i]=nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01334"></a>01334                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][2*nu[i]]=i;
<a name="l01335"></a>01335                 }
<a name="l01336"></a>01336 
<a name="l01337"></a>01337                 <span class="comment">// Collapse any order 1 vertices if they were created</span>
<a name="l01338"></a>01338                 <span class="keywordflow">if</span>(!collapse_order1()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01339"></a>01339         }
<a name="l01340"></a>01340         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01341"></a>01341 }
<a name="l01342"></a>01342 <span class="comment"></span>
<a name="l01343"></a>01343 <span class="comment">/** Order one vertices can potentially be created during the order two collapse</span>
<a name="l01344"></a>01344 <span class="comment"> * routine. This routine keeps removing them until there are none left.</span>
<a name="l01345"></a>01345 <span class="comment"> * \return false if the vertex removal was unsuccessful, indicative of</span>
<a name="l01346"></a>01346 <span class="comment"> * the cell having zero volume and disappearing; true if the vertex removal</span>
<a name="l01347"></a>01347 <span class="comment"> * was successful. */</span>
<a name="l01348"></a>01348 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01349"></a>01349 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::collapse_order1</a>() {
<a name="l01350"></a>01350         <span class="keywordtype">int</span> i,j,k;
<a name="l01351"></a>01351         <span class="keywordflow">while</span>(mec[1]&gt;0) {
<a name="l01352"></a>01352                 <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=0;
<a name="l01353"></a>01353 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=1          </span>
<a name="l01354"></a>01354 <span class="preprocessor"></span>                cerr &lt;&lt; <span class="stringliteral">"Order one collapse"</span> &lt;&lt; endl;
<a name="l01355"></a>01355 <span class="preprocessor">#endif</span>
<a name="l01356"></a>01356 <span class="preprocessor"></span>                i=--mec[1];
<a name="l01357"></a>01357                 j=mep[1][3*i];k=mep[1][3*i+1];
<a name="l01358"></a>01358                 i=mep[1][3*i+2];
<a name="l01359"></a>01359                 <span class="keywordflow">if</span>(!delete_connection(j,k,<span class="keyword">false</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01360"></a>01360                 --<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;
<a name="l01361"></a>01361                 <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>==i) <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=0;
<a name="l01362"></a>01362                 <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>!=i) {
<a name="l01363"></a>01363                         <span class="keywordflow">if</span> (<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>==<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>) <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=i;
<a name="l01364"></a>01364                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01365"></a>01365                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+1]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+1];
<a name="l01366"></a>01366                         <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+2]=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>+2];
<a name="l01367"></a>01367                         <span class="keywordflow">for</span>(k=0;k&lt;nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];k++) <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][k]][<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>][nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>]+k]]=i;
<a name="l01368"></a>01368                         neighbor.copy_pointer(i,<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>);
<a name="l01369"></a>01369                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i]=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01370"></a>01370                         nu[i]=nu[<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>];
<a name="l01371"></a>01371                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][2*nu[i]]=i;
<a name="l01372"></a>01372                 }
<a name="l01373"></a>01373         }
<a name="l01374"></a>01374         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01375"></a>01375 }
<a name="l01376"></a>01376 <span class="comment"></span>
<a name="l01377"></a>01377 <span class="comment">/** This routine deletes the kth edge of vertex j and reorganizes the memory.</span>
<a name="l01378"></a>01378 <span class="comment"> * If the neighbor computation is enabled, we also have to supply an</span>
<a name="l01379"></a>01379 <span class="comment"> * handedness flag to decide whether to preserve the plane on the left</span>
<a name="l01380"></a>01380 <span class="comment"> * or right of the connection.</span>
<a name="l01381"></a>01381 <span class="comment"> * \return false if a zero order vertex was formed, indicative of the cell</span>
<a name="l01382"></a>01382 <span class="comment"> * disappearing; true if the vertex removal was successful. */</span>
<a name="l01383"></a>01383 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01384"></a>01384 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::delete_connection</a>(<span class="keywordtype">int</span> j,<span class="keywordtype">int</span> k,<span class="keywordtype">bool</span> hand) {
<a name="l01385"></a>01385         <span class="keywordtype">int</span> q=hand?k:cycle_up(k,j);
<a name="l01386"></a>01386         <span class="keywordtype">int</span> i=nu[j]-1,l,*edp,*edd,m;
<a name="l01387"></a>01387         <span class="keywordflow">if</span>(i&lt;1) {
<a name="l01388"></a>01388                 cout &lt;&lt; <span class="stringliteral">"Zero order vertex formed"</span> &lt;&lt; endl;
<a name="l01389"></a>01389                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01390"></a>01390         }
<a name="l01391"></a>01391         <span class="keywordflow">if</span>(mec[i]==mem[i]) add_memory(i);
<a name="l01392"></a>01392         neighbor.set_aux1(i);
<a name="l01393"></a>01393         <span class="keywordflow">for</span>(l=0;l&lt;q;l++) neighbor.copy_aux1(j,l);
<a name="l01394"></a>01394         <span class="keywordflow">while</span>(l&lt;i) {
<a name="l01395"></a>01395                 neighbor.copy_aux1_shift(j,l);
<a name="l01396"></a>01396                 l++;
<a name="l01397"></a>01397         }
<a name="l01398"></a>01398         edp=mep[i]+(2*i+1)*mec[i]++;
<a name="l01399"></a>01399         edp[2*i]=j;
<a name="l01400"></a>01400         <span class="keywordflow">for</span>(l=0;l&lt;k;l++) {
<a name="l01401"></a>01401                 edp[l]=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][l];
<a name="l01402"></a>01402                 edp[l+i]=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][l+nu[j]];
<a name="l01403"></a>01403         }
<a name="l01404"></a>01404         <span class="keywordflow">while</span>(l&lt;i) {
<a name="l01405"></a>01405                 m=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][l+1];
<a name="l01406"></a>01406                 edp[l]=m;
<a name="l01407"></a>01407                 k=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][l+nu[j]+1];
<a name="l01408"></a>01408                 edp[l+i]=k;
<a name="l01409"></a>01409                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[m][nu[m]+k]--;
<a name="l01410"></a>01410                 l++;
<a name="l01411"></a>01411         }
<a name="l01412"></a>01412 
<a name="l01413"></a>01413         edd=mep[nu[j]]+(2*nu[j]+1)*--mec[nu[j]];
<a name="l01414"></a>01414         <span class="keywordflow">for</span>(l=0;l&lt;=2*nu[j];l++) <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j][l]=edd[l];
<a name="l01415"></a>01415         neighbor.set_aux2_copy(j,nu[j]);
<a name="l01416"></a>01416         neighbor.set_to_aux2(edd[2*nu[j]]);
<a name="l01417"></a>01417         neighbor.set_to_aux1(j);
<a name="l01418"></a>01418         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[edd[2*nu[j]]]=edd;
<a name="l01419"></a>01419         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[j]=edp;
<a name="l01420"></a>01420         nu[j]=i;
<a name="l01421"></a>01421         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01422"></a>01422 }
<a name="l01423"></a>01423 <span class="comment"></span>
<a name="l01424"></a>01424 <span class="comment">/** Cuts a Voronoi cell using the influence of a particle at (x,y,z), first</span>
<a name="l01425"></a>01425 <span class="comment"> * calculating the modulus squared of this vector before passing it to the</span>
<a name="l01426"></a>01426 <span class="comment"> * main nplane() routine. Zero is supplied as the plane ID, which will be</span>
<a name="l01427"></a>01427 <span class="comment"> * ignored unless neighbor tracking is enabled.</span>
<a name="l01428"></a>01428 <span class="comment"> * \param[in] (x,y,z) The vector to cut the cell by. */</span>
<a name="l01429"></a>01429 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01430"></a><a class="code" href="classvoronoicell__base.html#d7e8b4f3f2893659e4d5924c46d7eaf0">01430</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoronoicell__base.html#b445fa3d0a46a3f569e1b705fba4b814">voronoicell_base&lt;n_option&gt;::plane</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l01431"></a>01431         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> rsq=x*x+y*y+z*z;
<a name="l01432"></a>01432         <span class="keywordflow">return</span> <a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x,y,z,rsq,0);
<a name="l01433"></a>01433 }
<a name="l01434"></a>01434 <span class="comment"></span>
<a name="l01435"></a>01435 <span class="comment">/** This version of the plane routine just makes up the plane ID to be zero. It</span>
<a name="l01436"></a>01436 <span class="comment"> * will only be referenced if neighbor tracking is enabled.</span>
<a name="l01437"></a>01437 <span class="comment"> * \param[in] (x,y,z) The vector to cut the cell by.</span>
<a name="l01438"></a>01438 <span class="comment"> * \param[in] rsq The modulus squared of the vector. */</span>
<a name="l01439"></a>01439 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01440"></a><a class="code" href="classvoronoicell__base.html#b445fa3d0a46a3f569e1b705fba4b814">01440</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoronoicell__base.html#b445fa3d0a46a3f569e1b705fba4b814">voronoicell_base&lt;n_option&gt;::plane</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> rsq) {
<a name="l01441"></a>01441         <span class="keywordflow">return</span> <a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x,y,z,rsq,0);
<a name="l01442"></a>01442 }
<a name="l01443"></a>01443 <span class="comment"></span>
<a name="l01444"></a>01444 <span class="comment">/** This routine calculates the modulus squared of the vector before passing it</span>
<a name="l01445"></a>01445 <span class="comment"> * to the main nplane() routine with full arguments.</span>
<a name="l01446"></a>01446 <span class="comment"> * \param[in] (x,y,z) The vector to cut the cell by.</span>
<a name="l01447"></a>01447 <span class="comment"> * \param[in] p_id The plane ID (for neighbor tracking only).*/</span>
<a name="l01448"></a>01448 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01449"></a><a class="code" href="classvoronoicell__base.html#92f0b167e90b67108b372c4e3176488c">01449</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">voronoicell_base&lt;n_option&gt;::nplane</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<span class="keywordtype">int</span> p_id) {
<a name="l01450"></a>01450         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> rsq=x*x+y*y+z*z;
<a name="l01451"></a>01451         <span class="keywordflow">return</span> <a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x,y,z,rsq,p_id);
<a name="l01452"></a>01452 }
<a name="l01453"></a>01453 <span class="comment"></span>
<a name="l01454"></a>01454 <span class="comment">/** This is a simple inline function for picking out the index of the next edge</span>
<a name="l01455"></a>01455 <span class="comment"> * counterclockwise at the current vertex.</span>
<a name="l01456"></a>01456 <span class="comment"> * \param[in] a The index of an edge of the current vertex.</span>
<a name="l01457"></a>01457 <span class="comment"> * \param[in] p The number of the vertex.</span>
<a name="l01458"></a>01458 <span class="comment"> * \return 0 if a=nu[p]-1, or a+1 otherwise. */</span>
<a name="l01459"></a>01459 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01460"></a>01460 <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::cycle_up</a>(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> p) {
<a name="l01461"></a>01461         <span class="keywordflow">return</span> a==nu[p]-1?0:a+1;
<a name="l01462"></a>01462 }
<a name="l01463"></a>01463 <span class="comment"></span>
<a name="l01464"></a>01464 <span class="comment">/** This is a simple inline function for picking out the index of the next edge</span>
<a name="l01465"></a>01465 <span class="comment"> * clockwise from the current vertex.</span>
<a name="l01466"></a>01466 <span class="comment"> * \param[in] a The index of an edge of the current vertex.</span>
<a name="l01467"></a>01467 <span class="comment"> * \param[in] p The number of the vertex.</span>
<a name="l01468"></a>01468 <span class="comment"> * \return nu[p]-1 if a=0, or a-1 otherwise. */</span>
<a name="l01469"></a>01469 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01470"></a>01470 <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::cycle_down</a>(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> p) {
<a name="l01471"></a>01471         <span class="keywordflow">return</span> a==0?nu[p]-1:a-1;
<a name="l01472"></a>01472 }
<a name="l01473"></a>01473 <span class="comment"></span>
<a name="l01474"></a>01474 <span class="comment">/** Calculates the volume of the Voronoi cell, by decomposing the cell into</span>
<a name="l01475"></a>01475 <span class="comment"> * tetrahedra extending outward from the zeroth vertex, which are evaluated</span>
<a name="l01476"></a>01476 <span class="comment"> * using a scalar triple product.</span>
<a name="l01477"></a>01477 <span class="comment"> * \return A floating point number holding the calculated volume. */</span>
<a name="l01478"></a>01478 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01479"></a><a class="code" href="classvoronoicell__base.html#0903f972e22e1c100b021485a609488f">01479</a> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classvoronoicell__base.html#0903f972e22e1c100b021485a609488f">voronoicell_base&lt;n_option&gt;::volume</a>() {
<a name="l01480"></a>01480         <span class="keyword">const</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> fe=1/48.0;
<a name="l01481"></a>01481         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> vol=0;
<a name="l01482"></a>01482         <span class="keywordtype">int</span> i,j,k,l,m,n;
<a name="l01483"></a>01483         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ux,uy,uz,vx,vy,vz,wx,wy,wz;
<a name="l01484"></a>01484         <span class="keywordflow">for</span>(i=1;i&lt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i++) {
<a name="l01485"></a>01485                 ux=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[0]-<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i];
<a name="l01486"></a>01486                 uy=pts[1]-pts[3*i+1];
<a name="l01487"></a>01487                 uz=pts[2]-pts[3*i+2];
<a name="l01488"></a>01488                 <span class="keywordflow">for</span>(j=0;j&lt;nu[i];j++) {
<a name="l01489"></a>01489                         k=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j];
<a name="l01490"></a>01490                         <span class="keywordflow">if</span> (k&gt;=0) {
<a name="l01491"></a>01491                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j]=-1-k;
<a name="l01492"></a>01492                                 l=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][nu[i]+j],k);
<a name="l01493"></a>01493                                 vx=pts[3*k]-pts[0];
<a name="l01494"></a>01494                                 vy=pts[3*k+1]-pts[1];
<a name="l01495"></a>01495                                 vz=pts[3*k+2]-pts[2];
<a name="l01496"></a>01496                                 m=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l];<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l]=-1-m;
<a name="l01497"></a>01497                                 <span class="keywordflow">while</span>(m!=i) {
<a name="l01498"></a>01498                                         n=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][nu[k]+l],m);
<a name="l01499"></a>01499                                         wx=pts[3*m]-pts[0];
<a name="l01500"></a>01500                                         wy=pts[3*m+1]-pts[1];
<a name="l01501"></a>01501                                         wz=pts[3*m+2]-pts[2];
<a name="l01502"></a>01502                                         vol+=ux*vy*wz+uy*vz*wx+uz*vx*wy-uz*vy*wx-uy*vx*wz-ux*vz*wy;
<a name="l01503"></a>01503                                         k=m;l=n;vx=wx;vy=wy;vz=wz;
<a name="l01504"></a>01504                                         m=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l];<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l]=-1-m;
<a name="l01505"></a>01505                                 }
<a name="l01506"></a>01506                         }
<a name="l01507"></a>01507                 }
<a name="l01508"></a>01508         }
<a name="l01509"></a>01509         reset_edges();
<a name="l01510"></a>01510         <span class="keywordflow">return</span> vol*fe;
<a name="l01511"></a>01511 }
<a name="l01512"></a>01512 <span class="comment"></span>
<a name="l01513"></a>01513 <span class="comment">/** Computes the maximum radius squared of a vertex from the center</span>
<a name="l01514"></a>01514 <span class="comment"> * of the cell. It can be used to determine when enough particles have</span>
<a name="l01515"></a>01515 <span class="comment"> * been testing an all planes that could cut the cell have been considered.</span>
<a name="l01516"></a>01516 <span class="comment"> * \return The maximum radius squared of a vertex.*/</span>
<a name="l01517"></a>01517 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01518"></a><a class="code" href="classvoronoicell__base.html#9d26afb17f43732a626f7269c300b90d">01518</a> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classvoronoicell__base.html#9d26afb17f43732a626f7269c300b90d">voronoicell_base&lt;n_option&gt;::maxradsq</a>() {
<a name="l01519"></a>01519         <span class="keywordtype">int</span> i;<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> r,s;
<a name="l01520"></a>01520         r=<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[0]*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[0]+<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[1]*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[1]+<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[2]*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[2];
<a name="l01521"></a>01521         <span class="keywordflow">for</span>(i=3;i&lt;3*<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i+=3) {
<a name="l01522"></a>01522                 s=pts[i]*pts[i]+pts[i+1]*pts[i+1]+pts[i+2]*pts[i+2];
<a name="l01523"></a>01523                 <span class="keywordflow">if</span>(s&gt;r) r=s;
<a name="l01524"></a>01524         }
<a name="l01525"></a>01525         <span class="keywordflow">return</span> r;
<a name="l01526"></a>01526 }
<a name="l01527"></a>01527 <span class="comment"></span>
<a name="l01528"></a>01528 <span class="comment">/** Outputs the edges of the Voronoi cell (in POV-Ray format) to an open file</span>
<a name="l01529"></a>01529 <span class="comment"> * stream, displacing the cell by an amount (x,y,z).</span>
<a name="l01530"></a>01530 <span class="comment"> * \param[in] &amp;os A output stream to write to.</span>
<a name="l01531"></a>01531 <span class="comment"> * \param[in] (x,y,z) A displacement vector to be added to the cell's position. */</span>
<a name="l01532"></a>01532 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01533"></a><a class="code" href="classvoronoicell__base.html#64e2292f64e61c9229195820c2ef0246">01533</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#64e2292f64e61c9229195820c2ef0246">voronoicell_base&lt;n_option&gt;::draw_pov</a>(ostream &amp;os,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l01534"></a>01534         <span class="keywordtype">int</span> i,j,k;<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ux,uy,uz;
<a name="l01535"></a>01535         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i++) {
<a name="l01536"></a>01536                 ux=x+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i];uy=y+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+1];uz=z+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+2];
<a name="l01537"></a>01537                 os &lt;&lt; <span class="stringliteral">"sphere{&lt;"</span> &lt;&lt; ux &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; uy &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; uz &lt;&lt; <span class="stringliteral">"&gt;,r}\n"</span>;
<a name="l01538"></a>01538                 <span class="keywordflow">for</span>(j=0;j&lt;nu[i];j++) {
<a name="l01539"></a>01539                         k=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j];
<a name="l01540"></a>01540                         <span class="keywordflow">if</span> (k&lt;i) os &lt;&lt; <span class="stringliteral">"cylinder{&lt;"</span> &lt;&lt; ux &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; uy &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; uz &lt;&lt; <span class="stringliteral">"&gt;,&lt;"</span> &lt;&lt; x+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*k] &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; y+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*k+1] &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; z+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*k+2] &lt;&lt; <span class="stringliteral">"&gt;,r}\n"</span>;
<a name="l01541"></a>01541                 }
<a name="l01542"></a>01542         }
<a name="l01543"></a>01543 }
<a name="l01544"></a>01544 <span class="comment"></span>
<a name="l01545"></a>01545 <span class="comment">/** An overloaded version of the draw_pov routine, that outputs the edges of</span>
<a name="l01546"></a>01546 <span class="comment"> * the Voronoi cell (in POV-Ray format) to a file.</span>
<a name="l01547"></a>01547 <span class="comment"> * \param[in] filename The file to write to.</span>
<a name="l01548"></a>01548 <span class="comment"> * \param[in] (x,y,z) A displacement vector to be added to the cell's position.</span>
<a name="l01549"></a>01549 <span class="comment"> */</span>
<a name="l01550"></a>01550 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01551"></a><a class="code" href="classvoronoicell__base.html#57b5dd8154956f2e878c6c50f2758e43">01551</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#64e2292f64e61c9229195820c2ef0246">voronoicell_base&lt;n_option&gt;::draw_pov</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l01552"></a>01552         ofstream os;
<a name="l01553"></a>01553         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l01554"></a>01554         <a class="code" href="classvoronoicell__base.html#64e2292f64e61c9229195820c2ef0246">draw_pov</a>(os,x,y,z);
<a name="l01555"></a>01555         os.close();
<a name="l01556"></a>01556 }
<a name="l01557"></a>01557 <span class="comment"></span>
<a name="l01558"></a>01558 <span class="comment">/** An overloaded version of the draw_pov routine, that outputs the edges of the</span>
<a name="l01559"></a>01559 <span class="comment"> * Voronoi cell (in POV-Ray format) to standard output.</span>
<a name="l01560"></a>01560 <span class="comment"> * \param[in] (x,y,z) A displacement vector to be added to the cell's position.</span>
<a name="l01561"></a>01561 <span class="comment"> */</span>
<a name="l01562"></a>01562 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01563"></a><a class="code" href="classvoronoicell__base.html#695c65e4afff17c686d9b93103db1d9b">01563</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#64e2292f64e61c9229195820c2ef0246">voronoicell_base&lt;n_option&gt;::draw_pov</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l01564"></a>01564         <a class="code" href="classvoronoicell__base.html#64e2292f64e61c9229195820c2ef0246">draw_pov</a>(cout,x,y,z);
<a name="l01565"></a>01565 }
<a name="l01566"></a>01566 <span class="comment"></span>
<a name="l01567"></a>01567 <span class="comment">/** Outputs the edges of the Voronoi cell (in gnuplot format) to an output stream.</span>
<a name="l01568"></a>01568 <span class="comment"> * \param[in] &amp;os A reference to an output stream to write to.</span>
<a name="l01569"></a>01569 <span class="comment"> * \param[in] (x,y,z) A displacement vector to be added to the cell's position.</span>
<a name="l01570"></a>01570 <span class="comment"> */</span>
<a name="l01571"></a>01571 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01572"></a><a class="code" href="classvoronoicell__base.html#630c2044253bfe8cc900d808aaf79411">01572</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#630c2044253bfe8cc900d808aaf79411">voronoicell_base&lt;n_option&gt;::draw_gnuplot</a>(ostream &amp;os,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l01573"></a>01573         <span class="keywordtype">int</span> i,j,k;<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ux,uy,uz;
<a name="l01574"></a>01574         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i++) {
<a name="l01575"></a>01575                 ux=x+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i];uy=y+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+1];uz=z+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+2];
<a name="l01576"></a>01576                 <span class="keywordflow">for</span>(j=0;j&lt;nu[i];j++) {
<a name="l01577"></a>01577                         k=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j];
<a name="l01578"></a>01578                         <span class="keywordflow">if</span> (<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j]&lt;i) os &lt;&lt; ux &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; uy &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; uz &lt;&lt; <span class="stringliteral">"\n"</span> &lt;&lt; x+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*k] &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; y+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*k+1] &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; z+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*k+2] &lt;&lt; <span class="stringliteral">"\n\n\n"</span>;
<a name="l01579"></a>01579                 }
<a name="l01580"></a>01580         }
<a name="l01581"></a>01581 }
<a name="l01582"></a>01582 <span class="comment"></span>
<a name="l01583"></a>01583 <span class="comment">/** An overloaded version of the draw_gnuplot routine that writes directly to</span>
<a name="l01584"></a>01584 <span class="comment"> * a file.</span>
<a name="l01585"></a>01585 <span class="comment"> * \param[in] filename The name of the file to write to.</span>
<a name="l01586"></a>01586 <span class="comment"> * \param[in] (x,y,z) A displacement vector to be added to the cell's position.</span>
<a name="l01587"></a>01587 <span class="comment"> */</span>
<a name="l01588"></a>01588 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01589"></a><a class="code" href="classvoronoicell__base.html#c909e34858b6c5a2b9a5dd054cb5e012">01589</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#630c2044253bfe8cc900d808aaf79411">voronoicell_base&lt;n_option&gt;::draw_gnuplot</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l01590"></a>01590         ofstream os;
<a name="l01591"></a>01591         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l01592"></a>01592         <a class="code" href="classvoronoicell__base.html#630c2044253bfe8cc900d808aaf79411">draw_gnuplot</a>(os,x,y,z);
<a name="l01593"></a>01593         os.close();
<a name="l01594"></a>01594 }
<a name="l01595"></a>01595 <span class="comment"></span>
<a name="l01596"></a>01596 <span class="comment">/** An overloaded version of the draw_gnuplot routine, that prints to the</span>
<a name="l01597"></a>01597 <span class="comment"> * standard output.</span>
<a name="l01598"></a>01598 <span class="comment"> * \param[in] (x,y,z) A displacement vector to be added to the cell's position.</span>
<a name="l01599"></a>01599 <span class="comment"> */</span>
<a name="l01600"></a>01600 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01601"></a><a class="code" href="classvoronoicell__base.html#ffd28e0a7bf6dfc513945c075e7df3a8">01601</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#630c2044253bfe8cc900d808aaf79411">voronoicell_base&lt;n_option&gt;::draw_gnuplot</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l01602"></a>01602         <a class="code" href="classvoronoicell__base.html#630c2044253bfe8cc900d808aaf79411">draw_gnuplot</a>(cout,x,y,z);
<a name="l01603"></a>01603 }
<a name="l01604"></a>01604 <span class="comment"></span>
<a name="l01605"></a>01605 <span class="comment">/** Outputs the Voronoi cell in the POV mesh2 format, described in section</span>
<a name="l01606"></a>01606 <span class="comment"> * 1.3.2.2 of the POV-Ray documentation. The mesh2 output consists of a list of</span>
<a name="l01607"></a>01607 <span class="comment"> * vertex vectors, followed by a list of triangular faces. The routine also</span>
<a name="l01608"></a>01608 <span class="comment"> * makes use of the optional inside_vector specification, which makes the mesh</span>
<a name="l01609"></a>01609 <span class="comment"> * object solid, so the the POV-Ray Constructive Solid Geometry (CSG) can be</span>
<a name="l01610"></a>01610 <span class="comment"> * applied.</span>
<a name="l01611"></a>01611 <span class="comment"> * \param[in] &amp;os An output stream to write to.</span>
<a name="l01612"></a>01612 <span class="comment"> * \param[in] (x,y,z) A displacement vector to be added to the cell's position.</span>
<a name="l01613"></a>01613 <span class="comment"> */</span>
<a name="l01614"></a>01614 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01615"></a><a class="code" href="classvoronoicell__base.html#822c40b1478a3b77881134e9c9b56a7d">01615</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#822c40b1478a3b77881134e9c9b56a7d">voronoicell_base&lt;n_option&gt;::draw_pov_mesh</a>(ostream &amp;os,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l01616"></a>01616         <span class="keywordtype">int</span> i,j,k,l,m,n;
<a name="l01617"></a>01617         os &lt;&lt; <span class="stringliteral">"mesh2 {\nvertex_vectors {\n"</span> &lt;&lt; <a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a> &lt;&lt; <span class="stringliteral">",\n"</span>;
<a name="l01618"></a>01618         <span class="keywordflow">for</span>(i=0;i&lt;p;i++) {
<a name="l01619"></a>01619                 os &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; x+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i] &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; y+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+1] &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; z+0.5*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+2] &lt;&lt; <span class="stringliteral">"&gt;,\n"</span>;
<a name="l01620"></a>01620         }
<a name="l01621"></a>01621         os &lt;&lt; <span class="stringliteral">"}\nface_indices {\n"</span> &lt;&lt; 2*(p-2) &lt;&lt; <span class="stringliteral">",\n"</span>;
<a name="l01622"></a>01622         <span class="keywordflow">for</span>(i=1;i&lt;p;i++) {
<a name="l01623"></a>01623                 <span class="keywordflow">for</span>(j=0;j&lt;nu[i];j++) {
<a name="l01624"></a>01624                         k=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j];
<a name="l01625"></a>01625                         <span class="keywordflow">if</span> (k&gt;=0) {
<a name="l01626"></a>01626                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j]=-1-k;
<a name="l01627"></a>01627                                 l=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][nu[i]+j],k);
<a name="l01628"></a>01628                                 m=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l];<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l]=-1-m;
<a name="l01629"></a>01629                                 <span class="keywordflow">while</span>(m!=i) {
<a name="l01630"></a>01630                                         n=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][nu[k]+l],m);
<a name="l01631"></a>01631                                         os &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; k &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; m &lt;&lt; <span class="stringliteral">"&gt;\n"</span>;
<a name="l01632"></a>01632                                         k=m;l=n;
<a name="l01633"></a>01633                                         m=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l];<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l]=-1-m;
<a name="l01634"></a>01634                                 }
<a name="l01635"></a>01635                         }
<a name="l01636"></a>01636                 }
<a name="l01637"></a>01637         }
<a name="l01638"></a>01638         reset_edges();
<a name="l01639"></a>01639         os &lt;&lt; <span class="stringliteral">"}\ninside_vector &lt;0,0,1&gt;\n}\n"</span>;
<a name="l01640"></a>01640 }
<a name="l01641"></a>01641 <span class="comment"></span>
<a name="l01642"></a>01642 <span class="comment">/** Several routines in the class that gather cell-based statistics internally</span>
<a name="l01643"></a>01643 <span class="comment"> * track their progress by flipping edges to negative so that they know what</span>
<a name="l01644"></a>01644 <span class="comment"> * parts of the cell have already been tested. This function resets them back</span>
<a name="l01645"></a>01645 <span class="comment"> * to positive. When it is called, it assumes that every edge in the routine</span>
<a name="l01646"></a>01646 <span class="comment"> * should have already been flipped to negative, and it bails out with an</span>
<a name="l01647"></a>01647 <span class="comment"> * internal error if it encounters a positive edge. */</span>
<a name="l01648"></a>01648 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01649"></a>01649 <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::reset_edges</a>() {
<a name="l01650"></a>01650         <span class="keywordtype">int</span> i,j;
<a name="l01651"></a>01651         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i++) {
<a name="l01652"></a>01652                 <span class="keywordflow">for</span>(j=0;j&lt;nu[i];j++) {
<a name="l01653"></a>01653                         <span class="keywordflow">if</span>(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j]&gt;=0) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Edge reset routine found a previously untested edge"</span>,<a class="code" href="config_8hh.html#d8e0de9d48da06e86dd87884e4a2d47e">VOROPP_INTERNAL_ERROR</a>);
<a name="l01654"></a>01654                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j]=-1-<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j];
<a name="l01655"></a>01655                 }
<a name="l01656"></a>01656         }
<a name="l01657"></a>01657 }
<a name="l01658"></a>01658 <span class="comment"></span>
<a name="l01659"></a>01659 <span class="comment">/** An overloaded version of the draw_pov_mesh routine, that writes directly to a</span>
<a name="l01660"></a>01660 <span class="comment"> * file.</span>
<a name="l01661"></a>01661 <span class="comment"> * \param[in] filename A filename to write to.</span>
<a name="l01662"></a>01662 <span class="comment"> * \param[in] (x,y,z) A displacement vector to be added to the cell's position.</span>
<a name="l01663"></a>01663 <span class="comment"> */</span>
<a name="l01664"></a>01664 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01665"></a><a class="code" href="classvoronoicell__base.html#1c4d7f463865cb6451b58a04ddac628c">01665</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#822c40b1478a3b77881134e9c9b56a7d">voronoicell_base&lt;n_option&gt;::draw_pov_mesh</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l01666"></a>01666         ofstream os;
<a name="l01667"></a>01667         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l01668"></a>01668         <a class="code" href="classvoronoicell__base.html#822c40b1478a3b77881134e9c9b56a7d">draw_pov_mesh</a>(os,x,y,z);
<a name="l01669"></a>01669         os.close();
<a name="l01670"></a>01670 }
<a name="l01671"></a>01671 <span class="comment"></span>
<a name="l01672"></a>01672 <span class="comment">/** An overloaded version of the draw_pov_mesh routine, that prints to the</span>
<a name="l01673"></a>01673 <span class="comment"> * standard output.</span>
<a name="l01674"></a>01674 <span class="comment"> * \param[in] (x,y,z) A displacement vector to be added to the cell's position.</span>
<a name="l01675"></a>01675 <span class="comment"> */</span>
<a name="l01676"></a>01676 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01677"></a><a class="code" href="classvoronoicell__base.html#552b7adc92c3118db44eb205c4d8bbe3">01677</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#822c40b1478a3b77881134e9c9b56a7d">voronoicell_base&lt;n_option&gt;::draw_pov_mesh</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l01678"></a>01678         <a class="code" href="classvoronoicell__base.html#822c40b1478a3b77881134e9c9b56a7d">draw_pov_mesh</a>(cout,x,y,z);
<a name="l01679"></a>01679 }
<a name="l01680"></a>01680 <span class="comment"></span>
<a name="l01681"></a>01681 <span class="comment">/** Randomly perturbs the points in the Voronoi cell by an amount r. */</span>
<a name="l01682"></a>01682 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01683"></a><a class="code" href="classvoronoicell__base.html#8a43d834770eca6ec0cc0a7fc07a0814">01683</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#8a43d834770eca6ec0cc0a7fc07a0814">voronoicell_base&lt;n_option&gt;::perturb</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> r) {
<a name="l01684"></a>01684         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;3*p;i++) {
<a name="l01685"></a>01685                 <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[i]+=(2*<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a>(rand())/RAND_MAX-1)*r;
<a name="l01686"></a>01686         }
<a name="l01687"></a>01687 }
<a name="l01688"></a>01688 <span class="comment"></span>
<a name="l01689"></a>01689 <span class="comment">/** Initializes the suretest class and creates a buffer for marginal points. */</span>
<a name="l01690"></a><a class="code" href="classsuretest.html#2f749335defff5a90fea414cf9ef407d">01690</a> <a class="code" href="classsuretest.html#2f749335defff5a90fea414cf9ef407d">suretest::suretest</a>() : current_marginal(<a class="code" href="config_8hh.html#6fcab398e30d89c3b64794a0e02036da">init_marginal</a>) {
<a name="l01691"></a>01691         sn=<span class="keyword">new</span> <span class="keywordtype">int</span>[2*current_marginal];
<a name="l01692"></a>01692 }
<a name="l01693"></a>01693 <span class="comment"></span>
<a name="l01694"></a>01694 <span class="comment">/** Suretest destructor to free memory allocation. */</span>
<a name="l01695"></a><a class="code" href="classsuretest.html#ca9d12958c26a3507f4bdb7fbe641775">01695</a> <a class="code" href="classsuretest.html#ca9d12958c26a3507f4bdb7fbe641775">suretest::~suretest</a>() {
<a name="l01696"></a>01696         <span class="keyword">delete</span> [] sn;
<a name="l01697"></a>01697 }
<a name="l01698"></a>01698 <span class="comment"></span>
<a name="l01699"></a>01699 <span class="comment">/** Sets up the suretest class with a particular test plane, and removes</span>
<a name="l01700"></a>01700 <span class="comment"> * any special cases from the table. */</span>
<a name="l01701"></a><a class="code" href="classsuretest.html#fd632ead9ca1cd643accdaf2c5ed7bbd">01701</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classsuretest.html#fd632ead9ca1cd643accdaf2c5ed7bbd">suretest::init</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> rsq) {
<a name="l01702"></a>01702         sc=0;px=x;py=y;pz=z;prsq=rsq;
<a name="l01703"></a>01703 }
<a name="l01704"></a>01704 <span class="comment"></span>
<a name="l01705"></a>01705 <span class="comment">/** */</span>
<a name="l01706"></a><a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">01706</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classsuretest.html#63568e5b83ffa0db6b6dc092976f4d0c">suretest::test</a>(<span class="keywordtype">int</span> n,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;ans) {
<a name="l01707"></a>01707         ans=px*p[3*n]+py*p[3*n+1]+pz*p[3*n+2]-prsq;
<a name="l01708"></a>01708         <span class="keywordflow">if</span>(ans&lt;-<a class="code" href="config_8hh.html#2df54db08dc7bc1f0c19df3466b8e07f">tolerance2</a>) {
<a name="l01709"></a>01709                 <span class="keywordflow">return</span> -1;
<a name="l01710"></a>01710         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ans&gt;<a class="code" href="config_8hh.html#2df54db08dc7bc1f0c19df3466b8e07f">tolerance2</a>) {
<a name="l01711"></a>01711                 <span class="keywordflow">return</span> 1;
<a name="l01712"></a>01712         }
<a name="l01713"></a>01713         <span class="keywordflow">return</span> check_marginal(n,ans);
<a name="l01714"></a>01714 }
<a name="l01715"></a>01715 
<a name="l01716"></a>01716 <span class="keywordtype">int</span> suretest::check_marginal(<span class="keywordtype">int</span> n,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;ans) {
<a name="l01717"></a>01717         <span class="keywordtype">int</span> i;
<a name="l01718"></a>01718         <span class="keywordflow">for</span>(i=0;i&lt;sc;i+=2) <span class="keywordflow">if</span>(sn[i]==n) <span class="keywordflow">return</span> sn[i+1];
<a name="l01719"></a>01719         <span class="keywordflow">if</span> (sc==2*current_marginal) {
<a name="l01720"></a>01720                 i=2*current_marginal;
<a name="l01721"></a>01721                 <span class="keywordflow">if</span> (i&gt;<a class="code" href="config_8hh.html#087fc576d7366e69bdd02e3e7229a8b5">max_marginal</a>) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Marginal case buffer allocation exceeded absolute maximum"</span>,<a class="code" href="config_8hh.html#5dc0616f8a67ae3d1c2ba8a3dcf5612b">VOROPP_MEMORY_ERROR</a>);
<a name="l01722"></a>01722 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=2</span>
<a name="l01723"></a>01723 <span class="preprocessor"></span>                cerr &lt;&lt; <span class="stringliteral">"Marginal cases buffer scaled up to "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l01724"></a>01724 <span class="preprocessor">#endif</span>
<a name="l01725"></a>01725 <span class="preprocessor"></span>                <span class="keywordtype">int</span> *psn=<span class="keyword">new</span> <span class="keywordtype">int</span>[2*i];
<a name="l01726"></a>01726                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;2*current_marginal;j++) psn[j]=sn[j];
<a name="l01727"></a>01727                 <span class="keyword">delete</span> [] sn;sn=psn;
<a name="l01728"></a>01728         }
<a name="l01729"></a>01729         sn[sc++]=n;
<a name="l01730"></a>01730         sn[sc++]=ans&gt;<a class="code" href="config_8hh.html#377aa97df9bb631891543aed53319a29">tolerance</a>?1:(ans&lt;-<a class="code" href="config_8hh.html#377aa97df9bb631891543aed53319a29">tolerance</a>?-1:0);
<a name="l01731"></a>01731         <span class="keywordflow">return</span> sn[sc-1];        
<a name="l01732"></a>01732 }
<a name="l01733"></a>01733 <span class="comment"></span>
<a name="l01734"></a>01734 <span class="comment">/** Prints the vertices, their edges, the relation table, and also notifies if</span>
<a name="l01735"></a>01735 <span class="comment"> * any glaring memory errors are visible. */</span>
<a name="l01736"></a>01736 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01737"></a><a class="code" href="classvoronoicell__base.html#fcb724ea6f8a06de6b435bfd7cbeb669">01737</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#fcb724ea6f8a06de6b435bfd7cbeb669">voronoicell_base&lt;n_option&gt;::print_edges</a>() {
<a name="l01738"></a>01738         <span class="keywordtype">int</span> j;
<a name="l01739"></a>01739         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;p;i++) {
<a name="l01740"></a>01740                 cout &lt;&lt; i &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; nu[i] &lt;&lt; <span class="stringliteral">"  "</span>;
<a name="l01741"></a>01741                 <span class="keywordflow">for</span>(j=0;j&lt;nu[i];j++) cout &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j];
<a name="l01742"></a>01742                 cout &lt;&lt; <span class="stringliteral">"   "</span>;
<a name="l01743"></a>01743                 <span class="keywordflow">while</span>(j&lt;2*nu[i]) cout &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j++];
<a name="l01744"></a>01744                 cout &lt;&lt; <span class="stringliteral">"    "</span> &lt;&lt; ed[i][j];
<a name="l01745"></a>01745                 neighbor.print_edges(i);
<a name="l01746"></a>01746                 cout &lt;&lt; <span class="stringliteral">"    "</span> &lt;&lt; <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i] &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+1] &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*i+2];
<a name="l01747"></a>01747                 cout &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; ed[i];
<a name="l01748"></a>01748                 <span class="keywordflow">if</span> (ed[i]&gt;=mep[nu[i]]+mec[nu[i]]*(2*nu[i]+1)) cout &lt;&lt; <span class="stringliteral">" Memory error"</span>;
<a name="l01749"></a>01749                 cout &lt;&lt; endl;
<a name="l01750"></a>01750         }
<a name="l01751"></a>01751 }
<a name="l01752"></a>01752 <span class="comment"></span>
<a name="l01753"></a>01753 <span class="comment">/** Prints out a list of all the facets and their vertices. If the neighbor option</span>
<a name="l01754"></a>01754 <span class="comment"> * is defined, it lists each cutting plane. */</span>
<a name="l01755"></a>01755 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01756"></a><a class="code" href="classvoronoicell__base.html#5e802dfd3ac6b0c1c1a942aaa4533fb5">01756</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#2589b93490975060a59fa544988720e1">voronoicell_base&lt;n_option&gt;::facets</a>(ostream &amp;os) {
<a name="l01757"></a>01757         <span class="keywordtype">int</span> i,j,k,l,m;
<a name="l01758"></a>01758         <span class="keywordflow">for</span>(i=0;i&lt;p;i++) {
<a name="l01759"></a>01759                 <span class="keywordflow">for</span>(j=0;j&lt;nu[i];j++) {
<a name="l01760"></a>01760                         k=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j];
<a name="l01761"></a>01761                         <span class="keywordflow">if</span> (k&gt;=0) {
<a name="l01762"></a>01762                                 neighbor.print(os,i,j);
<a name="l01763"></a>01763                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j]=-1-k;
<a name="l01764"></a>01764                                 l=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][nu[i]+j],k);
<a name="l01765"></a>01765                                 <span class="keywordflow">do</span> {
<a name="l01766"></a>01766                                         os &lt;&lt; <span class="stringliteral">" "</span>;
<a name="l01767"></a>01767                                         neighbor.print(os,k,l);
<a name="l01768"></a>01768                                         m=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l];
<a name="l01769"></a>01769                                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l]=-1-m;
<a name="l01770"></a>01770                                         l=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][nu[k]+l],m);
<a name="l01771"></a>01771                                         k=m;
<a name="l01772"></a>01772                                 } <span class="keywordflow">while</span> (k!=i);
<a name="l01773"></a>01773                                 os &lt;&lt; endl;
<a name="l01774"></a>01774                         }
<a name="l01775"></a>01775                 }
<a name="l01776"></a>01776         }
<a name="l01777"></a>01777         reset_edges();
<a name="l01778"></a>01778 }
<a name="l01779"></a>01779 <span class="comment"></span>
<a name="l01780"></a>01780 <span class="comment">/** Returns the number of faces of a computed Voronoi cell.</span>
<a name="l01781"></a>01781 <span class="comment"> * \return The number of faces. */</span>
<a name="l01782"></a>01782 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01783"></a><a class="code" href="classvoronoicell__base.html#61cb1dcea3ac8dc5cefcad1658fda7e7">01783</a> <span class="keywordtype">int</span> <a class="code" href="classvoronoicell__base.html#61cb1dcea3ac8dc5cefcad1658fda7e7">voronoicell_base&lt;n_option&gt;::number_of_faces</a>() {
<a name="l01784"></a>01784         <span class="keywordtype">int</span> i,j,k,l,m,s=0;
<a name="l01785"></a>01785         <span class="keywordflow">for</span>(i=0;i&lt;p;i++) {
<a name="l01786"></a>01786                 <span class="keywordflow">for</span>(j=0;j&lt;nu[i];j++) {
<a name="l01787"></a>01787                         k=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j];
<a name="l01788"></a>01788                         <span class="keywordflow">if</span> (k&gt;=0) {
<a name="l01789"></a>01789                                 s++;
<a name="l01790"></a>01790                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j]=-1-k;
<a name="l01791"></a>01791                                 l=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][nu[i]+j],k);
<a name="l01792"></a>01792                                 <span class="keywordflow">do</span> {
<a name="l01793"></a>01793                                         m=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l];
<a name="l01794"></a>01794                                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l]=-1-m;
<a name="l01795"></a>01795                                         l=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][nu[k]+l],m);
<a name="l01796"></a>01796                                         k=m;
<a name="l01797"></a>01797                                 } <span class="keywordflow">while</span> (k!=i);
<a name="l01798"></a>01798                         }
<a name="l01799"></a>01799                 }
<a name="l01800"></a>01800         }
<a name="l01801"></a>01801         reset_edges();
<a name="l01802"></a>01802         <span class="keywordflow">return</span> s;
<a name="l01803"></a>01803 }
<a name="l01804"></a>01804 <span class="comment"></span>
<a name="l01805"></a>01805 <span class="comment">/** This routine is a placeholder which just prints the ID of a</span>
<a name="l01806"></a>01806 <span class="comment"> * vertex.</span>
<a name="l01807"></a>01807 <span class="comment"> * \param[in] &amp;os The output stream to write to.</span>
<a name="l01808"></a>01808 <span class="comment"> * \param[in] i The ID of a vertex.</span>
<a name="l01809"></a>01809 <span class="comment"> * \param[in] j The particular plane of interest (ignored in this routine). */</span> 
<a name="l01810"></a><a class="code" href="classneighbor__none.html#309227ecb7c18a99fdacf0dd2fe534ca">01810</a> <span class="keywordtype">void</span> <a class="code" href="classneighbor__none.html#309227ecb7c18a99fdacf0dd2fe534ca">neighbor_none::print</a>(ostream &amp;os,<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> j) {
<a name="l01811"></a>01811         os &lt;&lt; i;
<a name="l01812"></a>01812 }
<a name="l01813"></a>01813 <span class="comment"></span>
<a name="l01814"></a>01814 <span class="comment">/** An overloaded version of facets() which output the results to the standard</span>
<a name="l01815"></a>01815 <span class="comment"> * output. */</span>
<a name="l01816"></a>01816 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01817"></a><a class="code" href="classvoronoicell__base.html#2589b93490975060a59fa544988720e1">01817</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#2589b93490975060a59fa544988720e1">voronoicell_base&lt;n_option&gt;::facets</a>() {
<a name="l01818"></a>01818         <a class="code" href="classvoronoicell__base.html#2589b93490975060a59fa544988720e1">facets</a>(cout);
<a name="l01819"></a>01819 }
<a name="l01820"></a>01820 <span class="comment"></span>
<a name="l01821"></a>01821 <span class="comment">/** An overloaded version of facets(), which outputs the results to a file.</span>
<a name="l01822"></a>01822 <span class="comment"> * \param[in] filename The name of the file to write to. */</span>
<a name="l01823"></a>01823 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01824"></a><a class="code" href="classvoronoicell__base.html#e1e9d2a4edb5dadc3b2310ee59d7f175">01824</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#2589b93490975060a59fa544988720e1">voronoicell_base&lt;n_option&gt;::facets</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
<a name="l01825"></a>01825         ofstream os;
<a name="l01826"></a>01826         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l01827"></a>01827         <a class="code" href="classvoronoicell__base.html#2589b93490975060a59fa544988720e1">facets</a>(os);
<a name="l01828"></a>01828         os.close();
<a name="l01829"></a>01829 }
<a name="l01830"></a>01830 <span class="comment"></span>
<a name="l01831"></a>01831 <span class="comment">/** Examines all the facets, and evaluates them by the number of vertices that</span>
<a name="l01832"></a>01832 <span class="comment"> * they have.</span>
<a name="l01833"></a>01833 <span class="comment"> * \param[in] &amp;os An open output stream to write to. */</span>
<a name="l01834"></a>01834 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01835"></a><a class="code" href="classvoronoicell__base.html#206cb2ceab636fa3394ee144053a2bee">01835</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#25ed700de2c48ae841d15db71c062c15">voronoicell_base&lt;n_option&gt;::facet_statistics</a>(ostream &amp;os) {
<a name="l01836"></a>01836         <span class="keywordtype">int</span> *stat,*pstat,current_facet_size=<a class="code" href="config_8hh.html#d7ecaa960d115083fa7975805bad404c">init_facet_size</a>,newc,maxf=0;
<a name="l01837"></a>01837         stat=<span class="keyword">new</span> <span class="keywordtype">int</span>[current_facet_size];
<a name="l01838"></a>01838         <span class="keywordtype">int</span> i,j,k,l,m,q;
<a name="l01839"></a>01839         <span class="keywordflow">for</span>(i=0;i&lt;current_facet_size;i++) stat[i]=0;
<a name="l01840"></a>01840         <span class="keywordflow">for</span>(i=0;i&lt;p;i++) {
<a name="l01841"></a>01841                 <span class="keywordflow">for</span>(j=0;j&lt;nu[i];j++) {
<a name="l01842"></a>01842                         k=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j];
<a name="l01843"></a>01843                         <span class="keywordflow">if</span> (k&gt;=0) {
<a name="l01844"></a>01844                                 q=1;
<a name="l01845"></a>01845                                 <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][j]=-1-k;
<a name="l01846"></a>01846                                 l=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[i][nu[i]+j],k);
<a name="l01847"></a>01847                                 <span class="keywordflow">do</span> {
<a name="l01848"></a>01848                                         q++;
<a name="l01849"></a>01849                                         m=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l];
<a name="l01850"></a>01850                                         <a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][l]=-1-m;
<a name="l01851"></a>01851                                         l=cycle_up(<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[k][nu[k]+l],m);
<a name="l01852"></a>01852                                         k=m;
<a name="l01853"></a>01853                                 } <span class="keywordflow">while</span> (k!=i);
<a name="l01854"></a>01854                                 <span class="keywordflow">if</span> (q&gt;=current_facet_size) {
<a name="l01855"></a>01855                                         newc=current_facet_size*2;
<a name="l01856"></a>01856                                         pstat=<span class="keyword">new</span> <span class="keywordtype">int</span>[newc];
<a name="l01857"></a>01857                                         <span class="keywordflow">for</span>(k=0;k&lt;current_facet_size;k++) pstat[k]=stat[k];
<a name="l01858"></a>01858                                         <span class="keywordflow">while</span>(k&lt;newc) pstat[k]=0;
<a name="l01859"></a>01859                                         <span class="keyword">delete</span> [] stat;
<a name="l01860"></a>01860                                         current_facet_size=newc;
<a name="l01861"></a>01861                                         stat=pstat;
<a name="l01862"></a>01862                                 }
<a name="l01863"></a>01863                                 stat[q]++;
<a name="l01864"></a>01864                                 <span class="keywordflow">if</span> (q&gt;maxf) maxf=q;
<a name="l01865"></a>01865                         }
<a name="l01866"></a>01866                 }
<a name="l01867"></a>01867         }
<a name="l01868"></a>01868         reset_edges();
<a name="l01869"></a>01869         <span class="keywordflow">for</span>(i=0;i&lt;=maxf;i++) os &lt;&lt; i &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; stat[i] &lt;&lt; endl;
<a name="l01870"></a>01870         <span class="keyword">delete</span> [] stat;
<a name="l01871"></a>01871 }
<a name="l01872"></a>01872 <span class="comment"></span>
<a name="l01873"></a>01873 <span class="comment">/** An overloaded version of facet_statistics() which outputs the results to</span>
<a name="l01874"></a>01874 <span class="comment"> * standard output. */</span>
<a name="l01875"></a>01875 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01876"></a><a class="code" href="classvoronoicell__base.html#25ed700de2c48ae841d15db71c062c15">01876</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#25ed700de2c48ae841d15db71c062c15">voronoicell_base&lt;n_option&gt;::facet_statistics</a>() {
<a name="l01877"></a>01877         <a class="code" href="classvoronoicell__base.html#25ed700de2c48ae841d15db71c062c15">facet_statistics</a>(cout);
<a name="l01878"></a>01878 }
<a name="l01879"></a>01879 <span class="comment"></span>
<a name="l01880"></a>01880 <span class="comment">/** An overloaded version of facet_statistics() which outputs the results to</span>
<a name="l01881"></a>01881 <span class="comment"> * a file.</span>
<a name="l01882"></a>01882 <span class="comment"> * \param[in] filename The name of the file to write to. */</span>
<a name="l01883"></a>01883 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01884"></a><a class="code" href="classvoronoicell__base.html#a657111ca314030c40812651d19d12f6">01884</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#25ed700de2c48ae841d15db71c062c15">voronoicell_base&lt;n_option&gt;::facet_statistics</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
<a name="l01885"></a>01885         ofstream os;
<a name="l01886"></a>01886         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l01887"></a>01887         <a class="code" href="classvoronoicell__base.html#25ed700de2c48ae841d15db71c062c15">facet_statistics</a>(os);
<a name="l01888"></a>01888         os.close();
<a name="l01889"></a>01889 }
<a name="l01890"></a>01890 <span class="comment"></span>
<a name="l01891"></a>01891 <span class="comment">/** If the template is instantiated with the neighbor tracking turned on,</span>
<a name="l01892"></a>01892 <span class="comment"> * then this routine will label all the facets of the current cell. Otherwise</span>
<a name="l01893"></a>01893 <span class="comment"> * this routine does nothing. */</span>
<a name="l01894"></a>01894 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01895"></a><a class="code" href="classvoronoicell__base.html#0d7b7a8412601203bd249d21d22629ce">01895</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#0d7b7a8412601203bd249d21d22629ce">voronoicell_base&lt;n_option&gt;::label_facets</a>() {
<a name="l01896"></a>01896         neighbor.label_facets();
<a name="l01897"></a>01897 }
<a name="l01898"></a>01898 <span class="comment"></span>
<a name="l01899"></a>01899 <span class="comment">/** If the template is instantiated with the neighbor tracking turned on, then</span>
<a name="l01900"></a>01900 <span class="comment"> * this routine will print out a list of all the neighbors of a given cell.</span>
<a name="l01901"></a>01901 <span class="comment"> * Otherwise, this routine does nothing.</span>
<a name="l01902"></a>01902 <span class="comment"> * \param[in] &amp;os An open output stream to write to. */</span>
<a name="l01903"></a>01903 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01904"></a><a class="code" href="classvoronoicell__base.html#61afcba4baa2367bfa4336c53fb53ac4">01904</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#61afcba4baa2367bfa4336c53fb53ac4">voronoicell_base&lt;n_option&gt;::neighbors</a>(ostream &amp;os) {
<a name="l01905"></a>01905         neighbor.neighbors(os);
<a name="l01906"></a>01906 }
<a name="l01907"></a>01907 <span class="comment"></span>
<a name="l01908"></a>01908 <span class="comment">/** If the template is instantiated with the neighbor tracking turned on, then</span>
<a name="l01909"></a>01909 <span class="comment"> * this routine will check that the neighbor information is consistent, by</span>
<a name="l01910"></a>01910 <span class="comment"> * tracing around every facet, and ensuring that all the neighbor information</span>
<a name="l01911"></a>01911 <span class="comment"> * for that facet refers to the same neighbor. If the neighbor tracking isn't</span>
<a name="l01912"></a>01912 <span class="comment"> * turned on, this routine does nothing. */</span> 
<a name="l01913"></a>01913 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01914"></a><a class="code" href="classvoronoicell__base.html#7b75cdf5812934901fc442945d0eb804">01914</a> <span class="keywordtype">void</span> <a class="code" href="classvoronoicell__base.html#7b75cdf5812934901fc442945d0eb804">voronoicell_base&lt;n_option&gt;::check_facets</a>() {
<a name="l01915"></a>01915         neighbor.check_facets();
<a name="l01916"></a>01916 }
<a name="l01917"></a>01917 <span class="comment"></span>
<a name="l01918"></a>01918 <span class="comment">/** This routine tests to see whether the cell intersects a plane by starting</span>
<a name="l01919"></a>01919 <span class="comment"> * from the guess point up. If up intersects, then it immediately returns true.</span>
<a name="l01920"></a>01920 <span class="comment"> * Otherwise, it calls the plane_intersects_track() routine.</span>
<a name="l01921"></a>01921 <span class="comment"> * \param[in] (x,y,z) The normal vector to the plane.</span>
<a name="l01922"></a>01922 <span class="comment"> * \param[in] rsq The distance along this vector of the plane.</span>
<a name="l01923"></a>01923 <span class="comment"> * \return false if the plane does not intersect the plane, true if it does.*/</span>
<a name="l01924"></a>01924 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01925"></a><a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">01925</a> <span class="keywordtype">bool</span> <a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">voronoicell_base&lt;n_option&gt;::plane_intersects</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> rsq) {
<a name="l01926"></a>01926         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> g=x*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]+y*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>+1]+z*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>+2];
<a name="l01927"></a>01927         <span class="keywordflow">if</span> (g&lt;rsq) <span class="keywordflow">return</span> plane_intersects_track(x,y,z,rsq,g);
<a name="l01928"></a>01928         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01929"></a>01929 }
<a name="l01930"></a>01930 <span class="comment"></span>
<a name="l01931"></a>01931 <span class="comment">/** This routine tests to see if a cell intersects a plane. It first tests a</span>
<a name="l01932"></a>01932 <span class="comment"> * random sample of approximately sqrt(p)/4 points. If any of those are</span>
<a name="l01933"></a>01933 <span class="comment"> * intersect, then it immediately returns true. Otherwise, it takes the closest</span>
<a name="l01934"></a>01934 <span class="comment"> * point and passes that to plane_intersect_track() routine.</span>
<a name="l01935"></a>01935 <span class="comment"> * \param[in] (x,y,z) The normal vector to the plane.</span>
<a name="l01936"></a>01936 <span class="comment"> * \param[in] rsq The distance along this vector of the plane.</span>
<a name="l01937"></a>01937 <span class="comment"> * \return false if the plane does not intersect the plane, true if it does.*/</span>
<a name="l01938"></a>01938 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01939"></a><a class="code" href="classvoronoicell__base.html#b3e411308c12a386e6a8f22d67bfc547">01939</a> <span class="keywordtype">bool</span> <a class="code" href="classvoronoicell__base.html#b3e411308c12a386e6a8f22d67bfc547">voronoicell_base&lt;n_option&gt;::plane_intersects_guess</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> rsq) {
<a name="l01940"></a>01940         <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=0;
<a name="l01941"></a>01941         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> g=x*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]+y*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>+1]+z*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>+2];
<a name="l01942"></a>01942         <span class="keywordflow">if</span> (g&lt;rsq) { 
<a name="l01943"></a>01943                 <span class="keywordtype">int</span> ca=1,cc=p&gt;&gt;3,mp=1;
<a name="l01944"></a>01944                 <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> m;
<a name="l01945"></a>01945                 <span class="keywordflow">while</span>(ca&lt;cc) {
<a name="l01946"></a>01946                         m=x*pts[3*mp]+y*pts[3*mp+1]+z*pts[3*mp+2];
<a name="l01947"></a>01947                         <span class="keywordflow">if</span> (m&gt;g) {
<a name="l01948"></a>01948                                 <span class="keywordflow">if</span> (m&gt;rsq) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01949"></a>01949                                 g=m;<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=mp;
<a name="l01950"></a>01950                         }
<a name="l01951"></a>01951                         ca+=mp++;
<a name="l01952"></a>01952                 }
<a name="l01953"></a>01953                 <span class="keywordflow">return</span> plane_intersects_track(x,y,z,rsq,g);
<a name="l01954"></a>01954         }
<a name="l01955"></a>01955         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01956"></a>01956 }
<a name="l01957"></a>01957 
<a name="l01958"></a>01958 <span class="comment">/* This routine tests to see if a cell intersects a plane, by tracing over the cell from</span>
<a name="l01959"></a>01959 <span class="comment"> * vertex to vertex, starting at up. It is meant to be called either by plane_intersects()</span>
<a name="l01960"></a>01960 <span class="comment"> * or plane_intersects_track(), when those routines cannot immediately resolve the case.</span>
<a name="l01961"></a>01961 <span class="comment"> * \param[in] (x,y,z) The normal vector to the plane.</span>
<a name="l01962"></a>01962 <span class="comment"> * \param[in] rsq The distance along this vector of the plane.</span>
<a name="l01963"></a>01963 <span class="comment"> * \param[in] g The distance of up from the plane.</span>
<a name="l01964"></a>01964 <span class="comment"> * \return false if the plane does not intersect the plane, true if it does.*/</span>
<a name="l01965"></a>01965 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01966"></a>01966 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;::plane_intersects_track</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> rsq,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> g) {
<a name="l01967"></a>01967         <span class="keywordtype">int</span> count=0,ls,us,tp;
<a name="l01968"></a>01968         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> t;
<a name="l01969"></a>01969         <span class="comment">// The test point is outside of the cutting space</span>
<a name="l01970"></a>01970         <span class="keywordflow">for</span>(us=0;us&lt;nu[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>];us++) {
<a name="l01971"></a>01971                 tp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][us];
<a name="l01972"></a>01972                 t=x*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*tp]+y*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*tp+1]+z*<a class="code" href="classvoronoicell__base.html#072285dd9822757dac3c567e5db87787">pts</a>[3*tp+2];
<a name="l01973"></a>01973                 <span class="keywordflow">if</span>(t&gt;g) {
<a name="l01974"></a>01974                         ls=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][nu[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]+us];
<a name="l01975"></a>01975                         <a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>=tp;
<a name="l01976"></a>01976                         <span class="keywordflow">while</span> (t&lt;rsq) {
<a name="l01977"></a>01977                                 <span class="keywordflow">if</span> (++count&gt;=p) {
<a name="l01978"></a>01978 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=1</span>
<a name="l01979"></a>01979 <span class="preprocessor"></span>                                        cerr &lt;&lt; <span class="stringliteral">"Bailed out of convex calculation"</span> &lt;&lt; endl;
<a name="l01980"></a>01980 <span class="preprocessor">#endif</span>
<a name="l01981"></a>01981 <span class="preprocessor"></span>                                        <span class="keywordflow">for</span>(tp=0;tp&lt;p;tp++) if (x*pts[3*tp]+y*pts[3*tp+1]+z*pts[3*tp+2]&gt;rsq) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01982"></a>01982                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01983"></a>01983                                 }
<a name="l01984"></a>01984                                 
<a name="l01985"></a>01985                                 <span class="comment">// Test all the neighbors of the current point</span>
<a name="l01986"></a>01986                                 <span class="comment">// and find the one which is closest to the</span>
<a name="l01987"></a>01987                                 <span class="comment">// plane</span>
<a name="l01988"></a>01988                                 <span class="keywordflow">for</span>(us=0;us&lt;ls;us++) {
<a name="l01989"></a>01989                                         tp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>][us];
<a name="l01990"></a>01990                                         g=x*pts[3*tp]+y*pts[3*tp+1]+z*pts[3*tp+2];
<a name="l01991"></a>01991                                         <span class="keywordflow">if</span>(g&gt;t) <span class="keywordflow">break</span>;
<a name="l01992"></a>01992                                 }
<a name="l01993"></a>01993                                 <span class="keywordflow">if</span> (us==ls) {
<a name="l01994"></a>01994                                         us++;
<a name="l01995"></a>01995                                         <span class="keywordflow">while</span>(us&lt;nu[<a class="code" href="classvoronoicell__base.html#21d752d315686c1cb0ff0fe0cd7be517">up</a>]) {
<a name="l01996"></a>01996                                                 tp=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][us];
<a name="l01997"></a>01997                                                 g=x*pts[3*tp]+y*pts[3*tp+1]+z*pts[3*tp+2];
<a name="l01998"></a>01998                                                 <span class="keywordflow">if</span>(g&gt;t) <span class="keywordflow">break</span>;
<a name="l01999"></a>01999                                                 us++;
<a name="l02000"></a>02000                                         }
<a name="l02001"></a>02001                                         <span class="keywordflow">if</span> (us==nu[up]) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02002"></a>02002                                 }
<a name="l02003"></a>02003                                 ls=<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>[up][nu[up]+us];up=tp;t=g;
<a name="l02004"></a>02004                         }
<a name="l02005"></a>02005                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02006"></a>02006                 }
<a name="l02007"></a>02007         }
<a name="l02008"></a>02008         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02009"></a>02009 }
<a name="l02010"></a>02010 <span class="comment"></span>
<a name="l02011"></a>02011 <span class="comment">/** This constructs the neighbor_track class, within a current</span>
<a name="l02012"></a>02012 <span class="comment"> * voronoicell_neighbor class. It allocates memory for neighbor storage in a</span>
<a name="l02013"></a>02013 <span class="comment"> * similar way to the voronoicell constructor. */</span>
<a name="l02014"></a><a class="code" href="classneighbor__track.html#ef96f70a5c56b52035c896e45eb4062b">02014</a> <a class="code" href="classneighbor__track.html#ef96f70a5c56b52035c896e45eb4062b">neighbor_track::neighbor_track</a>(<a class="code" href="classvoronoicell__base.html">voronoicell_base&lt;neighbor_track&gt;</a> *ivc) : vc(ivc) {
<a name="l02015"></a>02015         <span class="keywordtype">int</span> i;
<a name="l02016"></a>02016         <a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>=<span class="keyword">new</span> <span class="keywordtype">int</span>*[<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#2ed244530d520c44b15e1fda58c851e5">current_vertex_order</a>];
<a name="l02017"></a>02017         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>=<span class="keyword">new</span> <span class="keywordtype">int</span>*[<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#8377a6f596e11724fd9117ea1f54b974">current_vertices</a>];
<a name="l02018"></a>02018         <span class="keywordflow">for</span>(i=0;i&lt;3;i++) <a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[i]=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="config_8hh.html#54dfde30057ff6daba861ac3dcea7c93">init_n_vertices</a>*i];
<a name="l02019"></a>02019         <a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[3]=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="config_8hh.html#6fc50d4f33fe39dcd146b6108de77515">init_3_vertices</a>*3];
<a name="l02020"></a>02020         <span class="keywordflow">for</span>(i=4;i&lt;<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#2ed244530d520c44b15e1fda58c851e5">current_vertex_order</a>;i++) <a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[i]=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="config_8hh.html#54dfde30057ff6daba861ac3dcea7c93">init_n_vertices</a>*i];
<a name="l02021"></a>02021 }
<a name="l02022"></a>02022 <span class="comment"></span>
<a name="l02023"></a>02023 <span class="comment">/** The destructor for the neighbor_track class deallocates the arrays</span>
<a name="l02024"></a>02024 <span class="comment"> * for neighbor tracking. */</span>
<a name="l02025"></a><a class="code" href="classneighbor__track.html#dde5fc6aa72b825dcd4fa31ccb80b2e8">02025</a> <a class="code" href="classneighbor__track.html#dde5fc6aa72b825dcd4fa31ccb80b2e8">neighbor_track::~neighbor_track</a>() {
<a name="l02026"></a>02026         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#2ed244530d520c44b15e1fda58c851e5">current_vertex_order</a>;i++) <span class="keywordflow">if</span> (<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#8b992e92007a014e66c24c0ee3612ecc">mem</a>[i]&gt;0) <span class="keyword">delete</span> [] <a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[i];
<a name="l02027"></a>02027         <span class="keyword">delete</span> [] <a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>;
<a name="l02028"></a>02028         <span class="keyword">delete</span> [] <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>;   
<a name="l02029"></a>02029 }
<a name="l02030"></a>02030 <span class="comment"></span>
<a name="l02031"></a>02031 <span class="comment">/** This allocates a single array for neighbor tracking.</span>
<a name="l02032"></a>02032 <span class="comment"> * \param[in] i the vertex order of the array to be extended.</span>
<a name="l02033"></a>02033 <span class="comment"> * \param[in] m the size of the array to be extended. */</span>
<a name="l02034"></a><a class="code" href="classneighbor__track.html#a5fea45203718d7ff6cee124f5985b34">02034</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#a5fea45203718d7ff6cee124f5985b34">neighbor_track::allocate</a>(<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> m) {
<a name="l02035"></a>02035         <a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[i]=<span class="keyword">new</span> <span class="keywordtype">int</span>[m*i];
<a name="l02036"></a>02036 }
<a name="l02037"></a>02037 <span class="comment"></span>
<a name="l02038"></a>02038 <span class="comment">/** This increases the size of the ne[] array.</span>
<a name="l02039"></a>02039 <span class="comment"> * \param[in] i the new size of the array. */</span>
<a name="l02040"></a><a class="code" href="classneighbor__track.html#72e53fc5329776e53dd1a37040c428a9">02040</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#72e53fc5329776e53dd1a37040c428a9">neighbor_track::add_memory_vertices</a>(<span class="keywordtype">int</span> i) {
<a name="l02041"></a>02041         <span class="keywordtype">int</span> **pp;
<a name="l02042"></a>02042         pp=<span class="keyword">new</span> <span class="keywordtype">int</span>*[i];
<a name="l02043"></a>02043         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#8377a6f596e11724fd9117ea1f54b974">current_vertices</a>;j++) pp[j]=<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[j];
<a name="l02044"></a>02044         <span class="keyword">delete</span> [] <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>=pp;
<a name="l02045"></a>02045 }
<a name="l02046"></a>02046 <span class="comment"></span>
<a name="l02047"></a>02047 <span class="comment">/** This increases the size of the maximum allowable vertex</span>
<a name="l02048"></a>02048 <span class="comment"> * order in the neighbor tracking. */</span>
<a name="l02049"></a><a class="code" href="classneighbor__track.html#3e21ee8ea9aea4e16ba3debb0533f219">02049</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#3e21ee8ea9aea4e16ba3debb0533f219">neighbor_track::add_memory_vorder</a>(<span class="keywordtype">int</span> i) {
<a name="l02050"></a>02050         <span class="keywordtype">int</span> **p2;
<a name="l02051"></a>02051         p2=<span class="keyword">new</span> <span class="keywordtype">int</span>*[i];
<a name="l02052"></a>02052         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#2ed244530d520c44b15e1fda58c851e5">current_vertex_order</a>;j++) p2[j]=<a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[j];
<a name="l02053"></a>02053         <span class="keyword">delete</span> [] <a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>;<a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>=p2;
<a name="l02054"></a>02054 }
<a name="l02055"></a>02055 <span class="comment"></span>
<a name="l02056"></a>02056 <span class="comment">/** This initializes the neighbor information for a rectangular box</span>
<a name="l02057"></a>02057 <span class="comment"> * and is called during the initialization routine for the voronoicell</span>
<a name="l02058"></a>02058 <span class="comment"> * class. */</span>
<a name="l02059"></a><a class="code" href="classneighbor__track.html#e2311499cf4923bd6f91d47c81be43de">02059</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#e2311499cf4923bd6f91d47c81be43de">neighbor_track::init</a>() {
<a name="l02060"></a>02060         <span class="keywordtype">int</span> *q;
<a name="l02061"></a>02061         q=<a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[3];
<a name="l02062"></a>02062         q[0]=-5;q[1]=-3;q[2]=-1;
<a name="l02063"></a>02063         q[3]=-5;q[4]=-2;q[5]=-3;
<a name="l02064"></a>02064         q[6]=-5;q[7]=-1;q[8]=-4;
<a name="l02065"></a>02065         q[9]=-5;q[10]=-4;q[11]=-2;
<a name="l02066"></a>02066         q[12]=-6;q[13]=-1;q[14]=-3;
<a name="l02067"></a>02067         q[15]=-6;q[16]=-3;q[17]=-2;
<a name="l02068"></a>02068         q[18]=-6;q[19]=-4;q[20]=-1;
<a name="l02069"></a>02069         q[21]=-6;q[22]=-2;q[23]=-4;
<a name="l02070"></a>02070         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[0]=q;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[1]=q+3;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[2]=q+6;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[3]=q+9;
<a name="l02071"></a>02071         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[4]=q+12;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[5]=q+15;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[6]=q+18;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[7]=q+21;
<a name="l02072"></a>02072 }
<a name="l02073"></a>02073 <span class="comment"></span>
<a name="l02074"></a>02074 <span class="comment">/** This initializes the neighbor information for an octahedron. The eight</span>
<a name="l02075"></a>02075 <span class="comment"> * initial faces are assigned ID numbers from -1 to -8. */</span>
<a name="l02076"></a><a class="code" href="classneighbor__track.html#2cde87cf51a6634b1eaf820eeca83657">02076</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#2cde87cf51a6634b1eaf820eeca83657">neighbor_track::init_octahedron</a>() {
<a name="l02077"></a>02077         <span class="keywordtype">int</span> *q;
<a name="l02078"></a>02078         q=<a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[4];
<a name="l02079"></a>02079         q[0]=-5;q[1]=-6;q[2]=-7;q[3]=-8;
<a name="l02080"></a>02080         q[4]=-1;q[5]=-2;q[6]=-3;q[7]=-4;
<a name="l02081"></a>02081         q[8]=-6;q[9]=-5;q[10]=-2;q[11]=-1;
<a name="l02082"></a>02082         q[12]=-8;q[13]=-7;q[14]=-4;q[15]=-3;
<a name="l02083"></a>02083         q[16]=-5;q[17]=-8;q[18]=-3;q[19]=-2;
<a name="l02084"></a>02084         q[20]=-7;q[21]=-6;q[22]=-1;q[23]=-4;
<a name="l02085"></a>02085         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[0]=q;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[1]=q+4;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[2]=q+8;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[3]=q+12;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[4]=q+16;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[5]=q+20;
<a name="l02086"></a>02086 }
<a name="l02087"></a>02087 <span class="comment"></span>
<a name="l02088"></a>02088 <span class="comment">/** This initializes the neighbor information for an tetrahedron. The four</span>
<a name="l02089"></a>02089 <span class="comment"> * initial faces are assigned ID numbers from -1 to -4.*/</span>
<a name="l02090"></a><a class="code" href="classneighbor__track.html#61bfaa09392e7b4c8fecac0cd79a7e42">02090</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#61bfaa09392e7b4c8fecac0cd79a7e42">neighbor_track::init_tetrahedron</a>() {
<a name="l02091"></a>02091         <span class="keywordtype">int</span> *q;
<a name="l02092"></a>02092         q=<a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[3];
<a name="l02093"></a>02093         q[0]=-4;q[1]=-3;q[2]=-2;
<a name="l02094"></a>02094         q[3]=-3;q[4]=-4;q[5]=-1;
<a name="l02095"></a>02095         q[6]=-4;q[7]=-2;q[8]=-1;
<a name="l02096"></a>02096         q[9]=-2;q[10]=-3;q[11]=-1;
<a name="l02097"></a>02097         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[0]=q;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[1]=q+3;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[2]=q+6;<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[3]=q+9;
<a name="l02098"></a>02098 }
<a name="l02099"></a>02099 <span class="comment"></span>
<a name="l02100"></a>02100 <span class="comment">/** This is a basic operation to set a new pointer in the ne[] array.</span>
<a name="l02101"></a>02101 <span class="comment"> * \param[in] p the index in the ne[] array to set.</span>
<a name="l02102"></a>02102 <span class="comment"> * \param[in] n the order of the vertex. */</span>
<a name="l02103"></a><a class="code" href="classneighbor__track.html#e566d477b48c2f66d3a02335b2d1c44d">02103</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#e566d477b48c2f66d3a02335b2d1c44d">neighbor_track::set_pointer</a>(<span class="keywordtype">int</span> p,<span class="keywordtype">int</span> n) {
<a name="l02104"></a>02104         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[p]=<a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[n]+n*<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#ef0e4564cb79df084a577810f20dd5f4">mec</a>[n];
<a name="l02105"></a>02105 }
<a name="l02106"></a>02106 <span class="comment"></span>
<a name="l02107"></a>02107 <span class="comment">/** This is a basic operation to copy ne[c][d] to ne[a][b]. */</span>
<a name="l02108"></a><a class="code" href="classneighbor__track.html#cf9ebc4c7347ef5df74ff0fa15c28536">02108</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#cf9ebc4c7347ef5df74ff0fa15c28536">neighbor_track::copy</a>(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b,<span class="keywordtype">int</span> c,<span class="keywordtype">int</span> d) {
<a name="l02109"></a>02109         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[a][b]=<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[c][d];
<a name="l02110"></a>02110 }
<a name="l02111"></a>02111 <span class="comment"></span>
<a name="l02112"></a>02112 <span class="comment">/** This is a basic operation to carry out ne[a][b]=c. */</span>
<a name="l02113"></a><a class="code" href="classneighbor__track.html#48e7b6522bb6797b8b8374c7edf769b7">02113</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#48e7b6522bb6797b8b8374c7edf769b7">neighbor_track::set</a>(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b,<span class="keywordtype">int</span> c) {
<a name="l02114"></a>02114         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[a][b]=c;
<a name="l02115"></a>02115 }
<a name="l02116"></a>02116 <span class="comment"></span>
<a name="l02117"></a>02117 <span class="comment">/** This is a basic operation to set the auxiliary pointer</span>
<a name="l02118"></a>02118 <span class="comment"> * paux1.</span>
<a name="l02119"></a>02119 <span class="comment"> * \param[in] k the order of the vertex to point to. */</span>
<a name="l02120"></a><a class="code" href="classneighbor__track.html#1090b828eff159c052019717d6c62557">02120</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#1090b828eff159c052019717d6c62557">neighbor_track::set_aux1</a>(<span class="keywordtype">int</span> k) {
<a name="l02121"></a>02121         paux1=<a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[k]+k*<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#ef0e4564cb79df084a577810f20dd5f4">mec</a>[k];
<a name="l02122"></a>02122 }
<a name="l02123"></a>02123 <span class="comment"></span>
<a name="l02124"></a>02124 <span class="comment">/** This is a basic operation to copy a neighbor into paux1.*/</span>
<a name="l02125"></a><a class="code" href="classneighbor__track.html#3dce8a169a7d164a3ba63f324e02b214">02125</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#3dce8a169a7d164a3ba63f324e02b214">neighbor_track::copy_aux1</a>(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b) {
<a name="l02126"></a>02126         paux1[b]=<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[a][b];
<a name="l02127"></a>02127 }
<a name="l02128"></a>02128 <span class="comment"></span>
<a name="l02129"></a>02129 <span class="comment">/** This is a basic operation to copy a neighbor into paux1 with a shift. It is</span>
<a name="l02130"></a>02130 <span class="comment"> * used in the delete_connection() routine of the voronoicell class. */</span>
<a name="l02131"></a><a class="code" href="classneighbor__track.html#68417b0850d6877383395516ea33831d">02131</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#68417b0850d6877383395516ea33831d">neighbor_track::copy_aux1_shift</a>(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b) {
<a name="l02132"></a>02132         paux1[b]=<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[a][b+1];
<a name="l02133"></a>02133 }
<a name="l02134"></a>02134 <span class="comment"></span>
<a name="l02135"></a>02135 <span class="comment">/** This routine sets the second auxiliary pointer to a new section</span>
<a name="l02136"></a>02136 <span class="comment"> * of memory, and then copies existing neighbor information into it. */</span>
<a name="l02137"></a><a class="code" href="classneighbor__track.html#5f57496b6c72072060cdb5bfba20a0da">02137</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#5f57496b6c72072060cdb5bfba20a0da">neighbor_track::set_aux2_copy</a>(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b) {
<a name="l02138"></a>02138         paux2=<a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[b]+b*<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#ef0e4564cb79df084a577810f20dd5f4">mec</a>[b];
<a name="l02139"></a>02139         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;b;i++) <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[a][i]=paux2[i];
<a name="l02140"></a>02140 }
<a name="l02141"></a>02141 <span class="comment"></span>
<a name="l02142"></a>02142 <span class="comment">/** This is a basic routine to copy ne[b] into ne[a]. */</span>
<a name="l02143"></a><a class="code" href="classneighbor__track.html#2b1f1003b71fec10d5e4e6e0ebb1547c">02143</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#2b1f1003b71fec10d5e4e6e0ebb1547c">neighbor_track::copy_pointer</a>(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b) {
<a name="l02144"></a>02144         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[a]=<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[b];
<a name="l02145"></a>02145 }
<a name="l02146"></a>02146 <span class="comment"></span>
<a name="l02147"></a>02147 <span class="comment">/** This sets ne[j] to the first auxiliary pointer. */</span>
<a name="l02148"></a><a class="code" href="classneighbor__track.html#fa83b77cc14edaa39ba9558ceea6c4f6">02148</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#fa83b77cc14edaa39ba9558ceea6c4f6">neighbor_track::set_to_aux1</a>(<span class="keywordtype">int</span> j) {
<a name="l02149"></a>02149         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[j]=paux1;
<a name="l02150"></a>02150 }
<a name="l02151"></a>02151 <span class="comment"></span>
<a name="l02152"></a>02152 <span class="comment">/** This sets ne[j] to the second auxiliary pointer. */</span>
<a name="l02153"></a><a class="code" href="classneighbor__track.html#06468b7a48bcd3318f22a09ece4f67b7">02153</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#06468b7a48bcd3318f22a09ece4f67b7">neighbor_track::set_to_aux2</a>(<span class="keywordtype">int</span> j) {
<a name="l02154"></a>02154         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[j]=paux2;
<a name="l02155"></a>02155 }
<a name="l02156"></a>02156 <span class="comment"></span>
<a name="l02157"></a>02157 <span class="comment">/** This prints out the neighbor information for vertex i. */</span>
<a name="l02158"></a><a class="code" href="classneighbor__track.html#2a007876a10688a855c8a220e8d4e679">02158</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#2a007876a10688a855c8a220e8d4e679">neighbor_track::print_edges</a>(<span class="keywordtype">int</span> i) {
<a name="l02159"></a>02159         cout &lt;&lt; <span class="stringliteral">"    ("</span>;
<a name="l02160"></a>02160         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[i];j++) {
<a name="l02161"></a>02161                 cout &lt;&lt; <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[i][j] &lt;&lt; (j==<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>[i]-1?<span class="stringliteral">")"</span>:<span class="stringliteral">","</span>);
<a name="l02162"></a>02162         }
<a name="l02163"></a>02163 }
<a name="l02164"></a>02164 <span class="comment"></span>
<a name="l02165"></a>02165 <span class="comment">/** This allocates a new array and sets the auxiliary pointer</span>
<a name="l02166"></a>02166 <span class="comment"> * to it. */</span>
<a name="l02167"></a><a class="code" href="classneighbor__track.html#236ce879ae393cb249e15ed09144dae4">02167</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#236ce879ae393cb249e15ed09144dae4">neighbor_track::allocate_aux1</a>(<span class="keywordtype">int</span> i) {
<a name="l02168"></a>02168         paux1=<span class="keyword">new</span> <span class="keywordtype">int</span>[i*<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#8b992e92007a014e66c24c0ee3612ecc">mem</a>[i]];
<a name="l02169"></a>02169 }
<a name="l02170"></a>02170 <span class="comment"></span>
<a name="l02171"></a>02171 <span class="comment">/** This deletes a particular neighbor array and switches the</span>
<a name="l02172"></a>02172 <span class="comment"> * pointer to the auxiliary pointer. */</span>
<a name="l02173"></a><a class="code" href="classneighbor__track.html#548bd62d96c238749a5317d73fdd7556">02173</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#548bd62d96c238749a5317d73fdd7556">neighbor_track::switch_to_aux1</a>(<span class="keywordtype">int</span> i) {
<a name="l02174"></a>02174         <span class="keyword">delete</span> [] <a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[i];
<a name="l02175"></a>02175         <a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[i]=paux1;
<a name="l02176"></a>02176 }
<a name="l02177"></a>02177 <span class="comment"></span>
<a name="l02178"></a>02178 <span class="comment">/** This routine copies neighbor information into the</span>
<a name="l02179"></a>02179 <span class="comment"> * auxiliary pointer. */</span>
<a name="l02180"></a><a class="code" href="classneighbor__track.html#0db58f870472bc3a742f60387ccb2686">02180</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#0db58f870472bc3a742f60387ccb2686">neighbor_track::copy_to_aux1</a>(<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> m) {
<a name="l02181"></a>02181         paux1[m]=<a class="code" href="classneighbor__track.html#c6d6c54a969122e6b49177363a3f333e">mne</a>[i][m];
<a name="l02182"></a>02182 }
<a name="l02183"></a>02183 <span class="comment"></span>
<a name="l02184"></a>02184 <span class="comment">/** This sets ne[k] to the auxiliary pointer with an offset. */</span>
<a name="l02185"></a><a class="code" href="classneighbor__track.html#f92b4f69cb670f73809b7d97502cb5d1">02185</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#f92b4f69cb670f73809b7d97502cb5d1">neighbor_track::set_to_aux1_offset</a>(<span class="keywordtype">int</span> k,<span class="keywordtype">int</span> m) {
<a name="l02186"></a>02186         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[k]=paux1+m;
<a name="l02187"></a>02187 }
<a name="l02188"></a>02188 <span class="comment"></span>
<a name="l02189"></a>02189 <span class="comment">/** This routine checks to make sure the neighbor information of each facets is</span>
<a name="l02190"></a>02190 <span class="comment"> * consistent.*/</span>
<a name="l02191"></a><a class="code" href="classneighbor__track.html#0823f6a6304a8c19722493ec5dc1203b">02191</a> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#0823f6a6304a8c19722493ec5dc1203b">neighbor_track::check_facets</a>() {
<a name="l02192"></a>02192         <span class="keywordtype">int</span> **edp,*nup;edp=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>;nup=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>;
<a name="l02193"></a>02193         <span class="keywordtype">int</span> i,j,k,l,m,q;
<a name="l02194"></a>02194         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i++) {
<a name="l02195"></a>02195                 <span class="keywordflow">for</span>(j=0;j&lt;nup[i];j++) {
<a name="l02196"></a>02196                         k=edp[i][j];
<a name="l02197"></a>02197                         <span class="keywordflow">if</span> (k&gt;=0) {
<a name="l02198"></a>02198                                 edp[i][j]=-1-k;
<a name="l02199"></a>02199                                 q=<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[i][j];
<a name="l02200"></a>02200                                 l=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#6bbb8fab3d99b148e49b6159387e0c67">cycle_up</a>(edp[i][nup[i]+j],k);
<a name="l02201"></a>02201                                 <span class="keywordflow">do</span> {
<a name="l02202"></a>02202                                         m=edp[k][l];
<a name="l02203"></a>02203                                         edp[k][l]=-1-m;
<a name="l02204"></a>02204                                         <span class="keywordflow">if</span> (<a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[k][l]!=q) cerr &lt;&lt; <span class="stringliteral">"Facet error at ("</span> &lt;&lt; k &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; l &lt;&lt; <span class="stringliteral">")="</span> &lt;&lt; <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[k][l] &lt;&lt; <span class="stringliteral">", started from ("</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">")="</span> &lt;&lt; q &lt;&lt; endl;
<a name="l02205"></a>02205                                         l=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#6bbb8fab3d99b148e49b6159387e0c67">cycle_up</a>(edp[k][nup[k]+l],m);
<a name="l02206"></a>02206                                         k=m;
<a name="l02207"></a>02207                                 } <span class="keywordflow">while</span> (k!=i);
<a name="l02208"></a>02208                         }
<a name="l02209"></a>02209                 }
<a name="l02210"></a>02210         }
<a name="l02211"></a>02211         <a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#78d09feac758fa464215948cc3fa9473">reset_edges</a>();
<a name="l02212"></a>02212 }
<a name="l02213"></a>02213 <span class="comment"></span>
<a name="l02214"></a>02214 <span class="comment">/** This routine provides a list of plane IDs.</span>
<a name="l02215"></a>02215 <span class="comment"> * \param[in] &amp;os An output stream to write to. */</span>
<a name="l02216"></a><a class="code" href="classneighbor__track.html#e662fa8a140980d0c00cc19436777dd5">02216</a> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#e662fa8a140980d0c00cc19436777dd5">neighbor_track::neighbors</a>(ostream &amp;os) {
<a name="l02217"></a>02217         <span class="keywordtype">int</span> **edp,*nup;edp=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>;nup=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>;
<a name="l02218"></a>02218         <span class="keywordtype">int</span> i,j,k,l,m;
<a name="l02219"></a>02219         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i++) {
<a name="l02220"></a>02220                 <span class="keywordflow">for</span>(j=0;j&lt;nup[i];j++) {
<a name="l02221"></a>02221                         k=edp[i][j];
<a name="l02222"></a>02222                         <span class="keywordflow">if</span> (k&gt;=0) {
<a name="l02223"></a>02223                                 os &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[i][j];
<a name="l02224"></a>02224                                 edp[i][j]=-1-k;
<a name="l02225"></a>02225                                 l=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#6bbb8fab3d99b148e49b6159387e0c67">cycle_up</a>(edp[i][nup[i]+j],k);
<a name="l02226"></a>02226                                 <span class="keywordflow">do</span> {
<a name="l02227"></a>02227                                         m=edp[k][l];
<a name="l02228"></a>02228                                         edp[k][l]=-1-m;
<a name="l02229"></a>02229                                         l=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#6bbb8fab3d99b148e49b6159387e0c67">cycle_up</a>(edp[k][nup[k]+l],m);
<a name="l02230"></a>02230                                         k=m;
<a name="l02231"></a>02231                                 } <span class="keywordflow">while</span> (k!=i);
<a name="l02232"></a>02232                         }
<a name="l02233"></a>02233                 }
<a name="l02234"></a>02234         }
<a name="l02235"></a>02235         <a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#78d09feac758fa464215948cc3fa9473">reset_edges</a>();
<a name="l02236"></a>02236 }
<a name="l02237"></a>02237 <span class="comment"></span>
<a name="l02238"></a>02238 <span class="comment">/** This routine labels the facets in an arbitrary order, starting from one. */</span>
<a name="l02239"></a><a class="code" href="classneighbor__track.html#c8e7e5f32d743e1499a89457275336d6">02239</a> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#c8e7e5f32d743e1499a89457275336d6">neighbor_track::label_facets</a>() {
<a name="l02240"></a>02240         <span class="keywordtype">int</span> **edp,*nup;edp=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#5a38499308a8ae49b834bbdf023bde2c">ed</a>;nup=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#5802bd6fec5e9b5e60457cb48a691215">nu</a>;
<a name="l02241"></a>02241         <span class="keywordtype">int</span> i,j,k,l,m,q=1;
<a name="l02242"></a>02242         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#b17db70e72a9f9ab8bab14211459e757">p</a>;i++) {
<a name="l02243"></a>02243                 <span class="keywordflow">for</span>(j=0;j&lt;nup[i];j++) {
<a name="l02244"></a>02244                         k=edp[i][j];
<a name="l02245"></a>02245                         <span class="keywordflow">if</span> (k&gt;=0) {
<a name="l02246"></a>02246                                 edp[i][j]=-1-k;
<a name="l02247"></a>02247                                 <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[i][j]=q;
<a name="l02248"></a>02248                                 l=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#6bbb8fab3d99b148e49b6159387e0c67">cycle_up</a>(edp[i][nup[i]+j],k);
<a name="l02249"></a>02249                                 <span class="keywordflow">do</span> {
<a name="l02250"></a>02250                                         m=edp[k][l];
<a name="l02251"></a>02251                                         edp[k][l]=-1-m;
<a name="l02252"></a>02252                                         <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[k][l]=q;
<a name="l02253"></a>02253                                         l=<a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#6bbb8fab3d99b148e49b6159387e0c67">cycle_up</a>(edp[k][nup[k]+l],m);
<a name="l02254"></a>02254                                         k=m;
<a name="l02255"></a>02255                                 } <span class="keywordflow">while</span> (k!=i);
<a name="l02256"></a>02256                                 q++;
<a name="l02257"></a>02257                         }
<a name="l02258"></a>02258                 }
<a name="l02259"></a>02259         }
<a name="l02260"></a>02260         <a class="code" href="classneighbor__track.html#437adbc75eab20fb7c1f74c2aaa1b198">vc</a>-&gt;<a class="code" href="classvoronoicell__base.html#78d09feac758fa464215948cc3fa9473">reset_edges</a>();
<a name="l02261"></a>02261 }
<a name="l02262"></a>02262 <span class="comment"></span>
<a name="l02263"></a>02263 <span class="comment">/** This routine prints out a bracketed pair showing a vertex number, and the</span>
<a name="l02264"></a>02264 <span class="comment"> * corresponding neighbor information.</span>
<a name="l02265"></a>02265 <span class="comment"> * \param[in] &amp;os The output stream to write to.</span>
<a name="l02266"></a>02266 <span class="comment"> * \param[in] i The vertex number to print.</span>
<a name="l02267"></a>02267 <span class="comment"> * \param[in] j The index of the neighbor information to print. */</span>
<a name="l02268"></a><a class="code" href="classneighbor__track.html#ec8ae241f4a543f62538fab014904929">02268</a> <span class="keywordtype">void</span> <a class="code" href="classneighbor__track.html#ec8ae241f4a543f62538fab014904929">neighbor_track::print</a>(ostream &amp;os,<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> j) {
<a name="l02269"></a>02269         os &lt;&lt; <span class="stringliteral">"("</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; <a class="code" href="classneighbor__track.html#16268e0703914b02034d9427cd8eb329">ne</a>[i][j] &lt;&lt; <span class="stringliteral">")"</span>;
<a name="l02270"></a>02270 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Mar 23 16:52:34 2009 for Voro++ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
