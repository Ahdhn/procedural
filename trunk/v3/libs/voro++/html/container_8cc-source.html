<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Voro++: container.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>container.cc</h1><a href="container_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Voro++, a 3D cell-based Voronoi library</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// Author   : Chris H. Rycroft (LBL / UC Berkeley)</span>
<a name="l00004"></a>00004 <span class="comment">// Email    : chr@alum.mit.edu</span>
<a name="l00005"></a>00005 <span class="comment">// Date     : July 1st 2008</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">/** \file container.cc</span>
<a name="l00008"></a>00008 <span class="comment"> * \brief Function implementations for the container_base template and related</span>
<a name="l00009"></a>00009 <span class="comment"> * classes. */</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="cell_8hh.html" title="Header file for the voronoicell_base template and related classes.">cell.hh</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include "<a class="code" href="container_8hh.html" title="Header file for the container_base template and related classes.">container.hh</a>"</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">/** Container constructor. The first six arguments set the corners of the box to</span>
<a name="l00015"></a>00015 <span class="comment"> * be (xa,ya,za) and (xb,yb,zb). The box is then divided into an nx by ny by nz</span>
<a name="l00016"></a>00016 <span class="comment"> * grid of blocks, set by the following three arguments. The next three</span>
<a name="l00017"></a>00017 <span class="comment"> * arguments are booleans, which set the periodicity in each direction. The</span>
<a name="l00018"></a>00018 <span class="comment"> * final argument sets the amount of memory allocated to each block. */</span>
<a name="l00019"></a>00019 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00020"></a><a class="code" href="classcontainer__base.html#d1fbab0b4342387a9d6df042224f896b">00020</a> <a class="code" href="classcontainer__base.html#d1fbab0b4342387a9d6df042224f896b">container_base&lt;r_option&gt;::container_base</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xa,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xb,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ya,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> yb,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> za,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zb,
<a name="l00021"></a>00021                 <span class="keywordtype">int</span> xn,<span class="keywordtype">int</span> yn,<span class="keywordtype">int</span> zn,<span class="keywordtype">bool</span> xper,<span class="keywordtype">bool</span> yper,<span class="keywordtype">bool</span> zper,<span class="keywordtype">int</span> memi)
<a name="l00022"></a>00022         : ax(xa),bx(xb),ay(ya),by(yb),az(za),bz(zb),
<a name="l00023"></a>00023         xsp(xn/(xb-xa)),ysp(yn/(yb-ya)),zsp(zn/(zb-za)),
<a name="l00024"></a>00024         nx(xn),ny(yn),nz(zn),nxy(xn*yn),nxyz(xn*yn*zn),
<a name="l00025"></a>00025         hx(xper?2*xn+1:xn),hy(yper?2*yn+1:yn),hz(zper?2*zn+1:zn),hxy(hx*hy),hxyz(hx*hy*hz),
<a name="l00026"></a>00026         xperiodic(xper),yperiodic(yper),zperiodic(zper),
<a name="l00027"></a>00027         mv(0),wall_number(0),current_wall_size(<a class="code" href="config_8hh.html#0780ede0cf63544b605eef0b9333dad1">init_wall_size</a>),
<a name="l00028"></a>00028         radius(this),sz(radius.mem_size) {
<a name="l00029"></a>00029         <span class="keywordtype">int</span> l;
<a name="l00030"></a>00030         <a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classcontainer__base.html#af78dc03594e20e0e5ad9b51a60948d1">nxyz</a>];
<a name="l00031"></a>00031         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#af78dc03594e20e0e5ad9b51a60948d1">nxyz</a>;l++) <a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[l]=0;
<a name="l00032"></a>00032         <a class="code" href="classcontainer__base.html#893fd68b1c4f386f75d4ab27060ec0ab">mem</a>=<span class="keyword">new</span> <span class="keywordtype">int</span>[nxyz];
<a name="l00033"></a>00033         <span class="keywordflow">for</span>(l=0;l&lt;nxyz;l++) <a class="code" href="classcontainer__base.html#893fd68b1c4f386f75d4ab27060ec0ab">mem</a>[l]=memi;
<a name="l00034"></a>00034         <span class="keywordtype">id</span>=<span class="keyword">new</span> <span class="keywordtype">int</span>*[nxyz];
<a name="l00035"></a>00035         <span class="keywordflow">for</span>(l=0;l&lt;nxyz;l++) <span class="keywordtype">id</span>[l]=<span class="keyword">new</span> <span class="keywordtype">int</span>[memi];
<a name="l00036"></a>00036         <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>=<span class="keyword">new</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a>*[nxyz];
<a name="l00037"></a>00037         <span class="keywordflow">for</span>(l=0;l&lt;nxyz;l++) <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[l]=<span class="keyword">new</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a>[<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*memi];
<a name="l00038"></a>00038         <a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>=<span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[<a class="code" href="classcontainer__base.html#68bf81f3465ca144c9879ba9ea0cc394">hxyz</a>];
<a name="l00039"></a>00039         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#68bf81f3465ca144c9879ba9ea0cc394">hxyz</a>;l++) <a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[l]=0;
<a name="l00040"></a>00040         <a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>=3*(<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>+<a class="code" href="classcontainer__base.html#b351fa9d9000fb963e12647432675355">hz</a>*(<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>+<a class="code" href="classcontainer__base.html#59c9d60832d5778dd99ea61e377d854c">hy</a>));<span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>&lt;18) <a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>=18;
<a name="l00041"></a>00041         <a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>];
<a name="l00042"></a>00042         <a class="code" href="classcontainer__base.html#64783fe54666504bb2a0e504d2f6e9df">walls</a>=<span class="keyword">new</span> <a class="code" href="classwall.html" title="Pure virtual class from which wall objects are derived.">wall</a>*[<a class="code" href="classcontainer__base.html#71db9f70176ba792178c333d6d63d2dc">current_wall_size</a>];
<a name="l00043"></a>00043         <a class="code" href="classcontainer__base.html#286d1f47c6678beb1ff8867037895b07">mrad</a>=<span class="keyword">new</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a>[hgridsq*seq_length];
<a name="l00044"></a>00044         initialize_radii();
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 <span class="comment"></span>
<a name="l00047"></a>00047 <span class="comment">/** This function is called during container construction. The routine scans</span>
<a name="l00048"></a>00048 <span class="comment"> * all of the worklists in the wl[] array. For a given worklist of blocks</span>
<a name="l00049"></a>00049 <span class="comment"> * labeled \f$w_1\f$ to \f$w_n\f$, it computes a sequence \f$r_0\f$ to</span>
<a name="l00050"></a>00050 <span class="comment"> * \f$r_n\f$ so that $r_i$ is the minimum distance to all the blocks</span>
<a name="l00051"></a>00051 <span class="comment"> * \f$w_{j}\f$ where \f$j&gt;i\f$ and all blocks outside the worklist. The values</span>
<a name="l00052"></a>00052 <span class="comment"> * of \f$r_n\f$ is calculated first, as the minimum distance to any block in</span>
<a name="l00053"></a>00053 <span class="comment"> * the shell surrounding the worklist. The \f$r_i\f$ are then computed in</span>
<a name="l00054"></a>00054 <span class="comment"> * reverse order by considering the distance to \f$w_{i+1}\f$.</span>
<a name="l00055"></a>00055 <span class="comment"> */</span>
<a name="l00056"></a>00056 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00057"></a>00057 <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;::initialize_radii</a>() {
<a name="l00058"></a>00058         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> b1=1&lt;&lt;21,b2=1&lt;&lt;22,b3=1&lt;&lt;24,b4=1&lt;&lt;25,b5=1&lt;&lt;27,b6=1&lt;&lt;28;
<a name="l00059"></a>00059         <span class="keyword">const</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xstep=(<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>-<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>)/<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>/fgrid;
<a name="l00060"></a>00060         <span class="keyword">const</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ystep=(<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>-<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>)/<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>/fgrid;
<a name="l00061"></a>00061         <span class="keyword">const</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zstep=(<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>-<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>)/<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>/fgrid;
<a name="l00062"></a>00062         <span class="keywordtype">int</span> i,j,k,lx,ly,lz,l=0,q;
<a name="l00063"></a>00063         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *e=<span class="keyword">const_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*<span class="keyword">&gt;</span> (wl);
<a name="l00064"></a>00064         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xlo,ylo,zlo,xhi,yhi,zhi,minr;<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> *radp=<a class="code" href="classcontainer__base.html#286d1f47c6678beb1ff8867037895b07">mrad</a>;
<a name="l00065"></a>00065         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> f;
<a name="l00066"></a>00066         <span class="keywordflow">for</span>(zlo=0,zhi=zstep,lz=0;lz&lt;hgrid;zlo=zhi,zhi+=zstep,lz++) {
<a name="l00067"></a>00067                 <span class="keywordflow">for</span>(ylo=0,yhi=ystep,ly=0;ly&lt;hgrid;ylo=yhi,yhi+=ystep,ly++) {
<a name="l00068"></a>00068                         <span class="keywordflow">for</span>(xlo=0,xhi=xstep,lx=0;lx&lt;hgrid;xlo=xhi,xhi+=xstep,l++,lx++) {
<a name="l00069"></a>00069                                 minr=<a class="code" href="config_8hh.html#b6d5c74ed955678eb5de4f750a457ac6">large_number</a>;
<a name="l00070"></a>00070                                 <span class="keywordflow">for</span>(q=e[0]+1;q&lt;seq_length;q++) {
<a name="l00071"></a>00071                                         f=e[q];
<a name="l00072"></a>00072                                         i=(f&amp;127)-64;
<a name="l00073"></a>00073                                         j=(f&gt;&gt;7&amp;127)-64;
<a name="l00074"></a>00074                                         k=(f&gt;&gt;14&amp;127)-64;
<a name="l00075"></a>00075                                         <span class="keywordflow">if</span>((f&amp;b2)==b2) {
<a name="l00076"></a>00076                                                 compute_minimum(minr,xlo,xhi,ylo,yhi,zlo,zhi,i-1,j,k);
<a name="l00077"></a>00077                                                 <span class="keywordflow">if</span>((f&amp;b1)==0) compute_minimum(minr,xlo,xhi,ylo,yhi,zlo,zhi,i+1,j,k);
<a name="l00078"></a>00078                                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((f&amp;b1)==b1) compute_minimum(minr,xlo,xhi,ylo,yhi,zlo,zhi,i+1,j,k);
<a name="l00079"></a>00079                                         <span class="keywordflow">if</span>((f&amp;b4)==b4) {
<a name="l00080"></a>00080                                                 compute_minimum(minr,xlo,xhi,ylo,yhi,zlo,zhi,i,j-1,k);
<a name="l00081"></a>00081                                                 <span class="keywordflow">if</span>((f&amp;b3)==0) compute_minimum(minr,xlo,xhi,ylo,yhi,zlo,zhi,i,j+1,k);
<a name="l00082"></a>00082                                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((f&amp;b3)==b3) compute_minimum(minr,xlo,xhi,ylo,yhi,zlo,zhi,i,j+1,k);
<a name="l00083"></a>00083                                         <span class="keywordflow">if</span>((f&amp;b6)==b6) {
<a name="l00084"></a>00084                                                 compute_minimum(minr,xlo,xhi,ylo,yhi,zlo,zhi,i,j,k-1);
<a name="l00085"></a>00085                                                 <span class="keywordflow">if</span>((f&amp;b5)==0) compute_minimum(minr,xlo,xhi,ylo,yhi,zlo,zhi,i,j,k+1);
<a name="l00086"></a>00086                                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((f&amp;b5)==b5) compute_minimum(minr,xlo,xhi,ylo,yhi,zlo,zhi,i,j,k+1);
<a name="l00087"></a>00087                                 }
<a name="l00088"></a>00088                                 q--;
<a name="l00089"></a>00089                                 <span class="keywordflow">while</span>(q&gt;0) {
<a name="l00090"></a>00090                                         radp[q]=minr;
<a name="l00091"></a>00091                                         f=e[q];
<a name="l00092"></a>00092                                         i=(f&amp;127)-64;
<a name="l00093"></a>00093                                         j=(f&gt;&gt;7&amp;127)-64;
<a name="l00094"></a>00094                                         k=(f&gt;&gt;14&amp;127)-64;
<a name="l00095"></a>00095                                         compute_minimum(minr,xlo,xhi,ylo,yhi,zlo,zhi,i,j,k);
<a name="l00096"></a>00096                                         q--;
<a name="l00097"></a>00097                                 }
<a name="l00098"></a>00098                                 radp[0]=minr;
<a name="l00099"></a>00099                                 e+=seq_length;
<a name="l00100"></a>00100                                 radp+=seq_length;
<a name="l00101"></a>00101                         }
<a name="l00102"></a>00102                 }
<a name="l00103"></a>00103         }
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 <span class="comment"></span>
<a name="l00106"></a>00106 <span class="comment">/** Computes the minimum distance from a subregion to a given block. If this distance</span>
<a name="l00107"></a>00107 <span class="comment"> * is smaller than the value of minr, then it passes</span>
<a name="l00108"></a>00108 <span class="comment"> * \param[in] &amp;minr a pointer to the current minimum distance. If distance</span>
<a name="l00109"></a>00109 <span class="comment"> * computed in this function is smaller, then this distance is set to the new</span>
<a name="l00110"></a>00110 <span class="comment"> * one.</span>
<a name="l00111"></a>00111 <span class="comment"> * \param[in] (&amp;xlo,&amp;ylo,&amp;zlo) the lower coordinates of the subregion being</span>
<a name="l00112"></a>00112 <span class="comment"> * considered.</span>
<a name="l00113"></a>00113 <span class="comment"> * \param[in] (&amp;xhi,&amp;yhi,&amp;zhi) the upper coordinates of the subregion being</span>
<a name="l00114"></a>00114 <span class="comment"> * considered.</span>
<a name="l00115"></a>00115 <span class="comment"> * \param[in] (ti,tj,tk) the coordinates of the block. */</span>
<a name="l00116"></a>00116 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00117"></a>00117 <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;::compute_minimum</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;minr,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;xlo,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;xhi,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;ylo,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;yhi,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;zlo,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;zhi,<span class="keywordtype">int</span> ti,<span class="keywordtype">int</span> tj,<span class="keywordtype">int</span> tk) {
<a name="l00118"></a>00118         <span class="keyword">const</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> boxx=(<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>-<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>)/<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>,boxy=(<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>-<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>)/<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>,boxz=(<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>-<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>)/<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;
<a name="l00119"></a>00119         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> radsq,temp;
<a name="l00120"></a>00120         <span class="keywordflow">if</span>(ti&gt;0) {temp=boxx*ti-xhi;radsq=temp*temp;}
<a name="l00121"></a>00121         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ti&lt;0) {temp=xlo-boxx*(1+ti);radsq=temp*temp;}
<a name="l00122"></a>00122         <span class="keywordflow">else</span> radsq=0;
<a name="l00123"></a>00123         
<a name="l00124"></a>00124         <span class="keywordflow">if</span>(tj&gt;0) {temp=boxy*tj-yhi;radsq+=temp*temp;}
<a name="l00125"></a>00125         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tj&lt;0) {temp=ylo-boxy*(1+tj);radsq+=temp*temp;}
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         <span class="keywordflow">if</span>(tk&gt;0) {temp=boxz*tk-zhi;radsq+=temp*temp;}
<a name="l00128"></a>00128         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tk&lt;0) {temp=zlo-boxz*(1+tk);radsq+=temp*temp;}
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="keywordflow">if</span>(radsq&lt;minr) minr=radsq;
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 <span class="comment"></span>
<a name="l00133"></a>00133 <span class="comment">/** Container destructor - free memory. */</span>
<a name="l00134"></a>00134 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00135"></a><a class="code" href="classcontainer__base.html#5fd4666ef972e9e7ca37a347b8a9843a">00135</a> <a class="code" href="classcontainer__base.html#5fd4666ef972e9e7ca37a347b8a9843a">container_base&lt;r_option&gt;::~container_base</a>() {
<a name="l00136"></a>00136         <span class="keywordtype">int</span> l;
<a name="l00137"></a>00137         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#af78dc03594e20e0e5ad9b51a60948d1">nxyz</a>;l++) <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[l];
<a name="l00138"></a>00138         <span class="keywordflow">for</span>(l=0;l&lt;nxyz;l++) <span class="keyword">delete</span> [] <span class="keywordtype">id</span>[l];
<a name="l00139"></a>00139         <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>;
<a name="l00140"></a>00140         <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#aef6980ec54244be190dc8fc7008ec07">id</a>;
<a name="l00141"></a>00141         <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#893fd68b1c4f386f75d4ab27060ec0ab">mem</a>;
<a name="l00142"></a>00142         <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>;
<a name="l00143"></a>00143         <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>;
<a name="l00144"></a>00144         <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>;
<a name="l00145"></a>00145         <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#64783fe54666504bb2a0e504d2f6e9df">walls</a>;
<a name="l00146"></a>00146         <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#286d1f47c6678beb1ff8867037895b07">mrad</a>;
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 <span class="comment"></span>
<a name="l00149"></a>00149 <span class="comment">/** Dumps all the particle positions and identifies to a file. */</span>
<a name="l00150"></a>00150 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00151"></a><a class="code" href="classcontainer__base.html#d569c1afd2fe7963e1020c649c6c34b2">00151</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#94d10295d1d3d034fd2208708e717a0f">container_base&lt;r_option&gt;::draw_particles</a>(ostream &amp;os) {
<a name="l00152"></a>00152         <span class="keywordtype">int</span> c,l,i;
<a name="l00153"></a>00153         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#af78dc03594e20e0e5ad9b51a60948d1">nxyz</a>;l++) {
<a name="l00154"></a>00154                 <span class="keywordflow">for</span>(c=0;c&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[l];c++) {
<a name="l00155"></a>00155                         os &lt;&lt; <span class="keywordtype">id</span>[l][c];
<a name="l00156"></a>00156                         <span class="keywordflow">for</span>(i=<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*c;i&lt;<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*(c+1);i++) os &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[l][i];
<a name="l00157"></a>00157                         os &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00158"></a>00158                 }
<a name="l00159"></a>00159         }
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 <span class="comment"></span>
<a name="l00162"></a>00162 <span class="comment">/** An overloaded version of the draw_particles() routine, that just prints</span>
<a name="l00163"></a>00163 <span class="comment"> * to standard output. */</span>
<a name="l00164"></a>00164 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00165"></a><a class="code" href="classcontainer__base.html#94d10295d1d3d034fd2208708e717a0f">00165</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#94d10295d1d3d034fd2208708e717a0f">container_base&lt;r_option&gt;::draw_particles</a>() {
<a name="l00166"></a>00166         <a class="code" href="classcontainer__base.html#94d10295d1d3d034fd2208708e717a0f">draw_particles</a>(cout);
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168 <span class="comment"></span>
<a name="l00169"></a>00169 <span class="comment">/** An overloaded version of the draw_particles() routine, that outputs</span>
<a name="l00170"></a>00170 <span class="comment"> * the particle positions to a file.</span>
<a name="l00171"></a>00171 <span class="comment"> * \param[in] filename the file to write to. */</span>
<a name="l00172"></a>00172 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00173"></a><a class="code" href="classcontainer__base.html#afa34a88db1eec0fba5b1ca0303a730e">00173</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#94d10295d1d3d034fd2208708e717a0f">container_base&lt;r_option&gt;::draw_particles</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
<a name="l00174"></a>00174         ofstream os;
<a name="l00175"></a>00175         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l00176"></a>00176         <a class="code" href="classcontainer__base.html#94d10295d1d3d034fd2208708e717a0f">draw_particles</a>(os);
<a name="l00177"></a>00177         os.close();
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 <span class="comment"></span>
<a name="l00180"></a>00180 <span class="comment">/** Dumps all the particle positions in the POV-Ray format. */</span>
<a name="l00181"></a>00181 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00182"></a><a class="code" href="classcontainer__base.html#b8f4aec9dabb20d8143da36ff4620f39">00182</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#d808fb4bd148ef252ba07f6dd2ef79ee">container_base&lt;r_option&gt;::draw_particles_pov</a>(ostream &amp;os) {
<a name="l00183"></a>00183         <span class="keywordtype">int</span> l,c;
<a name="l00184"></a>00184         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#af78dc03594e20e0e5ad9b51a60948d1">nxyz</a>;l++) {
<a name="l00185"></a>00185                 <span class="keywordflow">for</span>(c=0;c&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[l];c++) {
<a name="l00186"></a>00186                         os &lt;&lt; <span class="stringliteral">"// id "</span> &lt;&lt; <span class="keywordtype">id</span>[l][c] &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00187"></a>00187                         os &lt;&lt; <span class="stringliteral">"sphere{&lt;"</span> &lt;&lt; <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[l][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*c] &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[l][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*c+1] &lt;&lt; <span class="stringliteral">","</span>
<a name="l00188"></a>00188                            &lt;&lt; <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[l][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*c+2] &lt;&lt; <span class="stringliteral">"&gt;,"</span>;
<a name="l00189"></a>00189                         <a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.rad(os,l,c);
<a name="l00190"></a>00190                         os &lt;&lt; <span class="stringliteral">"}\n"</span>;
<a name="l00191"></a>00191                 }
<a name="l00192"></a>00192         }
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 <span class="comment"></span>
<a name="l00195"></a>00195 <span class="comment">/** An overloaded version of the draw_particles_pov() routine, that just prints</span>
<a name="l00196"></a>00196 <span class="comment"> * to standard output. */</span>
<a name="l00197"></a>00197 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00198"></a><a class="code" href="classcontainer__base.html#d808fb4bd148ef252ba07f6dd2ef79ee">00198</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#d808fb4bd148ef252ba07f6dd2ef79ee">container_base&lt;r_option&gt;::draw_particles_pov</a>() {
<a name="l00199"></a>00199         <a class="code" href="classcontainer__base.html#d808fb4bd148ef252ba07f6dd2ef79ee">draw_particles_pov</a>(cout);
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 <span class="comment"></span>
<a name="l00202"></a>00202 <span class="comment">/** An overloaded version of the draw_particles_pov() routine, that outputs</span>
<a name="l00203"></a>00203 <span class="comment"> * the particle positions to a file.</span>
<a name="l00204"></a>00204 <span class="comment"> * \param[in] filename the file to write to. */</span>
<a name="l00205"></a>00205 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00206"></a><a class="code" href="classcontainer__base.html#bd89b1fb55edab38542462d0fdf25e53">00206</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#d808fb4bd148ef252ba07f6dd2ef79ee">container_base&lt;r_option&gt;::draw_particles_pov</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
<a name="l00207"></a>00207         ofstream os;
<a name="l00208"></a>00208         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l00209"></a>00209         <a class="code" href="classcontainer__base.html#d808fb4bd148ef252ba07f6dd2ef79ee">draw_particles_pov</a>(os);
<a name="l00210"></a>00210         os.close();
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 <span class="comment"></span>
<a name="l00213"></a>00213 <span class="comment">/** Put a particle into the correct region of the container. */</span>
<a name="l00214"></a>00214 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00215"></a><a class="code" href="classcontainer__base.html#8a55d6ba7209869af12daab718a08769">00215</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#8a55d6ba7209869af12daab718a08769">container_base&lt;r_option&gt;::put</a>(<span class="keywordtype">int</span> n,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l00216"></a>00216         <span class="keywordflow">if</span>(x&gt;<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>&amp;&amp;y&gt;<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>&amp;&amp;z&gt;<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>) {
<a name="l00217"></a>00217                 <span class="keywordtype">int</span> i,j,k;
<a name="l00218"></a>00218                 i=int((x-<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>)*<a class="code" href="classcontainer__base.html#2bc0c8041b17e68e6f883f6f7174d151">xsp</a>);j=int((y-<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>)*<a class="code" href="classcontainer__base.html#9754b08a7e881a0c388b54004fd4c93b">ysp</a>);k=int((z-<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>)*<a class="code" href="classcontainer__base.html#5bde8a1be1948593b1ed9e5dbed2d2e3">zsp</a>);
<a name="l00219"></a>00219                 <span class="keywordflow">if</span>(i&lt;<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>&amp;&amp;j&lt;<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>&amp;&amp;k&lt;<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>) {
<a name="l00220"></a>00220                         i+=<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>*j+<a class="code" href="classcontainer__base.html#3321301fcc3cb677abadc323a48cffaf">nxy</a>*k;
<a name="l00221"></a>00221                         <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[i]==<a class="code" href="classcontainer__base.html#893fd68b1c4f386f75d4ab27060ec0ab">mem</a>[i]) <a class="code" href="classcontainer__base.html#0680fc99b65e5aec2a468aca1c86cb46">add_particle_memory</a>(i);
<a name="l00222"></a>00222                         <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[i][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[i]]=x;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[i][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*co[i]+1]=y;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[i][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*co[i]+2]=z;
<a name="l00223"></a>00223                         <a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.store_radius(i,co[i],0.5);
<a name="l00224"></a>00224                         <span class="keywordtype">id</span>[i][co[i]++]=n;
<a name="l00225"></a>00225                 }
<a name="l00226"></a>00226         }
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 <span class="comment"></span>
<a name="l00229"></a>00229 <span class="comment">/** Put a particle into the correct region of the container.</span>
<a name="l00230"></a>00230 <span class="comment"> * \param[in] n The numerical ID of the inserted particle.</span>
<a name="l00231"></a>00231 <span class="comment"> * \param[in] (x,y,z) The position vector of the inserted particle.</span>
<a name="l00232"></a>00232 <span class="comment"> * \param[in] r The radius of the particle.*/</span>
<a name="l00233"></a>00233 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00234"></a><a class="code" href="classcontainer__base.html#6092e2d34458a36b583222a76a906501">00234</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#8a55d6ba7209869af12daab718a08769">container_base&lt;r_option&gt;::put</a>(<span class="keywordtype">int</span> n,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> r) {
<a name="l00235"></a>00235         <span class="keywordflow">if</span>(x&gt;<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>&amp;&amp;y&gt;<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>&amp;&amp;z&gt;<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>) {
<a name="l00236"></a>00236                 <span class="keywordtype">int</span> i,j,k;
<a name="l00237"></a>00237                 i=int((x-<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>)*<a class="code" href="classcontainer__base.html#2bc0c8041b17e68e6f883f6f7174d151">xsp</a>);j=int((y-<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>)*<a class="code" href="classcontainer__base.html#9754b08a7e881a0c388b54004fd4c93b">ysp</a>);k=int((z-<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>)*<a class="code" href="classcontainer__base.html#5bde8a1be1948593b1ed9e5dbed2d2e3">zsp</a>);
<a name="l00238"></a>00238                 <span class="keywordflow">if</span>(i&lt;<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>&amp;&amp;j&lt;<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>&amp;&amp;k&lt;<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>) {
<a name="l00239"></a>00239                         i+=<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>*j+<a class="code" href="classcontainer__base.html#3321301fcc3cb677abadc323a48cffaf">nxy</a>*k;
<a name="l00240"></a>00240                         <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[i]==<a class="code" href="classcontainer__base.html#893fd68b1c4f386f75d4ab27060ec0ab">mem</a>[i]) <a class="code" href="classcontainer__base.html#0680fc99b65e5aec2a468aca1c86cb46">add_particle_memory</a>(i);
<a name="l00241"></a>00241                         <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[i][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[i]]=x;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[i][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*co[i]+1]=y;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[i][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*co[i]+2]=z;
<a name="l00242"></a>00242                         <a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.store_radius(i,co[i],r);
<a name="l00243"></a>00243                         <span class="keywordtype">id</span>[i][co[i]++]=n;
<a name="l00244"></a>00244                 }
<a name="l00245"></a>00245         }
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 <span class="comment"></span>
<a name="l00248"></a>00248 <span class="comment">/** Increase memory for a particular region. */</span>
<a name="l00249"></a>00249 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00250"></a><a class="code" href="classcontainer__base.html#0680fc99b65e5aec2a468aca1c86cb46">00250</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#0680fc99b65e5aec2a468aca1c86cb46">container_base&lt;r_option&gt;::add_particle_memory</a>(<span class="keywordtype">int</span> i) {
<a name="l00251"></a>00251         <span class="keywordtype">int</span> *idp;<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> *pp;
<a name="l00252"></a>00252         <span class="keywordtype">int</span> l,nmem=2*<a class="code" href="classcontainer__base.html#893fd68b1c4f386f75d4ab27060ec0ab">mem</a>[i];
<a name="l00253"></a>00253 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=3</span>
<a name="l00254"></a>00254 <span class="preprocessor"></span>        cerr &lt;&lt; <span class="stringliteral">"Particle memory in region "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" scaled up to "</span> &lt;&lt; nmem &lt;&lt; endl;
<a name="l00255"></a>00255 <span class="preprocessor">#endif</span>
<a name="l00256"></a>00256 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(nmem&gt;<a class="code" href="config_8hh.html#998b13fefd148fa8bcd1d66e5a88a31d">max_particle_memory</a>)
<a name="l00257"></a>00257                 <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Absolute maximum memory allocation exceeded"</span>,<a class="code" href="config_8hh.html#5dc0616f8a67ae3d1c2ba8a3dcf5612b">VOROPP_MEMORY_ERROR</a>);
<a name="l00258"></a>00258         idp=<span class="keyword">new</span> <span class="keywordtype">int</span>[nmem];
<a name="l00259"></a>00259         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[i];l++) idp[l]=<span class="keywordtype">id</span>[i][l];
<a name="l00260"></a>00260         pp=<span class="keyword">new</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a>[<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*nmem];
<a name="l00261"></a>00261         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*co[i];l++) pp[l]=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[i][l];
<a name="l00262"></a>00262         <a class="code" href="classcontainer__base.html#893fd68b1c4f386f75d4ab27060ec0ab">mem</a>[i]=nmem;
<a name="l00263"></a>00263         <span class="keyword">delete</span> [] <span class="keywordtype">id</span>[i];<span class="keywordtype">id</span>[i]=idp;
<a name="l00264"></a>00264         <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[i];<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[i]=pp;
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 <span class="comment"></span>
<a name="l00267"></a>00267 <span class="comment">/** Add list memory. */</span>
<a name="l00268"></a>00268 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00269"></a><a class="code" href="classcontainer__base.html#077feb22ead0280cd6884b01acac6e08">00269</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#077feb22ead0280cd6884b01acac6e08">container_base&lt;r_option&gt;::add_list_memory</a>() {
<a name="l00270"></a>00270         <span class="keywordtype">int</span> i,j=0,*ps;
<a name="l00271"></a>00271         ps=<span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>*2];
<a name="l00272"></a>00272 <span class="preprocessor">#if VOROPP_VERBOSE &gt;=2</span>
<a name="l00273"></a>00273 <span class="preprocessor"></span>        cerr &lt;&lt; <span class="stringliteral">"List memory scaled up to "</span> &lt;&lt; <a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>*2 &lt;&lt; endl;
<a name="l00274"></a>00274 <span class="preprocessor">#endif</span>
<a name="l00275"></a>00275 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>&lt;=<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>) {
<a name="l00276"></a>00276                 <span class="keywordflow">for</span>(i=<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>;i&lt;<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>;i++) ps[j++]=<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[i];
<a name="l00277"></a>00277         } <span class="keywordflow">else</span> {
<a name="l00278"></a>00278                 <span class="keywordflow">for</span>(i=<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>;i&lt;<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>;i++) ps[j++]=<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[i];
<a name="l00279"></a>00279                 <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>;i++) ps[j++]=<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[i];
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281         <a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>*=2;
<a name="l00282"></a>00282         <a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>=0;<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>=j;
<a name="l00283"></a>00283         <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>=ps;
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 <span class="comment"></span>
<a name="l00286"></a>00286 <span class="comment">/** Import a list of particles from standard input. */</span>
<a name="l00287"></a>00287 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00288"></a><a class="code" href="classcontainer__base.html#21db2334d3e09d10be9c95905744059e">00288</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#72ebf73992d33f712bbe5d4e101dc08e">container_base&lt;r_option&gt;::import</a>(istream &amp;is) {
<a name="l00289"></a>00289         <a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.import(is);
<a name="l00290"></a>00290 }
<a name="l00291"></a>00291 <span class="comment"></span>
<a name="l00292"></a>00292 <span class="comment">/** An overloaded version of the import routine, that reads the standard input.</span>
<a name="l00293"></a>00293 <span class="comment"> */</span>
<a name="l00294"></a>00294 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00295"></a><a class="code" href="classcontainer__base.html#72ebf73992d33f712bbe5d4e101dc08e">00295</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#72ebf73992d33f712bbe5d4e101dc08e">container_base&lt;r_option&gt;::import</a>() {
<a name="l00296"></a>00296         <span class="keyword">import</span>(cin);
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 <span class="comment"></span>
<a name="l00299"></a>00299 <span class="comment">/** An overloaded version of the import routine, that reads in particles from</span>
<a name="l00300"></a>00300 <span class="comment"> * a particular file.</span>
<a name="l00301"></a>00301 <span class="comment"> * \param[in] filename The name of the file to read from. */</span>
<a name="l00302"></a>00302 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00303"></a><a class="code" href="classcontainer__base.html#d4a396fb3b7d26159f27103a82609b39">00303</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#72ebf73992d33f712bbe5d4e101dc08e">container_base&lt;r_option&gt;::import</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
<a name="l00304"></a>00304         ifstream is;
<a name="l00305"></a>00305         is.open(filename,ifstream::in);
<a name="l00306"></a>00306         <span class="keywordflow">if</span>(is.fail()) <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Unable to open file for import"</span>,<a class="code" href="config_8hh.html#8de7f106cac2556a67bcc61bd364ed38">VOROPP_FILE_ERROR</a>);
<a name="l00307"></a>00307         <span class="keyword">import</span>(is);
<a name="l00308"></a>00308         is.close();
<a name="l00309"></a>00309 }
<a name="l00310"></a>00310 <span class="comment"></span>
<a name="l00311"></a>00311 <span class="comment">/** Outputs the number of particles within each region. */</span>
<a name="l00312"></a>00312 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00313"></a><a class="code" href="classcontainer__base.html#f14c65181e59f450f7f0d30e38813f29">00313</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#f14c65181e59f450f7f0d30e38813f29">container_base&lt;r_option&gt;::region_count</a>() {
<a name="l00314"></a>00314         <span class="keywordtype">int</span> i,j,k,ijk=0;
<a name="l00315"></a>00315         <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;k++) {
<a name="l00316"></a>00316                 <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;j++) {
<a name="l00317"></a>00317                         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;i++) cout &lt;&lt; <span class="stringliteral">"Region ("</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; k &lt;&lt; <span class="stringliteral">"): "</span> &lt;&lt; <a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[ijk++] &lt;&lt; <span class="stringliteral">" particles"</span> &lt;&lt; endl;
<a name="l00318"></a>00318                 }
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 <span class="comment"></span>
<a name="l00322"></a>00322 <span class="comment">/** Clears a container of particles. */</span>
<a name="l00323"></a>00323 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00324"></a><a class="code" href="classcontainer__base.html#026dbdd227444bac4e75d68b46741aa6">00324</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#026dbdd227444bac4e75d68b46741aa6">container_base&lt;r_option&gt;::clear</a>() {
<a name="l00325"></a>00325         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijk=0;ijk&lt;<a class="code" href="classcontainer__base.html#af78dc03594e20e0e5ad9b51a60948d1">nxyz</a>;ijk++) <a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[ijk]=0;
<a name="l00326"></a>00326         <a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.clear_max();
<a name="l00327"></a>00327 }
<a name="l00328"></a>00328 <span class="comment"></span>
<a name="l00329"></a>00329 <span class="comment">/** Computes the Voronoi cells for all particles within a box with corners</span>
<a name="l00330"></a>00330 <span class="comment"> * (xmin,ymin,zmin) and (xmax,ymax,zmax), and saves the output in a format</span>
<a name="l00331"></a>00331 <span class="comment"> * that can be read by gnuplot. */</span>
<a name="l00332"></a>00332 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00333"></a><a class="code" href="classcontainer__base.html#b8ce0fa3150cf483f6356de3267cd379">00333</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#b8ce0fa3150cf483f6356de3267cd379">container_base&lt;r_option&gt;::draw_cells_gnuplot</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xmin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xmax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ymin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ymax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zmin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zmax) {
<a name="l00334"></a>00334         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,y,z,px,py,pz;
<a name="l00335"></a>00335         <a class="code" href="classvoropp__loop.html" title="A class to handle loops on regions of the container handling non-periodic and periodic...">voropp_loop</a> l1(<span class="keyword">this</span>);
<a name="l00336"></a>00336         <span class="keywordtype">int</span> q,s;
<a name="l00337"></a>00337         <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell</a> c;
<a name="l00338"></a>00338         ofstream os;
<a name="l00339"></a>00339         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l00340"></a>00340         s=l1.<a class="code" href="classvoropp__loop.html#8d34dfb5dab6412a684e233a6dfbab30">init</a>(xmin,xmax,ymin,ymax,zmin,zmax,px,py,pz);
<a name="l00341"></a>00341         <span class="keywordflow">do</span> {
<a name="l00342"></a>00342                 <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[s];q++) {
<a name="l00343"></a>00343                         x=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q]+px;y=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+1]+py;z=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+2]+pz;
<a name="l00344"></a>00344                         <span class="keywordflow">if</span>(x&gt;xmin&amp;&amp;x&lt;xmax&amp;&amp;y&gt;ymin&amp;&amp;y&lt;ymax&amp;&amp;z&gt;zmin&amp;&amp;z&lt;zmax) {
<a name="l00345"></a>00345                                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">compute_cell</a>(c,l1.<a class="code" href="classvoropp__loop.html#1288c1cf43ee443f85ac2b38e77be1e3">ip</a>,l1.<a class="code" href="classvoropp__loop.html#0968d506237af30596665901de0b176b">jp</a>,l1.<a class="code" href="classvoropp__loop.html#53f312a51a6840ee575110fb0dd88875">kp</a>,s,q,x,y,z)) c.<a class="code" href="classvoronoicell__base.html#630c2044253bfe8cc900d808aaf79411">draw_gnuplot</a>(os,x,y,z);
<a name="l00346"></a>00346                         }
<a name="l00347"></a>00347                 }
<a name="l00348"></a>00348         } <span class="keywordflow">while</span>((s=l1.<a class="code" href="classvoropp__loop.html#3496e46cf243f80b34040652efbd1881">inc</a>(px,py,pz))!=-1);
<a name="l00349"></a>00349         os.close();
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 <span class="comment"></span>
<a name="l00352"></a>00352 <span class="comment">/** If only a filename is supplied to draw_cells_gnuplot(), then assume that we are</span>
<a name="l00353"></a>00353 <span class="comment"> * calculating the entire simulation region. */</span>
<a name="l00354"></a>00354 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00355"></a><a class="code" href="classcontainer__base.html#8866710ab8128eacdcdd91c99b268c10">00355</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#b8ce0fa3150cf483f6356de3267cd379">container_base&lt;r_option&gt;::draw_cells_gnuplot</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
<a name="l00356"></a>00356         <a class="code" href="classcontainer__base.html#b8ce0fa3150cf483f6356de3267cd379">draw_cells_gnuplot</a>(filename,<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>,<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>,<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>,<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>,<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>,<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>);
<a name="l00357"></a>00357 }
<a name="l00358"></a>00358 <span class="comment"></span>
<a name="l00359"></a>00359 <span class="comment">/** Computes the Voronoi cells for all particles within a box with corners</span>
<a name="l00360"></a>00360 <span class="comment"> * (xmin,ymin,zmin) and (xmax,ymax,zmax), and saves the output in a format</span>
<a name="l00361"></a>00361 <span class="comment"> * that can be read by gnuplot.*/</span>
<a name="l00362"></a>00362 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00363"></a><a class="code" href="classcontainer__base.html#7366bd0133c5fcba04f6701fbff06313">00363</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#7366bd0133c5fcba04f6701fbff06313">container_base&lt;r_option&gt;::draw_cells_pov</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xmin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xmax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ymin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ymax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zmin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zmax) {
<a name="l00364"></a>00364         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,y,z,px,py,pz;
<a name="l00365"></a>00365         <a class="code" href="classvoropp__loop.html" title="A class to handle loops on regions of the container handling non-periodic and periodic...">voropp_loop</a> l1(<span class="keyword">this</span>);
<a name="l00366"></a>00366         <span class="keywordtype">int</span> q,s;
<a name="l00367"></a>00367         <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell</a> c;
<a name="l00368"></a>00368         ofstream os;
<a name="l00369"></a>00369         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l00370"></a>00370         s=l1.<a class="code" href="classvoropp__loop.html#8d34dfb5dab6412a684e233a6dfbab30">init</a>(xmin,xmax,ymin,ymax,zmin,zmax,px,py,pz);
<a name="l00371"></a>00371         <span class="keywordflow">do</span> {
<a name="l00372"></a>00372                 <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[s];q++) {
<a name="l00373"></a>00373                         os &lt;&lt; <span class="stringliteral">"// cell "</span> &lt;&lt; <span class="keywordtype">id</span>[s][q] &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00374"></a>00374                         x=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q]+px;y=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+1]+py;z=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+2]+pz;
<a name="l00375"></a>00375                         <span class="keywordflow">if</span>(x&gt;xmin&amp;&amp;x&lt;xmax&amp;&amp;y&gt;ymin&amp;&amp;y&lt;ymax&amp;&amp;z&gt;zmin&amp;&amp;z&lt;zmax) {
<a name="l00376"></a>00376                                 <span class="keywordflow">if</span> (<a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">compute_cell</a>(c,l1.<a class="code" href="classvoropp__loop.html#1288c1cf43ee443f85ac2b38e77be1e3">ip</a>,l1.<a class="code" href="classvoropp__loop.html#0968d506237af30596665901de0b176b">jp</a>,l1.<a class="code" href="classvoropp__loop.html#53f312a51a6840ee575110fb0dd88875">kp</a>,s,q,x,y,z)) c.<a class="code" href="classvoronoicell__base.html#64e2292f64e61c9229195820c2ef0246">draw_pov</a>(os,x,y,z);
<a name="l00377"></a>00377                         }
<a name="l00378"></a>00378                 }
<a name="l00379"></a>00379         } <span class="keywordflow">while</span>((s=l1.<a class="code" href="classvoropp__loop.html#3496e46cf243f80b34040652efbd1881">inc</a>(px,py,pz))!=-1);
<a name="l00380"></a>00380         os.close();
<a name="l00381"></a>00381 }
<a name="l00382"></a>00382 <span class="comment"></span>
<a name="l00383"></a>00383 <span class="comment">/** If only a filename is supplied to draw_cells_pov(), then assume that we are</span>
<a name="l00384"></a>00384 <span class="comment"> * calculating the entire simulation region.*/</span>
<a name="l00385"></a>00385 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00386"></a><a class="code" href="classcontainer__base.html#d3534b122504cca69a34c32a45bd3c60">00386</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#7366bd0133c5fcba04f6701fbff06313">container_base&lt;r_option&gt;::draw_cells_pov</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
<a name="l00387"></a>00387         <a class="code" href="classcontainer__base.html#7366bd0133c5fcba04f6701fbff06313">draw_cells_pov</a>(filename,<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>,<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>,<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>,<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>,<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>,<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>);
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 <span class="comment"></span>
<a name="l00390"></a>00390 <span class="comment">/** This function computes all the cells in the container, but does nothing</span>
<a name="l00391"></a>00391 <span class="comment"> * with the output. It is useful for measuring the pure computation time</span>
<a name="l00392"></a>00392 <span class="comment"> * of the Voronoi algorithm, without any extraneous calculations, such as</span>
<a name="l00393"></a>00393 <span class="comment"> * volume evaluation or cell output. */</span>
<a name="l00394"></a>00394 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00395"></a><a class="code" href="classcontainer__base.html#5ef27edce3e1f00c6dbbc147ae6f38ef">00395</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#5ef27edce3e1f00c6dbbc147ae6f38ef">container_base&lt;r_option&gt;::compute_all_cells</a>() {
<a name="l00396"></a>00396         <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell</a> c;
<a name="l00397"></a>00397         <span class="keywordtype">int</span> i,j,k,ijk=0,q;
<a name="l00398"></a>00398         <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;k++) <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;i++,ijk++) {
<a name="l00399"></a>00399                 <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[ijk];q++) <a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">compute_cell</a>(c,i,j,k,ijk,q);
<a name="l00400"></a>00400         }
<a name="l00401"></a>00401 }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403 <span class="comment"></span>
<a name="l00404"></a>00404 <span class="comment">/** Computes the Voronoi volumes for all the particles, and stores the</span>
<a name="l00405"></a>00405 <span class="comment"> * results according to the particle label in the fpoint array bb.*/</span>
<a name="l00406"></a>00406 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00407"></a><a class="code" href="classcontainer__base.html#cc04f45797dec40b61a660f02c38443e">00407</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#cc04f45797dec40b61a660f02c38443e">container_base&lt;r_option&gt;::store_cell_volumes</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> *bb) {
<a name="l00408"></a>00408         <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell</a> c;
<a name="l00409"></a>00409         <span class="keywordtype">int</span> i,j,k,ijk=0,q;
<a name="l00410"></a>00410         <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;k++) <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;i++,ijk++) {
<a name="l00411"></a>00411                 <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[ijk];q++) {
<a name="l00412"></a>00412                         <span class="keywordflow">if</span> (<a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">compute_cell</a>(c,i,j,k,ijk,q)) {
<a name="l00413"></a>00413                                 bb[<span class="keywordtype">id</span>[ijk][q]]=c.<a class="code" href="classvoronoicell__base.html#0903f972e22e1c100b021485a609488f">volume</a>();
<a name="l00414"></a>00414                         } <span class="keywordflow">else</span> {
<a name="l00415"></a>00415                                 bb[<span class="keywordtype">id</span>[ijk][q]]=0;
<a name="l00416"></a>00416                         }
<a name="l00417"></a>00417                 }
<a name="l00418"></a>00418         }
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 <span class="comment"></span>
<a name="l00421"></a>00421 <span class="comment">/** Computes the local packing fraction at a point, by summing the volumes</span>
<a name="l00422"></a>00422 <span class="comment"> * of all particles within a test sphere, and dividing by the sum of their</span>
<a name="l00423"></a>00423 <span class="comment"> * Voronoi volumes that were previous computed using the store_cell_volumes()</span>
<a name="l00424"></a>00424 <span class="comment"> * function.</span>
<a name="l00425"></a>00425 <span class="comment"> * \param[in] *bb an array holding the Voronoi volumes of the particles.</span>
<a name="l00426"></a>00426 <span class="comment"> * \param[in] (cx,cy,cz) the center of the test sphere.</span>
<a name="l00427"></a>00427 <span class="comment"> * \param[in] r the radius of the test sphere. */</span>
<a name="l00428"></a>00428 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00429"></a><a class="code" href="classcontainer__base.html#264bc6add9b64e9f1b969c5d9c80e851">00429</a> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classcontainer__base.html#264bc6add9b64e9f1b969c5d9c80e851">container_base&lt;r_option&gt;::packing_fraction</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> *bb,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> cx,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> cy,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> cz,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> r) {
<a name="l00430"></a>00430         <a class="code" href="classvoropp__loop.html" title="A class to handle loops on regions of the container handling non-periodic and periodic...">voropp_loop</a> l1(<span class="keyword">this</span>);
<a name="l00431"></a>00431         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> px,py,pz,x,y,z,rsq=r*r,pvol=0,vvol=0;
<a name="l00432"></a>00432         <span class="keywordtype">int</span> q,s;
<a name="l00433"></a>00433         s=l1.<a class="code" href="classvoropp__loop.html#8d34dfb5dab6412a684e233a6dfbab30">init</a>(cx,cy,cz,r,px,py,pz);
<a name="l00434"></a>00434         <span class="keywordflow">do</span> {
<a name="l00435"></a>00435                 <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[s];q++) {
<a name="l00436"></a>00436                         x=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q]+px-cx;
<a name="l00437"></a>00437                         y=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+1]+py-cy;
<a name="l00438"></a>00438                         z=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+2]+pz-cz;
<a name="l00439"></a>00439                         <span class="keywordflow">if</span> (x*x+y*y+z*z&lt;rsq) {
<a name="l00440"></a>00440                                 pvol+=<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.volume(s,q);
<a name="l00441"></a>00441                                 vvol+=bb[<span class="keywordtype">id</span>[s][q]];
<a name="l00442"></a>00442                         }
<a name="l00443"></a>00443                 }
<a name="l00444"></a>00444         } <span class="keywordflow">while</span>((s=l1.<a class="code" href="classvoropp__loop.html#3496e46cf243f80b34040652efbd1881">inc</a>(px,py,pz))!=-1);
<a name="l00445"></a>00445         <span class="keywordflow">return</span> vvol&gt;<a class="code" href="config_8hh.html#377aa97df9bb631891543aed53319a29">tolerance</a>?pvol/vvol*4.1887902047863909846168578443726:0;
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 <span class="comment"></span>
<a name="l00448"></a>00448 <span class="comment">/** Computes the local packing fraction at a point, by summing the volumes</span>
<a name="l00449"></a>00449 <span class="comment"> * of all particles within test box, and dividing by the sum of their</span>
<a name="l00450"></a>00450 <span class="comment"> * Voronoi volumes that were previous computed using the store_cell_volumes()</span>
<a name="l00451"></a>00451 <span class="comment"> * function.</span>
<a name="l00452"></a>00452 <span class="comment"> * \param[in] *bb an array holding the Voronoi volumes of the particles.</span>
<a name="l00453"></a>00453 <span class="comment"> * \param[in] (xmin,ymin,zmin) the minimum coordinates of the box.</span>
<a name="l00454"></a>00454 <span class="comment"> * \param[in] (xmax,ymax,zmax) the maximum coordinates of the box. */</span>
<a name="l00455"></a>00455 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00456"></a><a class="code" href="classcontainer__base.html#17896d897474beaaee80c22c6c29029b">00456</a> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classcontainer__base.html#264bc6add9b64e9f1b969c5d9c80e851">container_base&lt;r_option&gt;::packing_fraction</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> *bb,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xmin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xmax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ymin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ymax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zmin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zmax) {
<a name="l00457"></a>00457         <a class="code" href="classvoropp__loop.html" title="A class to handle loops on regions of the container handling non-periodic and periodic...">voropp_loop</a> l1(<span class="keyword">this</span>);
<a name="l00458"></a>00458         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,y,z,px,py,pz,pvol=0,vvol=0;
<a name="l00459"></a>00459         <span class="keywordtype">int</span> q,s;
<a name="l00460"></a>00460         s=l1.<a class="code" href="classvoropp__loop.html#8d34dfb5dab6412a684e233a6dfbab30">init</a>(xmin,xmax,ymin,ymax,zmin,zmax,px,py,pz);
<a name="l00461"></a>00461         <span class="keywordflow">do</span> {
<a name="l00462"></a>00462                 <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[s];q++) {
<a name="l00463"></a>00463                         x=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q]+px;
<a name="l00464"></a>00464                         y=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+1]+py;
<a name="l00465"></a>00465                         z=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[s][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+2]+pz;
<a name="l00466"></a>00466                         <span class="keywordflow">if</span>(x&gt;xmin&amp;&amp;x&lt;xmax&amp;&amp;y&gt;ymin&amp;&amp;y&lt;ymax&amp;&amp;z&gt;zmin&amp;&amp;z&lt;zmax) {
<a name="l00467"></a>00467                                 pvol+=<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.volume(s,q);
<a name="l00468"></a>00468                                 vvol+=bb[<span class="keywordtype">id</span>[s][q]];
<a name="l00469"></a>00469                         }
<a name="l00470"></a>00470                 }
<a name="l00471"></a>00471         } <span class="keywordflow">while</span>((s=l1.<a class="code" href="classvoropp__loop.html#3496e46cf243f80b34040652efbd1881">inc</a>(px,py,pz))!=-1);
<a name="l00472"></a>00472         <span class="keywordflow">return</span> vvol&gt;<a class="code" href="config_8hh.html#377aa97df9bb631891543aed53319a29">tolerance</a>?pvol/vvol*4.1887902047863909846168578443726:0;
<a name="l00473"></a>00473 }
<a name="l00474"></a>00474 <span class="comment"></span>
<a name="l00475"></a>00475 <span class="comment">/** Computes the Voronoi volumes for all the particles, and stores the</span>
<a name="l00476"></a>00476 <span class="comment"> * results according to the particle label in the fpoint array bb.*/</span>
<a name="l00477"></a>00477 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00478"></a><a class="code" href="classcontainer__base.html#c8869a0fa8347704a346272b07939a22">00478</a> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classcontainer__base.html#c8869a0fa8347704a346272b07939a22">container_base&lt;r_option&gt;::sum_cell_volumes</a>() {
<a name="l00479"></a>00479         <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell</a> c;
<a name="l00480"></a>00480         <span class="keywordtype">int</span> i,j,k,ijk=0,q;<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> vol=0;
<a name="l00481"></a>00481         <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;k++) <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;i++,ijk++) {
<a name="l00482"></a>00482                 <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[ijk];q++) <span class="keywordflow">if</span> (<a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">compute_cell</a>(c,i,j,k,ijk,q)) vol+=c.<a class="code" href="classvoronoicell__base.html#0903f972e22e1c100b021485a609488f">volume</a>();
<a name="l00483"></a>00483         }
<a name="l00484"></a>00484         <span class="keywordflow">return</span> vol;
<a name="l00485"></a>00485 }
<a name="l00486"></a>00486 <span class="comment"></span>
<a name="l00487"></a>00487 <span class="comment">/** For each particle, this prints a list of the vertices which make up each</span>
<a name="l00488"></a>00488 <span class="comment"> * face of the Voronoi cell. */</span>
<a name="l00489"></a>00489 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00490"></a><a class="code" href="classcontainer__base.html#c62affd3984f5b89029e569e6a22ef55">00490</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#c62affd3984f5b89029e569e6a22ef55">container_base&lt;r_option&gt;::print_facet_information</a>() {
<a name="l00491"></a>00491         <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell</a> c;
<a name="l00492"></a>00492         <span class="keywordtype">int</span> i,j,k,ijk=0,q;
<a name="l00493"></a>00493         <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;k++) <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;i++,ijk++) {
<a name="l00494"></a>00494                 <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[ijk];q++) <span class="keywordflow">if</span> (<a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">compute_cell</a>(c,i,j,k,ijk,q)) {
<a name="l00495"></a>00495                         cout &lt;&lt; <span class="stringliteral">"Particle "</span> &lt;&lt; <span class="keywordtype">id</span>[ijk][q] &lt;&lt; <span class="stringliteral">":\n"</span>;
<a name="l00496"></a>00496                         c.<a class="code" href="classvoronoicell__base.html#5e802dfd3ac6b0c1c1a942aaa4533fb5">facets</a>(cout);
<a name="l00497"></a>00497                 }
<a name="l00498"></a>00498         }
<a name="l00499"></a>00499 }
<a name="l00500"></a>00500 <span class="comment"></span>
<a name="l00501"></a>00501 <span class="comment">/** Prints a list of all particle labels, positions, and the number of faces to</span>
<a name="l00502"></a>00502 <span class="comment"> * the standard output. */</span>
<a name="l00503"></a>00503 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00504"></a><a class="code" href="classcontainer__base.html#3928869e48c25559886e7441f710b38d">00504</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#c06d3b653e8ff04c277290f1b1fe56bb">container_base&lt;r_option&gt;::count_all_faces</a>(ostream &amp;os) {
<a name="l00505"></a>00505         <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell</a> c;
<a name="l00506"></a>00506         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,y,z;
<a name="l00507"></a>00507         <span class="keywordtype">int</span> i,j,k,ijk=0,q;
<a name="l00508"></a>00508         <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;k++) <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;i++,ijk++) {
<a name="l00509"></a>00509                 <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[ijk];q++) {
<a name="l00510"></a>00510                         x=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q];y=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+1];z=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+2];
<a name="l00511"></a>00511                         os &lt;&lt; <span class="keywordtype">id</span>[ijk][q] &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; x &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; y &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; z;
<a name="l00512"></a>00512                         <a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.print(os,ijk,q);
<a name="l00513"></a>00513                         <span class="keywordflow">if</span> (<a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">compute_cell</a>(c,i,j,k,ijk,q,x,y,z)) {
<a name="l00514"></a>00514                                 os &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; c.<a class="code" href="classvoronoicell__base.html#61cb1dcea3ac8dc5cefcad1658fda7e7">number_of_faces</a>() &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00515"></a>00515                         } <span class="keywordflow">else</span> os &lt;&lt; <span class="stringliteral">" 0\n"</span>;
<a name="l00516"></a>00516                 }
<a name="l00517"></a>00517         }
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 <span class="comment"></span>
<a name="l00520"></a>00520 <span class="comment">/** Prints a list of all particle labels, positions, and the number of faces to</span>
<a name="l00521"></a>00521 <span class="comment"> * the standard output. */</span>
<a name="l00522"></a>00522 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00523"></a><a class="code" href="classcontainer__base.html#c06d3b653e8ff04c277290f1b1fe56bb">00523</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#c06d3b653e8ff04c277290f1b1fe56bb">container_base&lt;r_option&gt;::count_all_faces</a>() {
<a name="l00524"></a>00524         <a class="code" href="classcontainer__base.html#c06d3b653e8ff04c277290f1b1fe56bb">count_all_faces</a>(cout);
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 <span class="comment"></span>
<a name="l00527"></a>00527 <span class="comment">/** An overloaded version of count_all_faces(), which outputs the result to a</span>
<a name="l00528"></a>00528 <span class="comment"> * particular file.</span>
<a name="l00529"></a>00529 <span class="comment"> * \param[in] filename The name of the file to write to. */</span>
<a name="l00530"></a>00530 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00531"></a><a class="code" href="classcontainer__base.html#6b55d62c9ac5f370590c9ccb06a7046d">00531</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#c06d3b653e8ff04c277290f1b1fe56bb">container_base&lt;r_option&gt;::count_all_faces</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename) {
<a name="l00532"></a>00532         ofstream os;
<a name="l00533"></a>00533         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l00534"></a>00534         <a class="code" href="classcontainer__base.html#c06d3b653e8ff04c277290f1b1fe56bb">count_all_faces</a>(os);
<a name="l00535"></a>00535         os.close();     
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537 <span class="comment"></span>
<a name="l00538"></a>00538 <span class="comment">/** Prints a list of all particle labels, positions, and Voronoi volumes to the</span>
<a name="l00539"></a>00539 <span class="comment"> * standard output. */</span>
<a name="l00540"></a>00540 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00541"></a>00541 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00542"></a><a class="code" href="classcontainer__base.html#7e44f6c4a6cea52c401404093c4a433c">00542</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">container_base&lt;r_option&gt;::print_all</a>(ostream &amp;os,<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c) {
<a name="l00543"></a>00543         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,y,z;
<a name="l00544"></a>00544         <span class="keywordtype">int</span> i,j,k,ijk=0,q;
<a name="l00545"></a>00545         <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;k++) <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;i++,ijk++) {
<a name="l00546"></a>00546                 <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[ijk];q++) {
<a name="l00547"></a>00547                         x=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q];y=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+1];z=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+2];
<a name="l00548"></a>00548                         os &lt;&lt; <span class="keywordtype">id</span>[ijk][q] &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; x &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; y &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; z;
<a name="l00549"></a>00549                         <a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.print(os,ijk,q);
<a name="l00550"></a>00550                         <span class="keywordflow">if</span> (<a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">compute_cell</a>(c,i,j,k,ijk,q,x,y,z)) {
<a name="l00551"></a>00551                                 os &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; c.<a class="code" href="classvoronoicell__base.html#0903f972e22e1c100b021485a609488f">volume</a>();
<a name="l00552"></a>00552                                 c.<a class="code" href="classvoronoicell__base.html#61afcba4baa2367bfa4336c53fb53ac4">neighbors</a>(os);                
<a name="l00553"></a>00553                                 os &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00554"></a>00554                         } <span class="keywordflow">else</span> os &lt;&lt; <span class="stringliteral">" 0\n"</span>;
<a name="l00555"></a>00555                 }
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 <span class="comment"></span>
<a name="l00559"></a>00559 <span class="comment">/** Prints a list of all particle labels, positions, and Voronoi volumes to the</span>
<a name="l00560"></a>00560 <span class="comment"> * standard output. */</span>
<a name="l00561"></a>00561 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00562"></a><a class="code" href="classcontainer__base.html#078f828744fea53b5eebe1b2fd4d657a">00562</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">container_base&lt;r_option&gt;::print_all</a>(ostream &amp;os) {
<a name="l00563"></a>00563         <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell</a> c;
<a name="l00564"></a>00564         <a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">print_all</a>(os,c);
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 <span class="comment"></span>
<a name="l00567"></a>00567 <span class="comment">/** An overloaded version of print_all(), which just prints to standard output. */</span>
<a name="l00568"></a>00568 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00569"></a><a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">00569</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">container_base&lt;r_option&gt;::print_all</a>() {
<a name="l00570"></a>00570         <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell</a> c;
<a name="l00571"></a>00571         <a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">print_all</a>(cout,c);
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 <span class="comment"></span>
<a name="l00574"></a>00574 <span class="comment">/** An overloaded version of print_all(), which outputs the result to a particular</span>
<a name="l00575"></a>00575 <span class="comment"> * file.</span>
<a name="l00576"></a>00576 <span class="comment"> * \param[in] filename The name of the file to write to. */</span>
<a name="l00577"></a>00577 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00578"></a><a class="code" href="classcontainer__base.html#823da42c1fbf0669623a19a6f9487be9">00578</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">container_base&lt;r_option&gt;::print_all</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename) {
<a name="l00579"></a>00579         <a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell</a> c;
<a name="l00580"></a>00580         ofstream os;
<a name="l00581"></a>00581         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l00582"></a>00582         <a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">print_all</a>(os,c);
<a name="l00583"></a>00583         os.close();
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 <span class="comment"></span>
<a name="l00586"></a>00586 <span class="comment">/** Prints a list of all particle labels, positions, Voronoi volumes, and a list</span>
<a name="l00587"></a>00587 <span class="comment"> * of neighboring particles to an output stream.</span>
<a name="l00588"></a>00588 <span class="comment"> * \param[in] os The output stream to print to.*/</span>
<a name="l00589"></a>00589 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00590"></a><a class="code" href="classcontainer__base.html#c48d517e627c80d93a4723417a3c3b73">00590</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#cb78d376c52cf2e26c37c1c0fd480542">container_base&lt;r_option&gt;::print_all_neighbor</a>(ostream &amp;os) {
<a name="l00591"></a>00591         <a class="code" href="classvoronoicell__base.html">voronoicell_neighbor</a> c;
<a name="l00592"></a>00592         <a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">print_all</a>(os,c);
<a name="l00593"></a>00593 }
<a name="l00594"></a>00594 <span class="comment"></span>
<a name="l00595"></a>00595 <span class="comment">/** An overloaded version of print_all_neighbor(), which just prints to</span>
<a name="l00596"></a>00596 <span class="comment"> * standard output. */</span>
<a name="l00597"></a>00597 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00598"></a><a class="code" href="classcontainer__base.html#cb78d376c52cf2e26c37c1c0fd480542">00598</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#cb78d376c52cf2e26c37c1c0fd480542">container_base&lt;r_option&gt;::print_all_neighbor</a>() {
<a name="l00599"></a>00599         <a class="code" href="classvoronoicell__base.html">voronoicell_neighbor</a> c;
<a name="l00600"></a>00600         <a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">print_all</a>(cout,c);
<a name="l00601"></a>00601 }
<a name="l00602"></a>00602 <span class="comment"></span>
<a name="l00603"></a>00603 <span class="comment">/** An overloaded version of print_all_neighbor(), which outputs the result to a</span>
<a name="l00604"></a>00604 <span class="comment"> * particular file</span>
<a name="l00605"></a>00605 <span class="comment"> * \param[in] filename The name of the file to write to. */</span>
<a name="l00606"></a>00606 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00607"></a><a class="code" href="classcontainer__base.html#02e0b8720b46be59908770ed9ce972fe">00607</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#cb78d376c52cf2e26c37c1c0fd480542">container_base&lt;r_option&gt;::print_all_neighbor</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename) {
<a name="l00608"></a>00608         <a class="code" href="classvoronoicell__base.html">voronoicell_neighbor</a> c;
<a name="l00609"></a>00609         ofstream os;
<a name="l00610"></a>00610         os.open(filename,ofstream::out|ofstream::trunc);
<a name="l00611"></a>00611         <a class="code" href="classcontainer__base.html#f21333a170182ce75d51584510f0069d">print_all</a>(os,c);
<a name="l00612"></a>00612         os.close();
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 <span class="comment"></span>
<a name="l00615"></a>00615 <span class="comment">/** Initialize the Voronoi cell to be the entire container. For non-periodic</span>
<a name="l00616"></a>00616 <span class="comment"> * coordinates, this is set by the position of the walls. For periodic</span>
<a name="l00617"></a>00617 <span class="comment"> * coordinates, the space is equally divided in either direction from the</span>
<a name="l00618"></a>00618 <span class="comment"> * particle's initial position. That makes sense since those boundaries would</span>
<a name="l00619"></a>00619 <span class="comment"> * be made by the neighboring periodic images of this particle. */</span>
<a name="l00620"></a>00620 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00621"></a>00621 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00622"></a><a class="code" href="classcontainer__base.html#41c77ce2711fe79cda6f927799708dfa">00622</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html#41c77ce2711fe79cda6f927799708dfa">container_base&lt;r_option&gt;::initialize_voronoicell</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l00623"></a>00623         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x1,x2,y1,y2,z1,z2;
<a name="l00624"></a>00624         <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#a016e8be3527d58c655fa3e7c3b7e9e3">xperiodic</a>) x1=-(x2=0.5*(<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>-<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>));<span class="keywordflow">else</span> {x1=<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>-x;x2=<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>-x;}
<a name="l00625"></a>00625         <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#81d67b60c33d7345ffede5528c787a8c">yperiodic</a>) y1=-(y2=0.5*(<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>-<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>));<span class="keywordflow">else</span> {y1=<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>-y;y2=<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>-y;}
<a name="l00626"></a>00626         <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#c58a7bee5aabd4e8c540918c7b2a3199">zperiodic</a>) z1=-(z2=0.5*(<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>-<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>));<span class="keywordflow">else</span> {z1=<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>-z;z2=<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>-z;}
<a name="l00627"></a>00627         c.<a class="code" href="classvoronoicell__base.html#e6f3362a8981a741ec6d6a25f7e1bec7">init</a>(x1,x2,y1,y2,z1,z2);
<a name="l00628"></a>00628         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="classcontainer__base.html#c75332981aef14895bd159056252cced">wall_number</a>;j++) {
<a name="l00629"></a>00629                 <span class="keywordflow">if</span> (!(<a class="code" href="classcontainer__base.html#64783fe54666504bb2a0e504d2f6e9df">walls</a>[j]-&gt;cut_cell(c,x,y,z))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00630"></a>00630         }
<a name="l00631"></a>00631         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00632"></a>00632 }
<a name="l00633"></a>00633 <span class="comment"></span>
<a name="l00634"></a>00634 <span class="comment">/** This function tests to see if a given vector lies within the container</span>
<a name="l00635"></a>00635 <span class="comment"> * bounds and any walls.</span>
<a name="l00636"></a>00636 <span class="comment"> * \param[in] (x,y,z) The position vector to be tested.</span>
<a name="l00637"></a>00637 <span class="comment"> * \return True if the point is inside the container, false if the point is</span>
<a name="l00638"></a>00638 <span class="comment"> * outside. */</span>
<a name="l00639"></a>00639 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00640"></a><a class="code" href="classcontainer__base.html#dd99628256775b77d098bd39e0a08f4c">00640</a> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html#dd99628256775b77d098bd39e0a08f4c">container_base&lt;r_option&gt;::point_inside</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l00641"></a>00641         <span class="keywordflow">if</span>(x&lt;ax||x&gt;<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>||y&lt;ay||y&gt;<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>||z&lt;az||z&gt;<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00642"></a>00642         <span class="keywordflow">return</span> <a class="code" href="classcontainer__base.html#605d4e1fddde7f6288efe3a6bc47378f">point_inside_walls</a>(x,y,z);
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 <span class="comment"></span>
<a name="l00645"></a>00645 <span class="comment">/** This function tests to see if a give vector lies within the walls that have</span>
<a name="l00646"></a>00646 <span class="comment"> * been added to the container, but does not specifically check whether the</span>
<a name="l00647"></a>00647 <span class="comment"> * vector lies within the container bounds.</span>
<a name="l00648"></a>00648 <span class="comment"> * \param[in] (x,y,z) The position vector to be tested.</span>
<a name="l00649"></a>00649 <span class="comment"> * \return True if the point is inside the container, false if the point is</span>
<a name="l00650"></a>00650 <span class="comment"> * outside. */</span>
<a name="l00651"></a>00651 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00652"></a><a class="code" href="classcontainer__base.html#605d4e1fddde7f6288efe3a6bc47378f">00652</a> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html#605d4e1fddde7f6288efe3a6bc47378f">container_base&lt;r_option&gt;::point_inside_walls</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l00653"></a>00653         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="classcontainer__base.html#c75332981aef14895bd159056252cced">wall_number</a>;j++) <span class="keywordflow">if</span>(!<a class="code" href="classcontainer__base.html#64783fe54666504bb2a0e504d2f6e9df">walls</a>[j]-&gt;<a class="code" href="classcontainer__base.html#dd99628256775b77d098bd39e0a08f4c">point_inside</a>(x,y,z)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00654"></a>00654         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 <span class="comment"></span>
<a name="l00657"></a>00657 <span class="comment">/** This routine is a simpler alternative to compute_cell(), that constructs</span>
<a name="l00658"></a>00658 <span class="comment"> * the cell by testing over successively larger spherical shells of particles.</span>
<a name="l00659"></a>00659 <span class="comment"> * For a container that is homogeneously filled with particles, this routine</span>
<a name="l00660"></a>00660 <span class="comment"> * runs as fast as compute_cell(). However, it rapidly becomes inefficient</span>
<a name="l00661"></a>00661 <span class="comment"> * for cases when the particles are not homogeneously distributed, or where</span>
<a name="l00662"></a>00662 <span class="comment"> * parts of the container might not be filled. In that case, the spheres may</span>
<a name="l00663"></a>00663 <span class="comment"> * grow very large before being cut off, leading to poor efficiency.</span>
<a name="l00664"></a>00664 <span class="comment"> * \param[in] &amp;c a reference to a voronoicell object.</span>
<a name="l00665"></a>00665 <span class="comment"> * \param[in] (i,j,k) the coordinates of the block that the test particle is</span>
<a name="l00666"></a>00666 <span class="comment"> * in.</span>
<a name="l00667"></a>00667 <span class="comment"> * \param[in] ijk the index of the block that the test particle is in, set to</span>
<a name="l00668"></a>00668 <span class="comment"> * i+nx*(j+ny*k).</span>
<a name="l00669"></a>00669 <span class="comment"> * \param[in] s the index of the particle within the test block.</span>
<a name="l00670"></a>00670 <span class="comment"> * \param[in] (x,y,z) The coordinates of the particle. */</span>
<a name="l00671"></a>00671 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00672"></a>00672 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00673"></a><a class="code" href="classcontainer__base.html#11ec04bbf9798a5619f54d52c9c6b2fc">00673</a> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html#b3d381f4f3cf1c2d0244b5f26c3b22df">container_base&lt;r_option&gt;::compute_cell_sphere</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> j,<span class="keywordtype">int</span> k,<span class="keywordtype">int</span> ijk,<span class="keywordtype">int</span> s,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l00674"></a>00674 
<a name="l00675"></a>00675         <span class="comment">// This length scale determines how large the spherical shells should</span>
<a name="l00676"></a>00676         <span class="comment">// be, and it should be set to approximately the particle diameter</span>
<a name="l00677"></a>00677         <span class="keyword">const</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> length_scale=1;
<a name="l00678"></a>00678         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x1,y1,z1,qx,qy,qz,lr=0,lrs=0,ur,urs,rs;
<a name="l00679"></a>00679         <span class="keywordtype">int</span> q,t;
<a name="l00680"></a>00680         <a class="code" href="classvoropp__loop.html" title="A class to handle loops on regions of the container handling non-periodic and periodic...">voropp_loop</a> l(<span class="keyword">this</span>);
<a name="l00681"></a>00681         <span class="keywordflow">if</span> (!<a class="code" href="classcontainer__base.html#41c77ce2711fe79cda6f927799708dfa">initialize_voronoicell</a>(c,x,y,z)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         <span class="comment">// Now the cell is cut by testing neighboring particles in concentric</span>
<a name="l00684"></a>00684         <span class="comment">// shells. Once the test shell becomes twice as large as the Voronoi</span>
<a name="l00685"></a>00685         <span class="comment">// cell we can stop testing.</span>
<a name="l00686"></a>00686         <a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.init(ijk,s);
<a name="l00687"></a>00687         <span class="keywordflow">while</span>(<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(lrs)&lt;c.<a class="code" href="classvoronoicell__base.html#9d26afb17f43732a626f7269c300b90d">maxradsq</a>()) {
<a name="l00688"></a>00688                 ur=lr+0.5*length_scale;urs=ur*ur;
<a name="l00689"></a>00689                 t=l.<a class="code" href="classvoropp__loop.html#8d34dfb5dab6412a684e233a6dfbab30">init</a>(x,y,z,ur,qx,qy,qz);
<a name="l00690"></a>00690                 <span class="keywordflow">do</span> {
<a name="l00691"></a>00691                         <span class="keywordflow">for</span>(q=0;q&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[t];q++) {
<a name="l00692"></a>00692                                 x1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[t][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q]+qx-x;y1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[t][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+1]+qy-y;z1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[t][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*q+2]+qz-z;
<a name="l00693"></a>00693                                 rs=x1*x1+y1*y1+z1*z1;
<a name="l00694"></a>00694                                 <span class="keywordflow">if</span>(lrs-<a class="code" href="config_8hh.html#377aa97df9bb631891543aed53319a29">tolerance</a>&lt;rs&amp;&amp;rs&lt;urs&amp;&amp;(q!=s||ijk!=t)) {
<a name="l00695"></a>00695                                         <span class="keywordflow">if</span> (!c.<a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x1,y1,z1,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.scale(rs,t,q),<span class="keywordtype">id</span>[t][q])) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00696"></a>00696                                 }
<a name="l00697"></a>00697                         }
<a name="l00698"></a>00698                 } <span class="keywordflow">while</span>((t=l.<a class="code" href="classvoropp__loop.html#3496e46cf243f80b34040652efbd1881">inc</a>(qx,qy,qz))!=-1);
<a name="l00699"></a>00699                 lr=ur;lrs=urs;
<a name="l00700"></a>00700         }
<a name="l00701"></a>00701         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00702"></a>00702 }
<a name="l00703"></a>00703 <span class="comment"></span>
<a name="l00704"></a>00704 <span class="comment">/** A overloaded version of compute_cell_sphere(), that sets up the x, y, and z</span>
<a name="l00705"></a>00705 <span class="comment"> * variables.</span>
<a name="l00706"></a>00706 <span class="comment"> * \param[in] &amp;c a reference to a voronoicell object.</span>
<a name="l00707"></a>00707 <span class="comment"> * \param[in] (i,j,k) the coordinates of the block that the test particle is</span>
<a name="l00708"></a>00708 <span class="comment"> * in.</span>
<a name="l00709"></a>00709 <span class="comment"> * \param[in] ijk the index of the block that the test particle is in, set to</span>
<a name="l00710"></a>00710 <span class="comment"> * i+nx*(j+ny*k).</span>
<a name="l00711"></a>00711 <span class="comment"> * \param[in] s the index of the particle within the test block. */</span>
<a name="l00712"></a>00712 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00713"></a>00713 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00714"></a><a class="code" href="classcontainer__base.html#b3d381f4f3cf1c2d0244b5f26c3b22df">00714</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html#b3d381f4f3cf1c2d0244b5f26c3b22df">container_base&lt;r_option&gt;::compute_cell_sphere</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> j,<span class="keywordtype">int</span> k,<span class="keywordtype">int</span> ijk,<span class="keywordtype">int</span> s) {
<a name="l00715"></a>00715         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*s],y=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*s+1],z=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*s+2];
<a name="l00716"></a>00716         <span class="keywordflow">return</span> <a class="code" href="classcontainer__base.html#b3d381f4f3cf1c2d0244b5f26c3b22df">compute_cell_sphere</a>(c,i,j,k,ijk,s,x,y,z);
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 <span class="comment"></span>
<a name="l00719"></a>00719 <span class="comment">/** A overloaded version of compute_cell, that sets up the x, y, and z variables.</span>
<a name="l00720"></a>00720 <span class="comment"> * It can be run by the user, and it is also called multiple times by the</span>
<a name="l00721"></a>00721 <span class="comment"> * functions print_all(), store_cell_volumes(), and the output routines.</span>
<a name="l00722"></a>00722 <span class="comment"> * \param[in] &amp;c a reference to a voronoicell object.</span>
<a name="l00723"></a>00723 <span class="comment"> * \param[in] (i,j,k) the coordinates of the block that the test particle is</span>
<a name="l00724"></a>00724 <span class="comment"> * in.</span>
<a name="l00725"></a>00725 <span class="comment"> * \param[in] ijk the index of the block that the test particle is in, set to</span>
<a name="l00726"></a>00726 <span class="comment"> * i+nx*(j+ny*k).</span>
<a name="l00727"></a>00727 <span class="comment"> * \param[in] s the index of the particle within the test block. */</span>
<a name="l00728"></a>00728 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00729"></a>00729 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00730"></a><a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">00730</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">container_base&lt;r_option&gt;::compute_cell</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> j,<span class="keywordtype">int</span> k,<span class="keywordtype">int</span> ijk,<span class="keywordtype">int</span> s) {
<a name="l00731"></a>00731         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*s],y=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*s+1],z=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*s+2];
<a name="l00732"></a>00732         <span class="keywordflow">return</span>  <a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">compute_cell</a>(c,i,j,k,ijk,s,x,y,z);
<a name="l00733"></a>00733 }
<a name="l00734"></a>00734 <span class="comment"></span>
<a name="l00735"></a>00735 <span class="comment">/** This routine computes a Voronoi cell for a single particle in the</span>
<a name="l00736"></a>00736 <span class="comment"> * container. It can be called by the user, but is also forms the core part of</span>
<a name="l00737"></a>00737 <span class="comment"> * several of the main functions, such as store_cell_volumes(), print_all(),</span>
<a name="l00738"></a>00738 <span class="comment"> * and the drawing routines. The algorithm constructs the cell by testing over</span>
<a name="l00739"></a>00739 <span class="comment"> * the neighbors of the particle, working outwards until it reaches those</span>
<a name="l00740"></a>00740 <span class="comment"> * particles which could not possibly intersect the cell. For maximum</span>
<a name="l00741"></a>00741 <span class="comment"> * efficiency, this algorithm is divided into three parts. In the first</span>
<a name="l00742"></a>00742 <span class="comment"> * section, the algorithm tests over the blocks which are in the immediate</span>
<a name="l00743"></a>00743 <span class="comment"> * vicinity of the particle, by making use of one of the precomputed worklists.</span>
<a name="l00744"></a>00744 <span class="comment"> * The code then continues to test blocks on the worklist, but also begins to</span>
<a name="l00745"></a>00745 <span class="comment"> * construct a list of neighboring blocks outside the worklist which may need</span>
<a name="l00746"></a>00746 <span class="comment"> * to be test. In the third section, the routine starts testing these</span>
<a name="l00747"></a>00747 <span class="comment"> * neighboring blocks, evaluating whether or not a particle in them could</span>
<a name="l00748"></a>00748 <span class="comment"> * possibly intersect the cell. For blocks that intersect the cell, it tests</span>
<a name="l00749"></a>00749 <span class="comment"> * the particles in that block, and then adds the block neighbors to the list</span>
<a name="l00750"></a>00750 <span class="comment"> * of potential places to consider.</span>
<a name="l00751"></a>00751 <span class="comment"> * \param[in] &amp;c a reference to a voronoicell object.</span>
<a name="l00752"></a>00752 <span class="comment"> * \param[in] (i,j,k) the coordinates of the block that the test particle is</span>
<a name="l00753"></a>00753 <span class="comment"> * in.</span>
<a name="l00754"></a>00754 <span class="comment"> * \param[in] ijk the index of the block that the test particle is in, set to</span>
<a name="l00755"></a>00755 <span class="comment"> * i+nx*(j+ny*k).</span>
<a name="l00756"></a>00756 <span class="comment"> * \param[in] s the index of the particle within the test block.</span>
<a name="l00757"></a>00757 <span class="comment"> * \param[in] (x,y,z) The coordinates of the particle.</span>
<a name="l00758"></a>00758 <span class="comment"> * \param[in] s the index of the particle within the test block. */</span>
<a name="l00759"></a>00759 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l00760"></a>00760 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l00761"></a><a class="code" href="classcontainer__base.html#c8356f9aff5e65278269d83ccf76e362">00761</a> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html#1e7e528148e6b10073320b6fec3d407b">container_base&lt;r_option&gt;::compute_cell</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> j,<span class="keywordtype">int</span> k,<span class="keywordtype">int</span> ijk,<span class="keywordtype">int</span> s,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z) {
<a name="l00762"></a>00762         <span class="keyword">const</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> boxx=(<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>-<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>)/<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>,boxy=(<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>-<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>)/<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>,boxz=(<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>-<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>)/<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;
<a name="l00763"></a>00763         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x1,y1,z1,qx=0,qy=0,qz=0;
<a name="l00764"></a>00764         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xlo,ylo,zlo,xhi,yhi,zhi,rs;
<a name="l00765"></a>00765         <span class="keywordtype">int</span> ci,cj,ck,di,dj,dk,dijk,ei,ej,ek,eijk,si,sj,sk,sijk;
<a name="l00766"></a>00766         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> gxs,gys,gzs,*radp;
<a name="l00767"></a>00767         <span class="keywordtype">int</span> f,g,l;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q,*e;
<a name="l00768"></a>00768         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> b1=1&lt;&lt;21,b2=1&lt;&lt;22,b3=1&lt;&lt;24,b4=1&lt;&lt;25,b5=1&lt;&lt;27,b6=1&lt;&lt;28;
<a name="l00769"></a>00769 
<a name="l00770"></a>00770         <a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.init(ijk,s);
<a name="l00771"></a>00771 
<a name="l00772"></a>00772         <span class="comment">// Initialize the Voronoi cell to fill the entire container</span>
<a name="l00773"></a>00773         <span class="keywordflow">if</span> (!<a class="code" href="classcontainer__base.html#41c77ce2711fe79cda6f927799708dfa">initialize_voronoicell</a>(c,x,y,z)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00774"></a>00774         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> crs,mrs;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776         <span class="keywordtype">int</span> next_count=3,list_index=0,list_size=8;
<a name="l00777"></a>00777         <span class="keywordtype">int</span> count_list[]={7,11,15,19,26,35,45,59};
<a name="l00778"></a>00778 
<a name="l00779"></a>00779         <span class="comment">// Test all particles in the particle's local region first</span>
<a name="l00780"></a>00780         <span class="keywordflow">for</span>(l=0;l&lt;s;l++) {
<a name="l00781"></a>00781                 x1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l]-x;
<a name="l00782"></a>00782                 y1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+1]-y;
<a name="l00783"></a>00783                 z1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+2]-z;
<a name="l00784"></a>00784                 rs=<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.scale(x1*x1+y1*y1+z1*z1,ijk,l);
<a name="l00785"></a>00785                 <span class="keywordflow">if</span> (!c.<a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x1,y1,z1,rs,<span class="keywordtype">id</span>[ijk][l])) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00786"></a>00786         }
<a name="l00787"></a>00787         l++;
<a name="l00788"></a>00788         <span class="keywordflow">while</span>(l&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[ijk]) {
<a name="l00789"></a>00789                 x1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l]-x;
<a name="l00790"></a>00790                 y1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+1]-y;
<a name="l00791"></a>00791                 z1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+2]-z;
<a name="l00792"></a>00792                 rs=<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.scale(x1*x1+y1*y1+z1*z1,ijk,l);
<a name="l00793"></a>00793                 <span class="keywordflow">if</span> (!c.<a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x1,y1,z1,rs,<span class="keywordtype">id</span>[ijk][l])) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00794"></a>00794                 l++;
<a name="l00795"></a>00795         }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797         <span class="comment">// Now compute the maximum distance squared from the cell</span>
<a name="l00798"></a>00798         <span class="comment">// center to a vertex. This is used to cut off the calculation</span>
<a name="l00799"></a>00799         <span class="comment">// since we only need to test out to twice this range.</span>
<a name="l00800"></a>00800         mrs=c.<a class="code" href="classvoronoicell__base.html#9d26afb17f43732a626f7269c300b90d">maxradsq</a>();
<a name="l00801"></a>00801 
<a name="l00802"></a>00802         <span class="comment">// Now compute the fractional position of the particle within</span>
<a name="l00803"></a>00803         <span class="comment">// its region and store it in (fx,fy,fz). We use this to</span>
<a name="l00804"></a>00804         <span class="comment">// compute an index (si,sj,sk) of which subregion the particle</span>
<a name="l00805"></a>00805         <span class="comment">// is within.</span>
<a name="l00806"></a>00806         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m1,m2;
<a name="l00807"></a>00807         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> fx=x-<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>-boxx*i,fy=y-<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>-boxy*j,fz=z-<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>-boxz*k;
<a name="l00808"></a>00808         si=int(fx*<a class="code" href="classcontainer__base.html#2bc0c8041b17e68e6f883f6f7174d151">xsp</a>*fgrid);sj=int(fy*<a class="code" href="classcontainer__base.html#9754b08a7e881a0c388b54004fd4c93b">ysp</a>*fgrid);sk=int(fz*<a class="code" href="classcontainer__base.html#5bde8a1be1948593b1ed9e5dbed2d2e3">zsp</a>*fgrid);
<a name="l00809"></a>00809 
<a name="l00810"></a>00810         <span class="comment">// The indices (si,sj,sk) tell us which worklist to use, to test the</span>
<a name="l00811"></a>00811         <span class="comment">// blocks in the optimal order. But we only store worklists for the</span>
<a name="l00812"></a>00812         <span class="comment">// eighth of the region where si, sj, and sk are all less than half the</span>
<a name="l00813"></a>00813         <span class="comment">// full grid. The rest of the cases are handled by symmetry. In this</span>
<a name="l00814"></a>00814         <span class="comment">// section, we detect for these cases, by reflecting high values of si,</span>
<a name="l00815"></a>00815         <span class="comment">// sj, and sk. For these cases, a mask is constructed in m1 and m2</span>
<a name="l00816"></a>00816         <span class="comment">// which is used to flip the worklist information when it is loaded.</span>
<a name="l00817"></a>00817         <span class="keywordflow">if</span>(si&gt;=hgrid) {
<a name="l00818"></a>00818                 gxs=fx;
<a name="l00819"></a>00819                 m1=127+(3&lt;&lt;21);si=fgrid-1-si;m2=1+(1&lt;&lt;21);
<a name="l00820"></a>00820         } <span class="keywordflow">else</span> {m1=m2=0;gxs=boxx-fx;}
<a name="l00821"></a>00821         <span class="keywordflow">if</span>(sj&gt;=hgrid) {
<a name="l00822"></a>00822                 gys=fy;
<a name="l00823"></a>00823                 m1|=(127&lt;&lt;7)+(3&lt;&lt;24);sj=fgrid-1-sj;m2|=(1&lt;&lt;7)+(1&lt;&lt;24);
<a name="l00824"></a>00824         } <span class="keywordflow">else</span> gys=boxy-fy;
<a name="l00825"></a>00825         <span class="keywordflow">if</span>(sk&gt;=hgrid) {
<a name="l00826"></a>00826                 gzs=fz;
<a name="l00827"></a>00827                 m1|=(127&lt;&lt;14)+(3&lt;&lt;27);sk=fgrid-1-sk;m2|=(1&lt;&lt;14)+(1&lt;&lt;27);
<a name="l00828"></a>00828         } <span class="keywordflow">else</span> gzs=boxz-fz;
<a name="l00829"></a>00829         gxs*=gxs;gys*=gys;gzs*=gzs;
<a name="l00830"></a>00830 
<a name="l00831"></a>00831         <span class="comment">// It's possible that a problem with the int() function could lead to</span>
<a name="l00832"></a>00832         <span class="comment">// spurious values with particles lying on the boundaries of the regions.</span>
<a name="l00833"></a>00833         <span class="comment">// In this section we correct for that.</span>
<a name="l00834"></a>00834         <span class="keywordflow">if</span>(si&lt;0) si=0;<span class="keywordflow">if</span>(sj&lt;0) sj=0;<span class="keywordflow">if</span>(sk&lt;0) sk=0;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836         <span class="comment">// Now compute which worklist we are going to use, and set radp and e to</span>
<a name="l00837"></a>00837         <span class="comment">// point at the right offsets</span>
<a name="l00838"></a>00838         sijk=si+hgrid*(sj+hgrid*sk);
<a name="l00839"></a>00839         radp=<a class="code" href="classcontainer__base.html#286d1f47c6678beb1ff8867037895b07">mrad</a>+sijk*seq_length;
<a name="l00840"></a>00840         e=(<span class="keyword">const_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*<span class="keyword">&gt;</span> (wl))+sijk*seq_length;
<a name="l00841"></a>00841         
<a name="l00842"></a>00842         <span class="comment">// Read in how many items in the worklist can be tested without having to</span>
<a name="l00843"></a>00843         <span class="comment">// worry about writing to the mask</span>
<a name="l00844"></a>00844         f=e[0];g=0;
<a name="l00845"></a>00845         <span class="keywordflow">do</span> {
<a name="l00846"></a>00846 
<a name="l00847"></a>00847                 <span class="comment">// At the intervals specified by count_list, we recompute the</span>
<a name="l00848"></a>00848                 <span class="comment">// maximum radius squared</span>
<a name="l00849"></a>00849                 <span class="keywordflow">if</span>(g==next_count) {
<a name="l00850"></a>00850                         mrs=c.<a class="code" href="classvoronoicell__base.html#9d26afb17f43732a626f7269c300b90d">maxradsq</a>();
<a name="l00851"></a>00851                         <span class="keywordflow">if</span>(list_index!=list_size) next_count=count_list[list_index++];
<a name="l00852"></a>00852                 }
<a name="l00853"></a>00853                 
<a name="l00854"></a>00854                 <span class="comment">// If mrs is less than the minimum distance to any untested</span>
<a name="l00855"></a>00855                 <span class="comment">// block, then we are done.</span>
<a name="l00856"></a>00856                 <span class="keywordflow">if</span>(mrs&lt;<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(radp[g])) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00857"></a>00857                 g++;
<a name="l00858"></a>00858                 
<a name="l00859"></a>00859                 <span class="comment">// Load in a block off the worklist, permute it with the</span>
<a name="l00860"></a>00860                 <span class="comment">// symmetry mask, and decode its position. These are all</span>
<a name="l00861"></a>00861                 <span class="comment">// integer bit operations so they should run very fast.</span>
<a name="l00862"></a>00862                 q=e[g];q^=m1;q+=m2;
<a name="l00863"></a>00863                 di=q&amp;127;di-=64;
<a name="l00864"></a>00864                 dj=(q&gt;&gt;7)&amp;127;dj-=64;
<a name="l00865"></a>00865                 dk=(q&gt;&gt;14)&amp;127;dk-=64;
<a name="l00866"></a>00866 
<a name="l00867"></a>00867                 <span class="comment">// Check that the worklist position is in range</span>
<a name="l00868"></a>00868                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#a016e8be3527d58c655fa3e7c3b7e9e3">xperiodic</a>) {<span class="keywordflow">if</span>(di&lt;-<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>) <span class="keywordflow">continue</span>;<span class="keywordflow">else</span> <span class="keywordflow">if</span>(di&gt;<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>) <span class="keywordflow">continue</span>;}
<a name="l00869"></a>00869                 <span class="keywordflow">else</span> {<span class="keywordflow">if</span>(di&lt;-i) <span class="keywordflow">continue</span>;<span class="keywordflow">else</span> <span class="keywordflow">if</span>(di&gt;=<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>-i) <span class="keywordflow">continue</span>;}
<a name="l00870"></a>00870                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#81d67b60c33d7345ffede5528c787a8c">yperiodic</a>) {<span class="keywordflow">if</span>(dj&lt;-<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>) <span class="keywordflow">continue</span>;<span class="keywordflow">else</span> <span class="keywordflow">if</span>(dj&gt;<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>) <span class="keywordflow">continue</span>;}
<a name="l00871"></a>00871                 <span class="keywordflow">else</span> {<span class="keywordflow">if</span>(dj&lt;-j) <span class="keywordflow">continue</span>;<span class="keywordflow">else</span> <span class="keywordflow">if</span>(dj&gt;=<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>-j) <span class="keywordflow">continue</span>;}
<a name="l00872"></a>00872                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#c58a7bee5aabd4e8c540918c7b2a3199">zperiodic</a>) {<span class="keywordflow">if</span>(dk&lt;-<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>) <span class="keywordflow">continue</span>;<span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&gt;<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>) <span class="keywordflow">continue</span>;}
<a name="l00873"></a>00873                 <span class="keywordflow">else</span> {<span class="keywordflow">if</span>(dk&lt;-k) <span class="keywordflow">continue</span>;<span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&gt;=<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>-k) <span class="keywordflow">continue</span>;}
<a name="l00874"></a>00874                 
<a name="l00875"></a>00875                 <span class="comment">// Call the compute_min_max_radius() function. This returns</span>
<a name="l00876"></a>00876                 <span class="comment">// true if the minimum distance to the block is bigger than the</span>
<a name="l00877"></a>00877                 <span class="comment">// current mrs, in which case we skip this block and move on.</span>
<a name="l00878"></a>00878                 <span class="comment">// Otherwise, it computes the maximum distance to the block and</span>
<a name="l00879"></a>00879                 <span class="comment">// returns it in crs.</span>
<a name="l00880"></a>00880                 <span class="keywordflow">if</span>(compute_min_max_radius(di,dj,dk,fx,fy,fz,gxs,gys,gzs,crs,mrs)) <span class="keywordflow">continue</span>;
<a name="l00881"></a>00881                 
<a name="l00882"></a>00882                 <span class="comment">// Now compute which region we are going to loop over, adding a</span>
<a name="l00883"></a>00883                 <span class="comment">// displacement for the periodic cases.</span>
<a name="l00884"></a>00884                 di+=i;dj+=j;dk+=k;
<a name="l00885"></a>00885                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#a016e8be3527d58c655fa3e7c3b7e9e3">xperiodic</a>) {<span class="keywordflow">if</span>(di&lt;0) {qx=<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>-<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>;di+=<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;} <span class="keywordflow">else</span> <span class="keywordflow">if</span>(di&gt;=<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>) {qx=<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>-<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>;di-=<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;} <span class="keywordflow">else</span> qx=0;}
<a name="l00886"></a>00886                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#81d67b60c33d7345ffede5528c787a8c">yperiodic</a>) {<span class="keywordflow">if</span>(dj&lt;0) {qy=<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>-<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>;dj+=<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;} <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dj&gt;=<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>) {qy=<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>-<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>;dj-=<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;} <span class="keywordflow">else</span> qy=0;}
<a name="l00887"></a>00887                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#c58a7bee5aabd4e8c540918c7b2a3199">zperiodic</a>) {<span class="keywordflow">if</span>(dk&lt;0) {qz=<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>-<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>;dk+=<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;} <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&gt;=<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>) {qz=<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>-<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>;dk-=<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;} <span class="keywordflow">else</span> qz=0;}
<a name="l00888"></a>00888                 dijk=di+<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>*(dj+<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>*dk);
<a name="l00889"></a>00889 
<a name="l00890"></a>00890                 <span class="comment">// If mrs is bigger than the maximum distance to the block,</span>
<a name="l00891"></a>00891                 <span class="comment">// then we have to test all particles in the block for</span>
<a name="l00892"></a>00892                 <span class="comment">// intersections. Otherwise, we do additional checks and skip</span>
<a name="l00893"></a>00893                 <span class="comment">// those particles which can't possibly intersect the block.</span>
<a name="l00894"></a>00894                 <span class="keywordflow">if</span>(mrs&gt;<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(crs)) {
<a name="l00895"></a>00895                         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[dijk];l++) {
<a name="l00896"></a>00896                                 x1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l]+qx-x;
<a name="l00897"></a>00897                                 y1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+1]+qy-y;
<a name="l00898"></a>00898                                 z1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+2]+qz-z;
<a name="l00899"></a>00899                                 rs=<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.scale(x1*x1+y1*y1+z1*z1,dijk,l);
<a name="l00900"></a>00900                                 <span class="keywordflow">if</span> (!c.<a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x1,y1,z1,rs,<span class="keywordtype">id</span>[dijk][l])) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00901"></a>00901                         }
<a name="l00902"></a>00902                 } <span class="keywordflow">else</span> {
<a name="l00903"></a>00903                         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[dijk];l++) {
<a name="l00904"></a>00904                                 x1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l]+qx-x;
<a name="l00905"></a>00905                                 y1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+1]+qy-y;
<a name="l00906"></a>00906                                 z1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+2]+qz-z;
<a name="l00907"></a>00907                                 rs=<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.scale(x1*x1+y1*y1+z1*z1,dijk,l);
<a name="l00908"></a>00908                                 <span class="keywordflow">if</span>(rs&lt;mrs) {
<a name="l00909"></a>00909                                         <span class="keywordflow">if</span> (!c.<a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x1,y1,z1,rs,<span class="keywordtype">id</span>[dijk][l])) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00910"></a>00910                                 }
<a name="l00911"></a>00911                         }
<a name="l00912"></a>00912                 }
<a name="l00913"></a>00913         } <span class="keywordflow">while</span>(g&lt;f);
<a name="l00914"></a>00914 
<a name="l00915"></a>00915         <span class="comment">// If we reach here, we were unable to compute the entire cell using</span>
<a name="l00916"></a>00916         <span class="comment">// the first part of the worklist. This section of the algorithm</span>
<a name="l00917"></a>00917         <span class="comment">// continues the worklist, but it now starts preparing the mask that we</span>
<a name="l00918"></a>00918         <span class="comment">// need if we end up going block by block. We do the same as before,</span>
<a name="l00919"></a>00919         <span class="comment">// but we put a mark down on the mask for every block that's tested.</span>
<a name="l00920"></a>00920         <span class="comment">// The worklist also contains information about which neighbors of each</span>
<a name="l00921"></a>00921         <span class="comment">// block are not also on the worklist, and we start storing those</span>
<a name="l00922"></a>00922         <span class="comment">// points in a list in case we have to go block by block.</span>
<a name="l00923"></a>00923         ci=<a class="code" href="classcontainer__base.html#a016e8be3527d58c655fa3e7c3b7e9e3">xperiodic</a>?<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>:i;
<a name="l00924"></a>00924         cj=<a class="code" href="classcontainer__base.html#81d67b60c33d7345ffede5528c787a8c">yperiodic</a>?<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>:j;
<a name="l00925"></a>00925         ck=<a class="code" href="classcontainer__base.html#c58a7bee5aabd4e8c540918c7b2a3199">zperiodic</a>?<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>:k;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927         <span class="comment">// Update the mask counter, and if it wraps around then reset the</span>
<a name="l00928"></a>00928         <span class="comment">// whole mask; that will only happen once every 2^32 tries</span>
<a name="l00929"></a>00929         <a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>++;
<a name="l00930"></a>00930         <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>==0) {
<a name="l00931"></a>00931                 <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#68bf81f3465ca144c9879ba9ea0cc394">hxyz</a>;l++) <a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[l]=0;
<a name="l00932"></a>00932                 <a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>=1;
<a name="l00933"></a>00933         }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935         <span class="comment">// Reset the block by block counters</span>
<a name="l00936"></a>00936         <a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>=<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>=0;
<a name="l00937"></a>00937         
<a name="l00938"></a>00938         <span class="keywordflow">while</span>(g&lt;seq_length-1) {
<a name="l00939"></a>00939 
<a name="l00940"></a>00940                 <span class="comment">// At the intervals specified by count_list, we recompute the</span>
<a name="l00941"></a>00941                 <span class="comment">// maximum radius squared</span>
<a name="l00942"></a>00942                 <span class="keywordflow">if</span>(g==next_count) {
<a name="l00943"></a>00943                         mrs=c.<a class="code" href="classvoronoicell__base.html#9d26afb17f43732a626f7269c300b90d">maxradsq</a>();
<a name="l00944"></a>00944                         <span class="keywordflow">if</span>(list_index!=list_size) next_count=count_list[list_index++];
<a name="l00945"></a>00945                 }               
<a name="l00946"></a>00946                 
<a name="l00947"></a>00947                 <span class="comment">// If mrs is less than the minimum distance to any untested</span>
<a name="l00948"></a>00948                 <span class="comment">// block, then we are done.</span>
<a name="l00949"></a>00949                 <span class="keywordflow">if</span>(mrs&lt;<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(radp[g])) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00950"></a>00950                 g++;
<a name="l00951"></a>00951                 
<a name="l00952"></a>00952                 <span class="comment">// Load in a block off the worklist, permute it with the</span>
<a name="l00953"></a>00953                 <span class="comment">// symmetry mask, and decode its position. These are all</span>
<a name="l00954"></a>00954                 <span class="comment">// integer bit operations so they should run very fast.</span>
<a name="l00955"></a>00955                 q=e[g];q^=m1;q+=m2;
<a name="l00956"></a>00956                 di=q&amp;127;di-=64;
<a name="l00957"></a>00957                 dj=(q&gt;&gt;7)&amp;127;dj-=64;
<a name="l00958"></a>00958                 dk=(q&gt;&gt;14)&amp;127;dk-=64;
<a name="l00959"></a>00959                 
<a name="l00960"></a>00960                 <span class="comment">// Compute the position in the mask of the current block. If</span>
<a name="l00961"></a>00961                 <span class="comment">// this lies outside the mask, then skip it. Otherwise, mark</span>
<a name="l00962"></a>00962                 <span class="comment">// it.</span>
<a name="l00963"></a>00963                 ei=ci+di;
<a name="l00964"></a>00964                 ej=cj+dj;
<a name="l00965"></a>00965                 ek=ck+dk;
<a name="l00966"></a>00966                 <span class="keywordflow">if</span>(ei&lt;0) <span class="keywordflow">continue</span>;<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ei&gt;=<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>) <span class="keywordflow">continue</span>;
<a name="l00967"></a>00967                 <span class="keywordflow">if</span>(ej&lt;0) <span class="keywordflow">continue</span>;<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ej&gt;=<a class="code" href="classcontainer__base.html#59c9d60832d5778dd99ea61e377d854c">hy</a>) <span class="keywordflow">continue</span>;
<a name="l00968"></a>00968                 <span class="keywordflow">if</span>(ek&lt;0) <span class="keywordflow">continue</span>;<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ek&gt;=<a class="code" href="classcontainer__base.html#b351fa9d9000fb963e12647432675355">hz</a>) <span class="keywordflow">continue</span>;
<a name="l00969"></a>00969                 eijk=ei+<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>*(ej+<a class="code" href="classcontainer__base.html#59c9d60832d5778dd99ea61e377d854c">hy</a>*ek);
<a name="l00970"></a>00970                 <a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[eijk]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;
<a name="l00971"></a>00971                 
<a name="l00972"></a>00972                 <span class="comment">// Call the compute_min_max_radius() function. This returns</span>
<a name="l00973"></a>00973                 <span class="comment">// true if the minimum distance to the block is bigger than the</span>
<a name="l00974"></a>00974                 <span class="comment">// current mrs, in which case we skip this block and move on.</span>
<a name="l00975"></a>00975                 <span class="comment">// Otherwise, it computes the maximum distance to the block and</span>
<a name="l00976"></a>00976                 <span class="comment">// returns it in crs.</span>
<a name="l00977"></a>00977                 <span class="keywordflow">if</span>(compute_min_max_radius(di,dj,dk,fx,fy,fz,gxs,gys,gzs,crs,mrs)) <span class="keywordflow">continue</span>;
<a name="l00978"></a>00978                 
<a name="l00979"></a>00979                 <span class="comment">// Now compute which region we are going to loop over, adding a</span>
<a name="l00980"></a>00980                 <span class="comment">// displacement for the periodic cases.</span>
<a name="l00981"></a>00981                 di+=i;dj+=j;dk+=k;
<a name="l00982"></a>00982                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#a016e8be3527d58c655fa3e7c3b7e9e3">xperiodic</a>) {<span class="keywordflow">if</span>(di&lt;0) {qx=<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>-<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>;di+=<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;} <span class="keywordflow">else</span> <span class="keywordflow">if</span>(di&gt;=<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>) {qx=<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>-<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>;di-=<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;} <span class="keywordflow">else</span> qx=0;}
<a name="l00983"></a>00983                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#81d67b60c33d7345ffede5528c787a8c">yperiodic</a>) {<span class="keywordflow">if</span>(dj&lt;0) {qy=<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>-<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>;dj+=<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;} <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dj&gt;=<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>) {qy=<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>-<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>;dj-=<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;} <span class="keywordflow">else</span> qy=0;}
<a name="l00984"></a>00984                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#c58a7bee5aabd4e8c540918c7b2a3199">zperiodic</a>) {<span class="keywordflow">if</span>(dk&lt;0) {qz=<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>-<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>;dk+=<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;} <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&gt;=<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>) {qz=<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>-<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>;dk-=<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;} <span class="keywordflow">else</span> qz=0;}
<a name="l00985"></a>00985                 dijk=di+<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>*(dj+<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>*dk);
<a name="l00986"></a>00986 
<a name="l00987"></a>00987                 <span class="comment">// If mrs is bigger than the maximum distance to the block,</span>
<a name="l00988"></a>00988                 <span class="comment">// then we have to test all particles in the block for</span>
<a name="l00989"></a>00989                 <span class="comment">// intersections. Otherwise, we do additional checks and skip</span>
<a name="l00990"></a>00990                 <span class="comment">// those particles which can't possibly intersect the block.</span>
<a name="l00991"></a>00991                 <span class="keywordflow">if</span>(mrs&gt;<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(crs)) {
<a name="l00992"></a>00992                         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[dijk];l++) {
<a name="l00993"></a>00993                                 x1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l]+qx-x;
<a name="l00994"></a>00994                                 y1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+1]+qy-y;
<a name="l00995"></a>00995                                 z1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+2]+qz-z;
<a name="l00996"></a>00996                                 rs=<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.scale(x1*x1+y1*y1+z1*z1,dijk,l);
<a name="l00997"></a>00997                                 <span class="keywordflow">if</span> (!c.<a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x1,y1,z1,rs,<span class="keywordtype">id</span>[dijk][l])) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00998"></a>00998                         }
<a name="l00999"></a>00999                 } <span class="keywordflow">else</span> {
<a name="l01000"></a>01000                         <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[dijk];l++) {
<a name="l01001"></a>01001                                 x1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l]+qx-x;
<a name="l01002"></a>01002                                 y1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+1]+qy-y;
<a name="l01003"></a>01003                                 z1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[dijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+2]+qz-z;
<a name="l01004"></a>01004                                 rs=<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.scale(x1*x1+y1*y1+z1*z1,dijk,l);
<a name="l01005"></a>01005                                 <span class="keywordflow">if</span>(rs&lt;mrs) {
<a name="l01006"></a>01006                                         <span class="keywordflow">if</span>(!c.<a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x1,y1,z1,rs,<span class="keywordtype">id</span>[dijk][l])) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01007"></a>01007                                 }
<a name="l01008"></a>01008                         }
<a name="l01009"></a>01009                 }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011                 <span class="comment">// If there might not be enough memory on the list for these</span>
<a name="l01012"></a>01012                 <span class="comment">// additions, then add more</span>
<a name="l01013"></a>01013                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>+18&gt;<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>) <a class="code" href="classcontainer__base.html#077feb22ead0280cd6884b01acac6e08">add_list_memory</a>();
<a name="l01014"></a>01014 
<a name="l01015"></a>01015                 <span class="comment">// Test the parts of the worklist element which tell us what</span>
<a name="l01016"></a>01016                 <span class="comment">// neighbors of this block are not on the worklist. Store them</span>
<a name="l01017"></a>01017                 <span class="comment">// on the block list, and mark the mask.</span>
<a name="l01018"></a>01018                 <span class="keywordflow">if</span>((q&amp;b2)==b2) {
<a name="l01019"></a>01019                         <span class="keywordflow">if</span>(ei&gt;0) <span class="keywordflow">if</span>(mask[eijk-1]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {mask[eijk-1]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ei-1;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ej;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ek;}
<a name="l01020"></a>01020                         <span class="keywordflow">if</span>((q&amp;b1)==0) <span class="keywordflow">if</span>(ei&lt;<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>-1) <span class="keywordflow">if</span>(mask[eijk+1]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {mask[eijk+1]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ei+1;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ej;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ek;}
<a name="l01021"></a>01021                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((q&amp;b1)==b1) {<span class="keywordflow">if</span>(ei&lt;<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>-1) <span class="keywordflow">if</span>(mask[eijk+1]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {mask[eijk+1]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ei+1;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ej;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ek;}}
<a name="l01022"></a>01022                 <span class="keywordflow">if</span>((q&amp;b4)==b4) {<span class="keywordflow">if</span>(ej&gt;0) <span class="keywordflow">if</span>(mask[eijk-<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {mask[eijk-<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ei;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ej-1;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ek;}
<a name="l01023"></a>01023                         <span class="keywordflow">if</span>((q&amp;b3)==0) <span class="keywordflow">if</span>(ej&lt;<a class="code" href="classcontainer__base.html#59c9d60832d5778dd99ea61e377d854c">hy</a>-1) <span class="keywordflow">if</span>(mask[eijk+<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {mask[eijk+<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ei;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ej+1;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ek;}
<a name="l01024"></a>01024                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((q&amp;b3)==b3) {<span class="keywordflow">if</span>(ej&lt;<a class="code" href="classcontainer__base.html#59c9d60832d5778dd99ea61e377d854c">hy</a>-1) <span class="keywordflow">if</span>(mask[eijk+<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {mask[eijk+<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ei;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ej+1;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ek;}} 
<a name="l01025"></a>01025                 <span class="keywordflow">if</span>((q&amp;b6)==b6) {<span class="keywordflow">if</span>(ek&gt;0) <span class="keywordflow">if</span>(mask[eijk-<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {mask[eijk-<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ei;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ej;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ek-1;}
<a name="l01026"></a>01026                         <span class="keywordflow">if</span>((q&amp;b5)==0) <span class="keywordflow">if</span>(ek&lt;<a class="code" href="classcontainer__base.html#b351fa9d9000fb963e12647432675355">hz</a>-1) <span class="keywordflow">if</span>(mask[eijk+<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {mask[eijk+<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ei;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ej;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ek+1;}
<a name="l01027"></a>01027                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((q&amp;b5)==b5) <span class="keywordflow">if</span>(ek&lt;<a class="code" href="classcontainer__base.html#b351fa9d9000fb963e12647432675355">hz</a>-1) <span class="keywordflow">if</span>(mask[eijk+<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {mask[eijk+<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ei;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ej;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=ek+1;}
<a name="l01028"></a>01028         }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030         <span class="comment">// Do a check to see if we've reach the radius cutoff</span>
<a name="l01031"></a>01031         <span class="keywordflow">if</span>(mrs&lt;<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(radp[g])) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01032"></a>01032 
<a name="l01033"></a>01033         <span class="comment">// Update the mask counter, and if it has wrapped around, then</span>
<a name="l01034"></a>01034         <span class="comment">// reset the mask</span>
<a name="l01035"></a>01035         fx+=boxx*ci;fy+=boxy*cj;fz+=boxz*ck;
<a name="l01036"></a>01036 
<a name="l01037"></a>01037         <span class="comment">// We were unable to completely compute the cell based on the blocks in</span>
<a name="l01038"></a>01038         <span class="comment">// the worklist, so now we have to go block by block, reading in items</span>
<a name="l01039"></a>01039         <span class="comment">// off the list</span>
<a name="l01040"></a>01040         <span class="keywordflow">while</span>(<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>!=<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>) {
<a name="l01041"></a>01041 
<a name="l01042"></a>01042                 <span class="comment">// If we reached the end of the list memory loop back to the start</span>
<a name="l01043"></a>01043                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>==<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>) <a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>=0;
<a name="l01044"></a>01044 
<a name="l01045"></a>01045                 <span class="comment">// Read in a block off the list, and compute the upper and lower</span>
<a name="l01046"></a>01046                 <span class="comment">// coordinates in each of the three dimensions</span>
<a name="l01047"></a>01047                 di=<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>++];dj=<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>++];dk=<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>++];
<a name="l01048"></a>01048                 xlo=di*boxx-fx;xhi=xlo+boxx;
<a name="l01049"></a>01049                 ylo=dj*boxy-fy;yhi=ylo+boxy;
<a name="l01050"></a>01050                 zlo=dk*boxz-fz;zhi=zlo+boxz;
<a name="l01051"></a>01051 
<a name="l01052"></a>01052                 <span class="comment">// Carry out plane tests to see if any particle in this block</span>
<a name="l01053"></a>01053                 <span class="comment">// could possibly intersect the cell </span>
<a name="l01054"></a>01054                 <span class="keywordflow">if</span>(di&gt;ci) {
<a name="l01055"></a>01055                         <span class="keywordflow">if</span>(dj&gt;cj) {
<a name="l01056"></a>01056                                 <span class="keywordflow">if</span>(dk&gt;ck) {
<a name="l01057"></a>01057                                         <span class="keywordflow">if</span>(corner_test(c,xlo,ylo,zlo,xhi,yhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01058"></a>01058                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;ck) {
<a name="l01059"></a>01059                                         <span class="keywordflow">if</span>(corner_test(c,xlo,ylo,zhi,xhi,yhi,zlo)) <span class="keywordflow">continue</span>;
<a name="l01060"></a>01060                                 } <span class="keywordflow">else</span> {
<a name="l01061"></a>01061                                         <span class="keywordflow">if</span>(edge_z_test(c,xlo,ylo,zlo,xhi,yhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01062"></a>01062                                 }
<a name="l01063"></a>01063                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dj&lt;cj) {
<a name="l01064"></a>01064                                 <span class="keywordflow">if</span>(dk&gt;ck) {
<a name="l01065"></a>01065                                         <span class="keywordflow">if</span>(corner_test(c,xlo,yhi,zlo,xhi,ylo,zhi)) <span class="keywordflow">continue</span>;
<a name="l01066"></a>01066                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;ck) {
<a name="l01067"></a>01067                                         <span class="keywordflow">if</span>(corner_test(c,xlo,yhi,zhi,xhi,ylo,zlo)) <span class="keywordflow">continue</span>;
<a name="l01068"></a>01068                                 } <span class="keywordflow">else</span> {
<a name="l01069"></a>01069                                         <span class="keywordflow">if</span>(edge_z_test(c,xlo,yhi,zlo,xhi,ylo,zhi)) <span class="keywordflow">continue</span>;
<a name="l01070"></a>01070                                 }
<a name="l01071"></a>01071                         } <span class="keywordflow">else</span> {
<a name="l01072"></a>01072                                 <span class="keywordflow">if</span>(dk&gt;ck) {
<a name="l01073"></a>01073                                         <span class="keywordflow">if</span>(edge_y_test(c,xlo,ylo,zlo,xhi,yhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01074"></a>01074                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;ck) {
<a name="l01075"></a>01075                                         <span class="keywordflow">if</span>(edge_y_test(c,xlo,ylo,zhi,xhi,yhi,zlo)) <span class="keywordflow">continue</span>;
<a name="l01076"></a>01076                                 } <span class="keywordflow">else</span> {
<a name="l01077"></a>01077                                         <span class="keywordflow">if</span>(face_x_test(c,xlo,ylo,zlo,yhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01078"></a>01078                                 }
<a name="l01079"></a>01079                         }
<a name="l01080"></a>01080                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(di&lt;ci) {
<a name="l01081"></a>01081                         <span class="keywordflow">if</span>(dj&gt;cj) {
<a name="l01082"></a>01082                                 <span class="keywordflow">if</span>(dk&gt;ck) {
<a name="l01083"></a>01083                                         <span class="keywordflow">if</span>(corner_test(c,xhi,ylo,zlo,xlo,yhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01084"></a>01084                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;ck) {
<a name="l01085"></a>01085                                         <span class="keywordflow">if</span>(corner_test(c,xhi,ylo,zhi,xlo,yhi,zlo)) <span class="keywordflow">continue</span>;
<a name="l01086"></a>01086                                 } <span class="keywordflow">else</span> {
<a name="l01087"></a>01087                                         <span class="keywordflow">if</span>(edge_z_test(c,xhi,ylo,zlo,xlo,yhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01088"></a>01088                                 }
<a name="l01089"></a>01089                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dj&lt;cj) {
<a name="l01090"></a>01090                                 <span class="keywordflow">if</span>(dk&gt;ck) {
<a name="l01091"></a>01091                                         <span class="keywordflow">if</span>(corner_test(c,xhi,yhi,zlo,xlo,ylo,zhi)) <span class="keywordflow">continue</span>;
<a name="l01092"></a>01092                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;ck) {
<a name="l01093"></a>01093                                         <span class="keywordflow">if</span>(corner_test(c,xhi,yhi,zhi,xlo,ylo,zlo)) <span class="keywordflow">continue</span>;
<a name="l01094"></a>01094                                 } <span class="keywordflow">else</span> {
<a name="l01095"></a>01095                                         <span class="keywordflow">if</span>(edge_z_test(c,xhi,yhi,zlo,xlo,ylo,zhi)) <span class="keywordflow">continue</span>;
<a name="l01096"></a>01096                                 }
<a name="l01097"></a>01097                         } <span class="keywordflow">else</span> {
<a name="l01098"></a>01098                                 <span class="keywordflow">if</span>(dk&gt;ck) {
<a name="l01099"></a>01099                                         <span class="keywordflow">if</span>(edge_y_test(c,xhi,ylo,zlo,xlo,yhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01100"></a>01100                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;ck) {
<a name="l01101"></a>01101                                         <span class="keywordflow">if</span>(edge_y_test(c,xhi,ylo,zhi,xlo,yhi,zlo)) <span class="keywordflow">continue</span>;
<a name="l01102"></a>01102                                 } <span class="keywordflow">else</span> {
<a name="l01103"></a>01103                                         <span class="keywordflow">if</span>(face_x_test(c,xhi,ylo,zlo,yhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01104"></a>01104                                 }
<a name="l01105"></a>01105                         }
<a name="l01106"></a>01106                 } <span class="keywordflow">else</span> {
<a name="l01107"></a>01107                         <span class="keywordflow">if</span>(dj&gt;cj) {
<a name="l01108"></a>01108                                 <span class="keywordflow">if</span>(dk&gt;ck) {
<a name="l01109"></a>01109                                         <span class="keywordflow">if</span>(edge_x_test(c,xlo,ylo,zlo,xhi,yhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01110"></a>01110                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;ck) {
<a name="l01111"></a>01111                                         <span class="keywordflow">if</span>(edge_x_test(c,xlo,ylo,zhi,xhi,yhi,zlo)) <span class="keywordflow">continue</span>;
<a name="l01112"></a>01112                                 } <span class="keywordflow">else</span> {
<a name="l01113"></a>01113                                         <span class="keywordflow">if</span>(face_y_test(c,xlo,ylo,zlo,xhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01114"></a>01114                                 }
<a name="l01115"></a>01115                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dj&lt;cj) {
<a name="l01116"></a>01116                                 <span class="keywordflow">if</span>(dk&gt;ck) {
<a name="l01117"></a>01117                                         <span class="keywordflow">if</span>(edge_x_test(c,xlo,yhi,zlo,xhi,ylo,zhi)) <span class="keywordflow">continue</span>;
<a name="l01118"></a>01118                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;ck) {
<a name="l01119"></a>01119                                         <span class="keywordflow">if</span>(edge_x_test(c,xlo,yhi,zhi,xhi,ylo,zlo)) <span class="keywordflow">continue</span>;
<a name="l01120"></a>01120                                 } <span class="keywordflow">else</span> {
<a name="l01121"></a>01121                                         <span class="keywordflow">if</span>(face_y_test(c,xlo,yhi,zlo,xhi,zhi)) <span class="keywordflow">continue</span>;
<a name="l01122"></a>01122                                 }
<a name="l01123"></a>01123                         } <span class="keywordflow">else</span> {
<a name="l01124"></a>01124                                 <span class="keywordflow">if</span>(dk&gt;ck) {
<a name="l01125"></a>01125                                         <span class="keywordflow">if</span>(face_z_test(c,xlo,ylo,zlo,xhi,yhi)) <span class="keywordflow">continue</span>;
<a name="l01126"></a>01126                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;ck) {
<a name="l01127"></a>01127                                         <span class="keywordflow">if</span>(face_z_test(c,xlo,ylo,zhi,xhi,yhi)) <span class="keywordflow">continue</span>;
<a name="l01128"></a>01128                                 } <span class="keywordflow">else</span> {
<a name="l01129"></a>01129                                         cout &lt;&lt; <span class="stringliteral">"Can't happen ... happened\n"</span>;
<a name="l01130"></a>01130                                 }
<a name="l01131"></a>01131                         }
<a name="l01132"></a>01132                 }
<a name="l01133"></a>01133 
<a name="l01134"></a>01134                 <span class="comment">// Now compute the region that we are going to test over, and</span>
<a name="l01135"></a>01135                 <span class="comment">// set a displacement vector for the periodic cases.</span>
<a name="l01136"></a>01136                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#a016e8be3527d58c655fa3e7c3b7e9e3">xperiodic</a>) {ei=i+di-<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>;<span class="keywordflow">if</span>(ei&lt;0) {qx=<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>-<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>;ei+=nx;} <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ei&gt;=nx) {qx=<a class="code" href="classcontainer__base.html#fa151c56a0fa53fe26ffe7a098452497">bx</a>-<a class="code" href="classcontainer__base.html#e1ff7508a4577029bcf4e56ebd85e738">ax</a>;ei-=nx;} <span class="keywordflow">else</span> qx=0;} <span class="keywordflow">else</span> ei=di;
<a name="l01137"></a>01137                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#81d67b60c33d7345ffede5528c787a8c">yperiodic</a>) {ej=j+dj-<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>;<span class="keywordflow">if</span>(ej&lt;0) {qy=<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>-<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>;ej+=ny;} <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ej&gt;=ny) {qy=<a class="code" href="classcontainer__base.html#7e0851ae7223fd8edca47d325d12a0d5">by</a>-<a class="code" href="classcontainer__base.html#57d67f8ded8cd7232531db02b521230d">ay</a>;ej-=ny;} <span class="keywordflow">else</span> qy=0;} <span class="keywordflow">else</span> ej=dj;
<a name="l01138"></a>01138                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#c58a7bee5aabd4e8c540918c7b2a3199">zperiodic</a>) {ek=k+dk-<a class="code" href="classcontainer__base.html#126f2af1fa1f3e969e206d656f5bcf96">nz</a>;<span class="keywordflow">if</span>(ek&lt;0) {qz=<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>-<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>;ek+=nz;} <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ek&gt;=nz) {qz=<a class="code" href="classcontainer__base.html#644bccabe62693c383ec3bb21f2d5610">bz</a>-<a class="code" href="classcontainer__base.html#d3baeb02895775186ad11e7b5c754594">az</a>;ek-=nz;} <span class="keywordflow">else</span> qz=0;} <span class="keywordflow">else</span> ek=dk;
<a name="l01139"></a>01139                 eijk=ei+<a class="code" href="classcontainer__base.html#4b059e369792cc85d332d8e1566da304">nx</a>*(ej+<a class="code" href="classcontainer__base.html#283b2bd69b8029365ccbe73d182c5486">ny</a>*ek);
<a name="l01140"></a>01140 
<a name="l01141"></a>01141                 <span class="comment">// Loop over all the elements in the block to test for cuts.</span>
<a name="l01142"></a>01142                 <span class="comment">// It would be possible to exclude some of these cases by testing</span>
<a name="l01143"></a>01143                 <span class="comment">// against mrs, but I am not convinced that this will save time.</span>
<a name="l01144"></a>01144                 <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="classcontainer__base.html#afb8c9cfd52cb0001d5ad6a6f9d8b441">co</a>[eijk];l++) {
<a name="l01145"></a>01145                         x1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[eijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l]+qx-x;
<a name="l01146"></a>01146                         y1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[eijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+1]+qy-y;
<a name="l01147"></a>01147                         z1=<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[eijk][<a class="code" href="classcontainer__base.html#95503d8da34d4a881e57a546716965f9">sz</a>*l+2]+qz-z;
<a name="l01148"></a>01148                         rs=<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.scale(x1*x1+y1*y1+z1*z1,eijk,l);
<a name="l01149"></a>01149                         <span class="keywordflow">if</span> (!c.<a class="code" href="classvoronoicell__base.html#92240d614674136d9629ff5172cb36ee">nplane</a>(x1,y1,z1,rs,<span class="keywordtype">id</span>[eijk][l])) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01150"></a>01150                 }
<a name="l01151"></a>01151 
<a name="l01152"></a>01152                 <span class="comment">// If there's not much memory on the block list then add more</span>
<a name="l01153"></a>01153                 <span class="keywordflow">if</span>((<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>&lt;=<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>?<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>-<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>+<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>:<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>-<a class="code" href="classcontainer__base.html#c0c3d06c90c4263c1c58a72cbb595c77">s_start</a>)&lt;18) <a class="code" href="classcontainer__base.html#077feb22ead0280cd6884b01acac6e08">add_list_memory</a>();
<a name="l01154"></a>01154 
<a name="l01155"></a>01155                 <span class="comment">// Test the neighbors of the current block, and add them to the</span>
<a name="l01156"></a>01156                 <span class="comment">// block list if they haven't already been tested.</span>
<a name="l01157"></a>01157                 dijk=di+<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>*(dj+<a class="code" href="classcontainer__base.html#59c9d60832d5778dd99ea61e377d854c">hy</a>*dk);
<a name="l01158"></a>01158                 <span class="keywordflow">if</span>(di&gt;0) <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk-1]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {<span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>==<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>) <a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>=0;<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk-1]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=di-1;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dj;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dk;}
<a name="l01159"></a>01159                 <span class="keywordflow">if</span>(dj&gt;0) <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk-<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {<span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>==<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>) <a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>=0;<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk-<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=di;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dj-1;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dk;}
<a name="l01160"></a>01160                 <span class="keywordflow">if</span>(dk&gt;0) <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk-<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {<span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>==<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>) <a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>=0;<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk-<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=di;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dj;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dk-1;}
<a name="l01161"></a>01161                 <span class="keywordflow">if</span>(di&lt;<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>-1) <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk+1]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {<span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>==<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>) <a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>=0;<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk+1]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=di+1;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dj;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dk;}
<a name="l01162"></a>01162                 <span class="keywordflow">if</span>(dj&lt;<a class="code" href="classcontainer__base.html#59c9d60832d5778dd99ea61e377d854c">hy</a>-1) <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk+<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {<span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>==<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>) <a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>=0;<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk+<a class="code" href="classcontainer__base.html#45e835fd60354eb8f4c69bdc4d4002e6">hx</a>]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=di;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dj+1;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dk;}
<a name="l01163"></a>01163                 <span class="keywordflow">if</span>(dk&lt;<a class="code" href="classcontainer__base.html#b351fa9d9000fb963e12647432675355">hz</a>-1) <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk+<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>]!=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>) {<span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>==<a class="code" href="classcontainer__base.html#d071b2fbb4441f5a35ac10a76e78b048">s_size</a>) <a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>=0;<a class="code" href="classcontainer__base.html#b148fce82af53215a827e6e18e92fe7a">mask</a>[dijk+<a class="code" href="classcontainer__base.html#5bfc8d3dfffde4d41cb15446e00a64db">hxy</a>]=<a class="code" href="classcontainer__base.html#ef43488fde95ebf1b4e7d02cced4b526">mv</a>;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=di;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dj;<a class="code" href="classcontainer__base.html#b973bbee6cfc64762ebaad1519dd2a1b">sl</a>[<a class="code" href="classcontainer__base.html#2b5576506292c3f160695dca22f14a64">s_end</a>++]=dk+1;}
<a name="l01164"></a>01164         }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01167"></a>01167 }
<a name="l01168"></a>01168 <span class="comment"></span>
<a name="l01169"></a>01169 <span class="comment">/** This function checks to see whether a particular block can possibly have</span>
<a name="l01170"></a>01170 <span class="comment"> * any intersection with a Voronoi cell, for the case when the closest point</span>
<a name="l01171"></a>01171 <span class="comment"> * from the cell center to the block is at a corner.</span>
<a name="l01172"></a>01172 <span class="comment"> * \param[in] &amp;c a reference to a Voronoi cell.</span>
<a name="l01173"></a>01173 <span class="comment"> * \param[in] (xl,yl,zl) the relative coordinates of the corner of the block closest to</span>
<a name="l01174"></a>01174 <span class="comment"> * the cell center.</span>
<a name="l01175"></a>01175 <span class="comment"> * \param[in] (xh,yh,zh) the relative coordinates of the corner of the block furthest</span>
<a name="l01176"></a>01176 <span class="comment"> * away from the cell center.</span>
<a name="l01177"></a>01177 <span class="comment"> * \return false if the block may intersect, true if does not. */</span>
<a name="l01178"></a>01178 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l01179"></a>01179 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01180"></a>01180 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;::corner_test</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> yl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xh,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> yh,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zh) {
<a name="l01181"></a>01181         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#b3e411308c12a386e6a8f22d67bfc547">plane_intersects_guess</a>(xh,yl,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xh+yl*yl+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01182"></a>01182         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xh,yh,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xh+yl*yh+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01183"></a>01183         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,yh,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+yl*yh+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01184"></a>01184         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,yh,zh,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+yl*yh+zl*zh))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01185"></a>01185         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,yl,zh,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+yl*yl+zl*zh))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01186"></a>01186         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xh,yl,zh,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xh+yl*yl+zl*zh))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01187"></a>01187         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01188"></a>01188 }
<a name="l01189"></a>01189 <span class="comment"></span>
<a name="l01190"></a>01190 <span class="comment">/** This function checks to see whether a particular block can possibly have</span>
<a name="l01191"></a>01191 <span class="comment"> * any intersection with a Voronoi cell, for the case when the closest point</span>
<a name="l01192"></a>01192 <span class="comment"> * from the cell center to the block is on an edge which points along the x</span>
<a name="l01193"></a>01193 <span class="comment"> * direction.</span>
<a name="l01194"></a>01194 <span class="comment"> * \param[in] &amp;c a reference to a Voronoi cell.</span>
<a name="l01195"></a>01195 <span class="comment"> * \param[in] (x0,x1) the minimum and maximum relative x coordinates of the block.</span>
<a name="l01196"></a>01196 <span class="comment"> * \param[in] (yl,zl) the relative y and z coordinates of the corner of the block closest to</span>
<a name="l01197"></a>01197 <span class="comment"> * the cell center.</span>
<a name="l01198"></a>01198 <span class="comment"> * \param[in] (yh,zh) the relative y and z coordinates of the corner of the block furthest</span>
<a name="l01199"></a>01199 <span class="comment"> * away from the cell center.</span>
<a name="l01200"></a>01200 <span class="comment"> * \return false if the block may intersect, true if does not. */</span>
<a name="l01201"></a>01201 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l01202"></a>01202 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01203"></a>01203 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;::edge_x_test</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> yl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x1,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> yh,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zh) {
<a name="l01204"></a>01204         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#b3e411308c12a386e6a8f22d67bfc547">plane_intersects_guess</a>(x0,yl,zh,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(yl*yl+zl*zh))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01205"></a>01205         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x1,yl,zh,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(yl*yl+zl*zh))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01206"></a>01206         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x1,yl,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(yl*yl+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01207"></a>01207         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x0,yl,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(yl*yl+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01208"></a>01208         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x0,yh,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(yl*yh+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01209"></a>01209         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x1,yh,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(yl*yh+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01210"></a>01210         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01211"></a>01211 }
<a name="l01212"></a>01212 <span class="comment"></span>
<a name="l01213"></a>01213 <span class="comment">/** This function checks to see whether a particular block can possibly have</span>
<a name="l01214"></a>01214 <span class="comment"> * any intersection with a Voronoi cell, for the case when the closest point</span>
<a name="l01215"></a>01215 <span class="comment"> * from the cell center to the block is on an edge which points along the y</span>
<a name="l01216"></a>01216 <span class="comment"> * direction.</span>
<a name="l01217"></a>01217 <span class="comment"> * \param[in] &amp;c a reference to a Voronoi cell.</span>
<a name="l01218"></a>01218 <span class="comment"> * \param[in] (y0,y1) the minimum and maximum relative y coordinates of the block.</span>
<a name="l01219"></a>01219 <span class="comment"> * \param[in] (xl,zl) the relative x and z coordinates of the corner of the block closest to</span>
<a name="l01220"></a>01220 <span class="comment"> * the cell center.</span>
<a name="l01221"></a>01221 <span class="comment"> * \param[in] (xh,zh) the relative x and z coordinates of the corner of the block furthest</span>
<a name="l01222"></a>01222 <span class="comment"> * away from the cell center.</span>
<a name="l01223"></a>01223 <span class="comment"> * \return false if the block may intersect, true if does not. */</span>
<a name="l01224"></a>01224 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l01225"></a>01225 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01226"></a>01226 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;::edge_y_test</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xh,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y1,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zh) {
<a name="l01227"></a>01227         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#b3e411308c12a386e6a8f22d67bfc547">plane_intersects_guess</a>(xl,y0,zh,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+zl*zh))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01228"></a>01228         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,y1,zh,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+zl*zh))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01229"></a>01229         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,y1,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01230"></a>01230         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,y0,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01231"></a>01231         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xh,y0,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xh+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01232"></a>01232         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xh,y1,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xh+zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01233"></a>01233         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01234"></a>01234 }
<a name="l01235"></a>01235 <span class="comment"></span>
<a name="l01236"></a>01236 <span class="comment">/** This function checks to see whether a particular block can possibly have</span>
<a name="l01237"></a>01237 <span class="comment"> * any intersection with a Voronoi cell, for the case when the closest point</span>
<a name="l01238"></a>01238 <span class="comment"> * from the cell center to the block is on an edge which points along the z</span>
<a name="l01239"></a>01239 <span class="comment"> * direction.</span>
<a name="l01240"></a>01240 <span class="comment"> * \param[in] &amp;c a reference to a Voronoi cell.</span>
<a name="l01241"></a>01241 <span class="comment"> * \param[in] (z0,z1) the minimum and maximum relative z coordinates of the block.</span>
<a name="l01242"></a>01242 <span class="comment"> * \param[in] (xl,yl) the relative x and y coordinates of the corner of the block closest to</span>
<a name="l01243"></a>01243 <span class="comment"> * the cell center.</span>
<a name="l01244"></a>01244 <span class="comment"> * \param[in] (xh,yh) the relative x and y coordinates of the corner of the block furthest</span>
<a name="l01245"></a>01245 <span class="comment"> * away from the cell center.</span>
<a name="l01246"></a>01246 <span class="comment"> * \return false if the block may intersect, true if does not. */</span>
<a name="l01247"></a>01247 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l01248"></a>01248 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01249"></a>01249 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;::edge_z_test</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> yl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xh,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> yh,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z1) {
<a name="l01250"></a>01250         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#b3e411308c12a386e6a8f22d67bfc547">plane_intersects_guess</a>(xl,yh,z0,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+yl*yh))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01251"></a>01251         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,yh,z1,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+yl*yh))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01252"></a>01252         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,yl,z1,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+yl*yl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01253"></a>01253         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,yl,z0,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl+yl*yl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01254"></a>01254         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xh,yl,z0,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xh+yl*yl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01255"></a>01255         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xh,yl,z1,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xh+yl*yl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01256"></a>01256         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01257"></a>01257 }
<a name="l01258"></a>01258 <span class="comment"></span>
<a name="l01259"></a>01259 <span class="comment">/** This function checks to see whether a particular block can possibly have</span>
<a name="l01260"></a>01260 <span class="comment"> * any intersection with a Voronoi cell, for the case when the closest point</span>
<a name="l01261"></a>01261 <span class="comment"> * from the cell center to the block is on a face aligned with the x direction.</span>
<a name="l01262"></a>01262 <span class="comment"> * \param[in] &amp;c a reference to a Voronoi cell.</span>
<a name="l01263"></a>01263 <span class="comment"> * \param[in] xl the minimum distance from the cell center to the face.</span>
<a name="l01264"></a>01264 <span class="comment"> * \param[in] (y0,y1) the minimum and maximum relative y coordinates of the block.</span>
<a name="l01265"></a>01265 <span class="comment"> * \param[in] (z0,z1) the minimum and maximum relative z coordinates of the block.</span>
<a name="l01266"></a>01266 <span class="comment"> * \return false if the block may intersect, true if does not. */</span>
<a name="l01267"></a>01267 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l01268"></a>01268 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01269"></a>01269 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;::face_x_test</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y1,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z1) {
<a name="l01270"></a>01270         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#b3e411308c12a386e6a8f22d67bfc547">plane_intersects_guess</a>(xl,y0,z0,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01271"></a>01271         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,y0,z1,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01272"></a>01272         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,y1,z1,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01273"></a>01273         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(xl,y1,z0,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(xl*xl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01274"></a>01274         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01275"></a>01275 }
<a name="l01276"></a>01276 <span class="comment"></span>
<a name="l01277"></a>01277 <span class="comment">/** This function checks to see whether a particular block can possibly have</span>
<a name="l01278"></a>01278 <span class="comment"> * any intersection with a Voronoi cell, for the case when the closest point</span>
<a name="l01279"></a>01279 <span class="comment"> * from the cell center to the block is on a face aligned with the y direction.</span>
<a name="l01280"></a>01280 <span class="comment"> * \param[in] &amp;c a reference to a Voronoi cell.</span>
<a name="l01281"></a>01281 <span class="comment"> * \param[in] yl the minimum distance from the cell center to the face.</span>
<a name="l01282"></a>01282 <span class="comment"> * \param[in] (x0,x1) the minimum and maximum relative x coordinates of the block.</span>
<a name="l01283"></a>01283 <span class="comment"> * \param[in] (z0,z1) the minimum and maximum relative z coordinates of the block.</span>
<a name="l01284"></a>01284 <span class="comment"> * \return false if the block may intersect, true if does not. */</span>
<a name="l01285"></a>01285 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l01286"></a>01286 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01287"></a>01287 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;::face_y_test</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> yl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x1,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> z1) {
<a name="l01288"></a>01288         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#b3e411308c12a386e6a8f22d67bfc547">plane_intersects_guess</a>(x0,yl,z0,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(yl*yl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01289"></a>01289         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x0,yl,z1,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(yl*yl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01290"></a>01290         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x1,yl,z1,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(yl*yl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01291"></a>01291         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x1,yl,z0,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(yl*yl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01292"></a>01292         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01293"></a>01293 }
<a name="l01294"></a>01294 <span class="comment"></span>
<a name="l01295"></a>01295 <span class="comment">/** This function checks to see whether a particular block can possibly have</span>
<a name="l01296"></a>01296 <span class="comment"> * any intersection with a Voronoi cell, for the case when the closest point</span>
<a name="l01297"></a>01297 <span class="comment"> * from the cell center to the block is on a face aligned with the z direction.</span>
<a name="l01298"></a>01298 <span class="comment"> * \param[in] &amp;c a reference to a Voronoi cell.</span>
<a name="l01299"></a>01299 <span class="comment"> * \param[in] zl the minimum distance from the cell center to the face.</span>
<a name="l01300"></a>01300 <span class="comment"> * \param[in] (x0,x1) the minimum and maximum relative x coordinates of the block.</span>
<a name="l01301"></a>01301 <span class="comment"> * \param[in] (y0,y1) the minimum and maximum relative y coordinates of the block.</span>
<a name="l01302"></a>01302 <span class="comment"> * \return false if the block may intersect, true if does not. */</span>
<a name="l01303"></a>01303 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l01304"></a>01304 <span class="keyword">template</span>&lt;<span class="keyword">class</span> n_option&gt;
<a name="l01305"></a>01305 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;::face_z_test</a>(<a class="code" href="classvoronoicell__base.html" title="A class encapsulating all the routines for storing and calculating a single Voronoi...">voronoicell_base&lt;n_option&gt;</a> &amp;c,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y0,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zl,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x1,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> y1) {
<a name="l01306"></a>01306         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#b3e411308c12a386e6a8f22d67bfc547">plane_intersects_guess</a>(x0,y0,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01307"></a>01307         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x0,y1,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01308"></a>01308         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x1,y1,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01309"></a>01309         <span class="keywordflow">if</span>(c.<a class="code" href="classvoronoicell__base.html#efb67d958e89e4a1b10e4510e2244b6b">plane_intersects</a>(x1,y0,zl,<a class="code" href="classcontainer__base.html#aa5cb0a1e77bec05e0a6bc99132e2d8c">radius</a>.cutoff(zl*zl))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01310"></a>01310         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01311"></a>01311 }
<a name="l01312"></a>01312 <span class="comment"></span>
<a name="l01313"></a>01313 <span class="comment">/** Creates a voropp_loop object, by pulling the necessary constants about the container</span>
<a name="l01314"></a>01314 <span class="comment"> * geometry from a pointer to the current container class. */</span>
<a name="l01315"></a>01315 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l01316"></a><a class="code" href="classvoropp__loop.html#a087d01bd437c9006a69b2befe0bad6d">01316</a> <a class="code" href="classvoropp__loop.html#a087d01bd437c9006a69b2befe0bad6d">voropp_loop::voropp_loop</a>(<a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;</a> *q) : sx(q-&gt;bx-q-&gt;ax), sy(q-&gt;by-q-&gt;ay), sz(q-&gt;bz-q-&gt;az),
<a name="l01317"></a>01317         xsp(q-&gt;xsp),ysp(q-&gt;ysp),zsp(q-&gt;zsp),
<a name="l01318"></a>01318         ax(q-&gt;ax),ay(q-&gt;ay),az(q-&gt;az),
<a name="l01319"></a>01319         nx(q-&gt;nx),ny(q-&gt;ny),nz(q-&gt;nz),nxy(q-&gt;nxy),nxyz(q-&gt;nxyz),
<a name="l01320"></a>01320         xperiodic(q-&gt;xperiodic),yperiodic(q-&gt;yperiodic),zperiodic(q-&gt;zperiodic) {}
<a name="l01321"></a>01321 <span class="comment"></span>
<a name="l01322"></a>01322 <span class="comment">/** Initializes a voropp_loop object, by finding all blocks which are within a distance</span>
<a name="l01323"></a>01323 <span class="comment"> * r of the vector (vx,vy,vz). It returns the first block which is to be</span>
<a name="l01324"></a>01324 <span class="comment"> * tested, and sets the periodic displacement vector (px,py,pz) accordingly. */</span>
<a name="l01325"></a><a class="code" href="classvoropp__loop.html#8d34dfb5dab6412a684e233a6dfbab30">01325</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classvoropp__loop.html#8d34dfb5dab6412a684e233a6dfbab30">voropp_loop::init</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> vx,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> vy,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> vz,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> r,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;px,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;py,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;pz) {
<a name="l01326"></a>01326         ai=step_int((vx-ax-r)*xsp);
<a name="l01327"></a>01327         bi=step_int((vx-ax+r)*xsp);
<a name="l01328"></a>01328         <span class="keywordflow">if</span>(!xperiodic) {
<a name="l01329"></a>01329                 <span class="keywordflow">if</span>(ai&lt;0) {ai=0;<span class="keywordflow">if</span>(bi&lt;0) bi=0;}
<a name="l01330"></a>01330                 <span class="keywordflow">if</span>(bi&gt;=nx) {bi=nx-1;<span class="keywordflow">if</span>(ai&gt;=nx) ai=nx-1;} 
<a name="l01331"></a>01331         }
<a name="l01332"></a>01332         aj=step_int((vy-ay-r)*ysp);
<a name="l01333"></a>01333         bj=step_int((vy-ay+r)*ysp);
<a name="l01334"></a>01334         <span class="keywordflow">if</span>(!yperiodic) {
<a name="l01335"></a>01335                 <span class="keywordflow">if</span>(aj&lt;0) {aj=0;<span class="keywordflow">if</span>(bj&lt;0) bj=0;}
<a name="l01336"></a>01336                 <span class="keywordflow">if</span>(bj&gt;=ny) {bj=ny-1;<span class="keywordflow">if</span>(aj&gt;=ny) aj=ny-1;} 
<a name="l01337"></a>01337         }
<a name="l01338"></a>01338         ak=step_int((vz-az-r)*zsp);
<a name="l01339"></a>01339         bk=step_int((vz-az+r)*zsp);
<a name="l01340"></a>01340         <span class="keywordflow">if</span>(!zperiodic) {
<a name="l01341"></a>01341                 <span class="keywordflow">if</span>(ak&lt;0) {ak=0;<span class="keywordflow">if</span>(bk&lt;0) bk=0;}
<a name="l01342"></a>01342                 <span class="keywordflow">if</span>(bk&gt;=nz) {bk=nz-1;<span class="keywordflow">if</span>(ak&gt;=nz) ak=nz-1;} 
<a name="l01343"></a>01343         }
<a name="l01344"></a>01344         i=ai;j=aj;k=ak;
<a name="l01345"></a>01345         aip=<a class="code" href="classvoropp__loop.html#1288c1cf43ee443f85ac2b38e77be1e3">ip</a>=step_mod(i,nx);apx=px=step_div(i,nx)*sx;
<a name="l01346"></a>01346         ajp=<a class="code" href="classvoropp__loop.html#0968d506237af30596665901de0b176b">jp</a>=step_mod(j,ny);apy=py=step_div(j,ny)*sy;
<a name="l01347"></a>01347         akp=<a class="code" href="classvoropp__loop.html#53f312a51a6840ee575110fb0dd88875">kp</a>=step_mod(k,nz);apz=pz=step_div(k,nz)*sz;
<a name="l01348"></a>01348         inc1=aip-step_mod(bi,nx);
<a name="l01349"></a>01349         inc2=nx*(ny+ajp-step_mod(bj,ny))+inc1;
<a name="l01350"></a>01350         inc1+=nx;
<a name="l01351"></a>01351         s=aip+nx*(ajp+ny*akp);
<a name="l01352"></a>01352         <span class="keywordflow">return</span> s;
<a name="l01353"></a>01353 }
<a name="l01354"></a>01354 <span class="comment"></span>
<a name="l01355"></a>01355 <span class="comment">/** Initializes a voropp_loop object, by finding all blocks which overlap the box with</span>
<a name="l01356"></a>01356 <span class="comment"> * corners (xmin,ymin,zmin) and (xmax,ymax,zmax). It returns the first block</span>
<a name="l01357"></a>01357 <span class="comment"> * which is to be tested, and sets the periodic displacement vector (px,py,pz)</span>
<a name="l01358"></a>01358 <span class="comment"> * accordingly. */</span>
<a name="l01359"></a><a class="code" href="classvoropp__loop.html#fa5d9509e72e918bc626fdb87f97505c">01359</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classvoropp__loop.html#8d34dfb5dab6412a684e233a6dfbab30">voropp_loop::init</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xmin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xmax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ymin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> ymax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zmin,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> zmax,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;px,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;py,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;pz) {
<a name="l01360"></a>01360         ai=step_int((xmin-ax)*xsp);
<a name="l01361"></a>01361         bi=step_int((xmax-ax)*xsp);
<a name="l01362"></a>01362         <span class="keywordflow">if</span>(!xperiodic) {
<a name="l01363"></a>01363                 <span class="keywordflow">if</span>(ai&lt;0) {ai=0;<span class="keywordflow">if</span>(bi&lt;0) bi=0;}
<a name="l01364"></a>01364                 <span class="keywordflow">if</span>(bi&gt;=nx) {bi=nx-1;<span class="keywordflow">if</span>(ai&gt;=nx) ai=nx-1;} 
<a name="l01365"></a>01365         }
<a name="l01366"></a>01366         aj=step_int((ymin-ay)*ysp);
<a name="l01367"></a>01367         bj=step_int((ymax-ay)*ysp);
<a name="l01368"></a>01368         <span class="keywordflow">if</span>(!yperiodic) {
<a name="l01369"></a>01369                 <span class="keywordflow">if</span>(aj&lt;0) {aj=0;<span class="keywordflow">if</span>(bj&lt;0) bj=0;}
<a name="l01370"></a>01370                 <span class="keywordflow">if</span>(bj&gt;=ny) {bj=ny-1;<span class="keywordflow">if</span>(aj&gt;=ny) aj=ny-1;} 
<a name="l01371"></a>01371         }
<a name="l01372"></a>01372         ak=step_int((zmin-az)*zsp);
<a name="l01373"></a>01373         bk=step_int((zmax-az)*zsp);
<a name="l01374"></a>01374         <span class="keywordflow">if</span>(!zperiodic) {
<a name="l01375"></a>01375                 <span class="keywordflow">if</span>(ak&lt;0) {ak=0;<span class="keywordflow">if</span>(bk&lt;0) bk=0;}
<a name="l01376"></a>01376                 <span class="keywordflow">if</span>(bk&gt;=nz) {bk=nz-1;<span class="keywordflow">if</span>(ak&gt;=nz) ak=nz-1;} 
<a name="l01377"></a>01377         }
<a name="l01378"></a>01378         i=ai;j=aj;k=ak;
<a name="l01379"></a>01379         aip=<a class="code" href="classvoropp__loop.html#1288c1cf43ee443f85ac2b38e77be1e3">ip</a>=step_mod(i,nx);apx=px=step_div(i,nx)*sx;
<a name="l01380"></a>01380         ajp=<a class="code" href="classvoropp__loop.html#0968d506237af30596665901de0b176b">jp</a>=step_mod(j,ny);apy=py=step_div(j,ny)*sy;
<a name="l01381"></a>01381         akp=<a class="code" href="classvoropp__loop.html#53f312a51a6840ee575110fb0dd88875">kp</a>=step_mod(k,nz);apz=pz=step_div(k,nz)*sz;
<a name="l01382"></a>01382         inc1=aip-step_mod(bi,nx);
<a name="l01383"></a>01383         inc2=nx*(ny+ajp-step_mod(bj,ny))+inc1;
<a name="l01384"></a>01384         inc1+=nx;
<a name="l01385"></a>01385         s=aip+nx*(ajp+ny*akp);
<a name="l01386"></a>01386         <span class="keywordflow">return</span> s;
<a name="l01387"></a>01387 }
<a name="l01388"></a>01388 <span class="comment"></span>
<a name="l01389"></a>01389 <span class="comment">/** Returns the next block to be tested in a loop, and updates the periodicity</span>
<a name="l01390"></a>01390 <span class="comment"> * vector if necessary. */</span>
<a name="l01391"></a><a class="code" href="classvoropp__loop.html#3496e46cf243f80b34040652efbd1881">01391</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classvoropp__loop.html#3496e46cf243f80b34040652efbd1881">voropp_loop::inc</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;px,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;py,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;pz) {
<a name="l01392"></a>01392         <span class="keywordflow">if</span>(i&lt;bi) {
<a name="l01393"></a>01393                 i++;
<a name="l01394"></a>01394                 <span class="keywordflow">if</span>(<a class="code" href="classvoropp__loop.html#1288c1cf43ee443f85ac2b38e77be1e3">ip</a>&lt;nx-1) {<a class="code" href="classvoropp__loop.html#1288c1cf43ee443f85ac2b38e77be1e3">ip</a>++;s++;} <span class="keywordflow">else</span> {<a class="code" href="classvoropp__loop.html#1288c1cf43ee443f85ac2b38e77be1e3">ip</a>=0;s+=1-nx;px+=sx;}
<a name="l01395"></a>01395                 <span class="keywordflow">return</span> s;
<a name="l01396"></a>01396         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(j&lt;bj) {
<a name="l01397"></a>01397                 i=ai;<a class="code" href="classvoropp__loop.html#1288c1cf43ee443f85ac2b38e77be1e3">ip</a>=aip;px=apx;j++;
<a name="l01398"></a>01398                 <span class="keywordflow">if</span>(<a class="code" href="classvoropp__loop.html#0968d506237af30596665901de0b176b">jp</a>&lt;ny-1) {<a class="code" href="classvoropp__loop.html#0968d506237af30596665901de0b176b">jp</a>++;s+=inc1;} <span class="keywordflow">else</span> {<a class="code" href="classvoropp__loop.html#0968d506237af30596665901de0b176b">jp</a>=0;s+=inc1-nxy;py+=sy;}
<a name="l01399"></a>01399                 <span class="keywordflow">return</span> s;
<a name="l01400"></a>01400         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(k&lt;bk) {
<a name="l01401"></a>01401                 i=ai;<a class="code" href="classvoropp__loop.html#1288c1cf43ee443f85ac2b38e77be1e3">ip</a>=aip;j=aj;<a class="code" href="classvoropp__loop.html#0968d506237af30596665901de0b176b">jp</a>=ajp;px=apx;py=apy;k++;
<a name="l01402"></a>01402                 <span class="keywordflow">if</span>(<a class="code" href="classvoropp__loop.html#53f312a51a6840ee575110fb0dd88875">kp</a>&lt;nz-1) {<a class="code" href="classvoropp__loop.html#53f312a51a6840ee575110fb0dd88875">kp</a>++;s+=inc2;} <span class="keywordflow">else</span> {<a class="code" href="classvoropp__loop.html#53f312a51a6840ee575110fb0dd88875">kp</a>=0;s+=inc2-nxyz;pz+=sz;}
<a name="l01403"></a>01403                 <span class="keywordflow">return</span> s;
<a name="l01404"></a>01404         } <span class="keywordflow">else</span> <span class="keywordflow">return</span> -1;
<a name="l01405"></a>01405 }
<a name="l01406"></a>01406 <span class="comment"></span>
<a name="l01407"></a>01407 <span class="comment">/** Custom int function, that gives consistent stepping for negative numbers.</span>
<a name="l01408"></a>01408 <span class="comment"> * With normal int, we have (-1.5,-0.5,0.5,1.5) -&gt; (-1,0,0,1).</span>
<a name="l01409"></a>01409 <span class="comment"> * With this routine, we have (-1.5,-0.5,0.5,1.5) -&gt; (-2,-1,0,1).*/</span>
<a name="l01410"></a>01410 <span class="keyword">inline</span> <span class="keywordtype">int</span> voropp_loop::step_int(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> a) {
<a name="l01411"></a>01411         <span class="keywordflow">return</span> a&lt;0?int(a)-1:int(a);
<a name="l01412"></a>01412 }
<a name="l01413"></a>01413 <span class="comment"></span>
<a name="l01414"></a>01414 <span class="comment">/** Custom mod function, that gives consistent stepping for negative numbers. */</span>
<a name="l01415"></a>01415 <span class="keyword">inline</span> <span class="keywordtype">int</span> voropp_loop::step_mod(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b) {
<a name="l01416"></a>01416         <span class="keywordflow">return</span> a&gt;=0?a%b:b-1-(b-1-a)%b;
<a name="l01417"></a>01417 }
<a name="l01418"></a>01418 <span class="comment"></span>
<a name="l01419"></a>01419 <span class="comment">/** Custom div function, that gives consistent stepping for negative numbers. */</span>
<a name="l01420"></a>01420 <span class="keyword">inline</span> <span class="keywordtype">int</span> voropp_loop::step_div(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b) {
<a name="l01421"></a>01421         <span class="keywordflow">return</span> a&gt;=0?a/b:-1+(a+1)/b;
<a name="l01422"></a>01422 }
<a name="l01423"></a>01423 <span class="comment"></span>
<a name="l01424"></a>01424 <span class="comment">/** Adds a wall to the container.</span>
<a name="l01425"></a>01425 <span class="comment"> * \param[in] &amp;w a wall object to be added.*/</span>
<a name="l01426"></a>01426 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l01427"></a><a class="code" href="classcontainer__base.html#649a223ff23b7d558fc9df094aa75bc1">01427</a> <span class="keywordtype">void</span> <a class="code" href="classcontainer__base.html#649a223ff23b7d558fc9df094aa75bc1">container_base&lt;r_option&gt;::add_wall</a>(<a class="code" href="classwall.html" title="Pure virtual class from which wall objects are derived.">wall</a>&amp; w) {
<a name="l01428"></a>01428         <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#c75332981aef14895bd159056252cced">wall_number</a>==<a class="code" href="classcontainer__base.html#71db9f70176ba792178c333d6d63d2dc">current_wall_size</a>) {
<a name="l01429"></a>01429                 <a class="code" href="classcontainer__base.html#71db9f70176ba792178c333d6d63d2dc">current_wall_size</a>*=2;
<a name="l01430"></a>01430                 <span class="keywordflow">if</span>(<a class="code" href="classcontainer__base.html#71db9f70176ba792178c333d6d63d2dc">current_wall_size</a>&gt;<a class="code" href="config_8hh.html#1fb5a1c4a0e817bf76008148369cc357">max_wall_size</a>)
<a name="l01431"></a>01431                         <a class="code" href="cell_8hh.html#f7a063350359805cded84b1e24ded05c" title="Function for printing fatal error messages and exiting.">voropp_fatal_error</a>(<span class="stringliteral">"Wall memory allocation exceeded absolute maximum"</span>,<a class="code" href="config_8hh.html#5dc0616f8a67ae3d1c2ba8a3dcf5612b">VOROPP_MEMORY_ERROR</a>);
<a name="l01432"></a>01432                 <a class="code" href="classwall.html" title="Pure virtual class from which wall objects are derived.">wall</a> **pwall;
<a name="l01433"></a>01433                 pwall=<span class="keyword">new</span> <a class="code" href="classwall.html" title="Pure virtual class from which wall objects are derived.">wall</a>*[<a class="code" href="classcontainer__base.html#71db9f70176ba792178c333d6d63d2dc">current_wall_size</a>];
<a name="l01434"></a>01434                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="classcontainer__base.html#c75332981aef14895bd159056252cced">wall_number</a>;i++) pwall[i]=<a class="code" href="classcontainer__base.html#64783fe54666504bb2a0e504d2f6e9df">walls</a>[i];
<a name="l01435"></a>01435                 <span class="keyword">delete</span> [] <a class="code" href="classcontainer__base.html#64783fe54666504bb2a0e504d2f6e9df">walls</a>;<a class="code" href="classcontainer__base.html#64783fe54666504bb2a0e504d2f6e9df">walls</a>=pwall;            
<a name="l01436"></a>01436         }
<a name="l01437"></a>01437         <a class="code" href="classcontainer__base.html#64783fe54666504bb2a0e504d2f6e9df">walls</a>[<a class="code" href="classcontainer__base.html#c75332981aef14895bd159056252cced">wall_number</a>++]=&amp;w;
<a name="l01438"></a>01438 }
<a name="l01439"></a>01439 <span class="comment"></span>
<a name="l01440"></a>01440 <span class="comment">/** Sets the radius of the jth particle in region i to r, and updates the maximum particle radius.</span>
<a name="l01441"></a>01441 <span class="comment"> * \param[in] i the region of the particle to consider.</span>
<a name="l01442"></a>01442 <span class="comment"> * \param[in] j the number of the particle within the region.</span>
<a name="l01443"></a>01443 <span class="comment"> * \param[in] r the radius to set. */</span>
<a name="l01444"></a><a class="code" href="classradius__poly.html#71ccc6ef2b7884ce8d4b80139b2ce538">01444</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classradius__poly.html#71ccc6ef2b7884ce8d4b80139b2ce538">radius_poly::store_radius</a>(<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> j,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> r) {
<a name="l01445"></a>01445         cc-&gt;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[i][4*j+3]=r;
<a name="l01446"></a>01446         <span class="keywordflow">if</span>(r&gt;max_radius) max_radius=r;
<a name="l01447"></a>01447 }
<a name="l01448"></a>01448 <span class="comment"></span>
<a name="l01449"></a>01449 <span class="comment">/** Clears the stored maximum radius. */</span>
<a name="l01450"></a><a class="code" href="classradius__poly.html#4e0e0b4350b8bcc64dcbe68baaba7fd7">01450</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classradius__poly.html#4e0e0b4350b8bcc64dcbe68baaba7fd7">radius_poly::clear_max</a>() {
<a name="l01451"></a>01451         max_radius=0;
<a name="l01452"></a>01452 }
<a name="l01453"></a>01453 <span class="comment"></span>
<a name="l01454"></a>01454 <span class="comment">/** Imports a list of particles from an input stream for the monodisperse case</span>
<a name="l01455"></a>01455 <span class="comment"> * where no radius information is expected.</span>
<a name="l01456"></a>01456 <span class="comment"> * \param[in] &amp;is an input stream to read from. */</span>
<a name="l01457"></a><a class="code" href="classradius__mono.html#efc65e914ebfa9184f557359d1ed843f">01457</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classradius__mono.html#efc65e914ebfa9184f557359d1ed843f">radius_mono::import</a>(istream &amp;is) {
<a name="l01458"></a>01458         <span class="keywordtype">int</span> n;<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,y,z;
<a name="l01459"></a>01459         is &gt;&gt; n &gt;&gt; x &gt;&gt; y &gt;&gt; z;
<a name="l01460"></a>01460         <span class="keywordflow">while</span>(!is.eof()) {
<a name="l01461"></a>01461                 cc-&gt;<a class="code" href="classcontainer__base.html#8a55d6ba7209869af12daab718a08769">put</a>(n,x,y,z);
<a name="l01462"></a>01462                 is &gt;&gt; n &gt;&gt; x &gt;&gt; y &gt;&gt; z;
<a name="l01463"></a>01463         }
<a name="l01464"></a>01464 }
<a name="l01465"></a>01465 <span class="comment"></span>
<a name="l01466"></a>01466 <span class="comment">/** Imports a list of particles from an input stream for the polydisperse case,</span>
<a name="l01467"></a>01467 <span class="comment"> * where both positions and particle radii are both stored.</span>
<a name="l01468"></a>01468 <span class="comment"> * \param[in] &amp;is an input stream to read from. */</span>
<a name="l01469"></a><a class="code" href="classradius__poly.html#3fe7455f4b4260ba0967d3b167938b29">01469</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classradius__poly.html#3fe7455f4b4260ba0967d3b167938b29">radius_poly::import</a>(istream &amp;is) {
<a name="l01470"></a>01470         <span class="keywordtype">int</span> n;<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> x,y,z,r;
<a name="l01471"></a>01471         is &gt;&gt; n &gt;&gt; x &gt;&gt; y &gt;&gt; z &gt;&gt; r;
<a name="l01472"></a>01472         <span class="keywordflow">while</span>(!is.eof()) {
<a name="l01473"></a>01473                 cc-&gt;<a class="code" href="classcontainer__base.html#8a55d6ba7209869af12daab718a08769">put</a>(n,x,y,z,r);
<a name="l01474"></a>01474                 is &gt;&gt; n &gt;&gt; x &gt;&gt; y &gt;&gt; z &gt;&gt; r;
<a name="l01475"></a>01475         }
<a name="l01476"></a>01476 }
<a name="l01477"></a>01477 <span class="comment"></span>
<a name="l01478"></a>01478 <span class="comment">/** Initializes the radius_poly class for a new Voronoi cell calculation,</span>
<a name="l01479"></a>01479 <span class="comment"> * by computing the radial cut-off value, based on the current particle's</span>
<a name="l01480"></a>01480 <span class="comment"> * radius and the maximum radius of any particle in the packing.</span>
<a name="l01481"></a>01481 <span class="comment"> * \param[in] ijk the region to consider.</span>
<a name="l01482"></a>01482 <span class="comment"> * \param[in] s the number of the particle within the region. */</span>
<a name="l01483"></a><a class="code" href="classradius__poly.html#c73fd1df7f3bceafe6db09d278927958">01483</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classradius__poly.html#c73fd1df7f3bceafe6db09d278927958">radius_poly::init</a>(<span class="keywordtype">int</span> ijk,<span class="keywordtype">int</span> s) {
<a name="l01484"></a>01484         crad=cc-&gt;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][4*s+3];
<a name="l01485"></a>01485         mul=1+(crad*crad-max_radius*max_radius)/((max_radius+crad)*(max_radius+crad));
<a name="l01486"></a>01486         crad*=crad;
<a name="l01487"></a>01487 }
<a name="l01488"></a>01488 <span class="comment"></span>
<a name="l01489"></a>01489 <span class="comment">/** This routine is called when deciding when to terminate the computation</span>
<a name="l01490"></a>01490 <span class="comment"> * of a Voronoi cell. For the Voronoi radical tessellation for a polydisperse</span>
<a name="l01491"></a>01491 <span class="comment"> * case, this routine multiplies the cutoff value by the scaling factor that</span>
<a name="l01492"></a>01492 <span class="comment"> * was precomputed in the init() routine.</span>
<a name="l01493"></a>01493 <span class="comment"> * \param[in] lrs a cutoff radius for the cell computation.</span>
<a name="l01494"></a>01494 <span class="comment"> * \return The value scaled by the factor mul. */</span>
<a name="l01495"></a><a class="code" href="classradius__poly.html#4b85dc351fa0a03a40f0f0ccebb7fb51">01495</a> <span class="keyword">inline</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classradius__poly.html#4b85dc351fa0a03a40f0f0ccebb7fb51">radius_poly::cutoff</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> lrs) {
<a name="l01496"></a>01496         <span class="keywordflow">return</span> mul*lrs;
<a name="l01497"></a>01497 }
<a name="l01498"></a>01498 <span class="comment"></span>
<a name="l01499"></a>01499 <span class="comment">/** This routine is called when deciding when to terminate the computation</span>
<a name="l01500"></a>01500 <span class="comment"> * of a Voronoi cell. For the monodisperse case, this routine just returns</span>
<a name="l01501"></a>01501 <span class="comment"> * the same value that is passed to it.</span>
<a name="l01502"></a>01502 <span class="comment"> * \param[in] lrs a cutoff radius for the cell computation.</span>
<a name="l01503"></a>01503 <span class="comment"> * \return The same value passed to it. */</span>
<a name="l01504"></a><a class="code" href="classradius__mono.html#87906f269d015e7d729174005820b044">01504</a> <span class="keyword">inline</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classradius__mono.html#87906f269d015e7d729174005820b044">radius_mono::cutoff</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> lrs) {
<a name="l01505"></a>01505         <span class="keywordflow">return</span> lrs;
<a name="l01506"></a>01506 }
<a name="l01507"></a>01507 <span class="comment"></span>
<a name="l01508"></a>01508 <span class="comment">/** Prints the radius of particle, by just supplying a generic value of "s".</span>
<a name="l01509"></a>01509 <span class="comment"> * \param[in] &amp;os the output stream to write to.</span>
<a name="l01510"></a>01510 <span class="comment"> * \param[in] l the region to consider.</span>
<a name="l01511"></a>01511 <span class="comment"> * \param[in] c the number of the particle within the region. */</span>
<a name="l01512"></a><a class="code" href="classradius__mono.html#0d1f3a6ba87e3358b0dbe3f3b3073fce">01512</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classradius__mono.html#0d1f3a6ba87e3358b0dbe3f3b3073fce">radius_mono::rad</a>(ostream &amp;os,<span class="keywordtype">int</span> l,<span class="keywordtype">int</span> c) {
<a name="l01513"></a>01513         os &lt;&lt; <span class="stringliteral">"s"</span>;
<a name="l01514"></a>01514 }
<a name="l01515"></a>01515 <span class="comment"></span>
<a name="l01516"></a>01516 <span class="comment">/** Prints the radius of a particle to an open output stream.</span>
<a name="l01517"></a>01517 <span class="comment"> * \param[in] &amp;os the output stream to write to.</span>
<a name="l01518"></a>01518 <span class="comment"> * \param[in] l the region to consider.</span>
<a name="l01519"></a>01519 <span class="comment"> * \param[in] c the number of the particle within the region. */</span>
<a name="l01520"></a><a class="code" href="classradius__poly.html#ef0be694c90979c719ec41475013a1eb">01520</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classradius__poly.html#ef0be694c90979c719ec41475013a1eb">radius_poly::rad</a>(ostream &amp;os,<span class="keywordtype">int</span> l,<span class="keywordtype">int</span> c) {
<a name="l01521"></a>01521         os &lt;&lt; cc-&gt;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[l][4*c+3];
<a name="l01522"></a>01522 }
<a name="l01523"></a>01523 <span class="comment"></span>
<a name="l01524"></a>01524 <span class="comment">/** Returns the scaled volume of a particle, which is always set</span>
<a name="l01525"></a>01525 <span class="comment"> * to 0.125 for the monodisperse case where particles are taken</span>
<a name="l01526"></a>01526 <span class="comment"> * to have unit diameter.</span>
<a name="l01527"></a>01527 <span class="comment"> * \param[in] ijk the region to consider.</span>
<a name="l01528"></a>01528 <span class="comment"> * \param[in] s the number of the particle within the region.</span>
<a name="l01529"></a>01529 <span class="comment"> * \return The cube of the radius of the particle, which is 0.125</span>
<a name="l01530"></a>01530 <span class="comment"> * in this case. */</span>
<a name="l01531"></a><a class="code" href="classradius__mono.html#7e9f406e4a6b77d035f46325e115d810">01531</a> <span class="keyword">inline</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classradius__mono.html#7e9f406e4a6b77d035f46325e115d810">radius_mono::volume</a>(<span class="keywordtype">int</span> ijk,<span class="keywordtype">int</span> s) {
<a name="l01532"></a>01532         <span class="keywordflow">return</span> 0.125;
<a name="l01533"></a>01533 }
<a name="l01534"></a>01534 <span class="comment"></span>
<a name="l01535"></a>01535 <span class="comment">/** Returns the scaled volume of a particle.</span>
<a name="l01536"></a>01536 <span class="comment"> * \param[in] ijk the region to consider.</span>
<a name="l01537"></a>01537 <span class="comment"> * \param[in] s the number of the particle within the region.</span>
<a name="l01538"></a>01538 <span class="comment"> * \return The cube of the radius of the particle. */</span>
<a name="l01539"></a><a class="code" href="classradius__poly.html#b47563afb2b48a60d9a1d39978d7ca51">01539</a> <span class="keyword">inline</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classradius__poly.html#b47563afb2b48a60d9a1d39978d7ca51">radius_poly::volume</a>(<span class="keywordtype">int</span> ijk,<span class="keywordtype">int</span> s) {
<a name="l01540"></a>01540         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> a=cc-&gt;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][4*s+3];
<a name="l01541"></a>01541         <span class="keywordflow">return</span> a*a*a;
<a name="l01542"></a>01542 }
<a name="l01543"></a>01543 <span class="comment"></span>
<a name="l01544"></a>01544 <span class="comment">/** Scales the position of a plane according to the relative sizes</span>
<a name="l01545"></a>01545 <span class="comment"> * of the particle radii.</span>
<a name="l01546"></a>01546 <span class="comment"> * \param[in] rs the distance between the Voronoi cell and the cutting plane.</span>
<a name="l01547"></a>01547 <span class="comment"> * \param[in] t the region to consider</span>
<a name="l01548"></a>01548 <span class="comment"> * \param[in] q the number of the particle within the region.</span>
<a name="l01549"></a>01549 <span class="comment"> * \return The scaled position. */</span>
<a name="l01550"></a><a class="code" href="classradius__poly.html#38804884a0d80d434891c242ab4457ec">01550</a> <span class="keyword">inline</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classradius__poly.html#38804884a0d80d434891c242ab4457ec">radius_poly::scale</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> rs,<span class="keywordtype">int</span> t,<span class="keywordtype">int</span> q) {
<a name="l01551"></a>01551         <span class="keywordflow">return</span> rs+crad-cc-&gt;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[t][4*q+3]*cc-&gt;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[t][4*q+3];
<a name="l01552"></a>01552 }
<a name="l01553"></a>01553 <span class="comment"></span>
<a name="l01554"></a>01554 <span class="comment">/** Applies a blank scaling to the position of a cutting plane.</span>
<a name="l01555"></a>01555 <span class="comment"> * \param[in] rs the distance between the Voronoi cell and the cutting plane.</span>
<a name="l01556"></a>01556 <span class="comment"> * \param[in] t the region to consider</span>
<a name="l01557"></a>01557 <span class="comment"> * \param[in] q the number of the particle within the region.</span>
<a name="l01558"></a>01558 <span class="comment"> * \return The scaled position, which for this case, is equal to rs. */</span>
<a name="l01559"></a><a class="code" href="classradius__mono.html#5dfe21b99c3902381af19c4b770302d7">01559</a> <span class="keyword">inline</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> <a class="code" href="classradius__mono.html#5dfe21b99c3902381af19c4b770302d7">radius_mono::scale</a>(<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> rs,<span class="keywordtype">int</span> t,<span class="keywordtype">int</span> q) {
<a name="l01560"></a>01560         <span class="keywordflow">return</span> rs;
<a name="l01561"></a>01561 }
<a name="l01562"></a>01562 <span class="comment"></span>
<a name="l01563"></a>01563 <span class="comment">/** Prints the radius of a particle to an open file stream.</span>
<a name="l01564"></a>01564 <span class="comment"> * \param[in] &amp;os an open file stream.</span>
<a name="l01565"></a>01565 <span class="comment"> * \param[in] ijk the region to consider.</span>
<a name="l01566"></a>01566 <span class="comment"> * \param[in] q the number of the particle within the region. */</span>
<a name="l01567"></a><a class="code" href="classradius__poly.html#fd6058cce05f7066a838ebc4e404f66b">01567</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classradius__poly.html#fd6058cce05f7066a838ebc4e404f66b">radius_poly::print</a>(ostream &amp;os,<span class="keywordtype">int</span> ijk,<span class="keywordtype">int</span> q) {
<a name="l01568"></a>01568         os &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; cc-&gt;<a class="code" href="classcontainer__base.html#b4654676b836634c2dc0dbc9001d010b">p</a>[ijk][4*q+3];
<a name="l01569"></a>01569 }
<a name="l01570"></a>01570 <span class="comment"></span>
<a name="l01571"></a>01571 <span class="comment">/** This routine checks to see whether a point is within a particular distance</span>
<a name="l01572"></a>01572 <span class="comment"> * of a nearby region. If the point is within the distance of the region, then</span>
<a name="l01573"></a>01573 <span class="comment"> * the routine returns true, and computes the maximum distance from the point</span>
<a name="l01574"></a>01574 <span class="comment"> * to the region. Otherwise, the routine returns false.</span>
<a name="l01575"></a>01575 <span class="comment"> * \param[in] (di,dj,dk) The position of the nearby region to be tested,</span>
<a name="l01576"></a>01576 <span class="comment"> * relative to the region that the point is in. </span>
<a name="l01577"></a>01577 <span class="comment"> * \param[in] (fx,fy,fz) The displacement of the point within its region.</span>
<a name="l01578"></a>01578 <span class="comment"> * \param[in] (gxs,gys,gzs) The minimum squared distances from the point to the</span>
<a name="l01579"></a>01579 <span class="comment"> * sides of its region.</span>
<a name="l01580"></a>01580 <span class="comment"> * \param[in] &amp;crs A reference in which to return the maximum distance to the</span>
<a name="l01581"></a>01581 <span class="comment"> * region (only computed if the routine returns positive).</span>
<a name="l01582"></a>01582 <span class="comment"> * \param[in] mrs The distance to be tested.</span>
<a name="l01583"></a>01583 <span class="comment"> * \return False if the region is further away than mrs, true if the region in within mrs.*/</span>
<a name="l01584"></a>01584 <span class="keyword">template</span>&lt;<span class="keyword">class</span> r_option&gt;
<a name="l01585"></a>01585 <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classcontainer__base.html" title="A class representing the whole simulation region.">container_base&lt;r_option&gt;::compute_min_max_radius</a>(<span class="keywordtype">int</span> di,<span class="keywordtype">int</span> dj,<span class="keywordtype">int</span> dk,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> fx,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> fy,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> fz,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> gxs,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> gys,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> gzs,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> &amp;crs,<a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> mrs) {
<a name="l01586"></a>01586         <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> xlo,ylo,zlo;
<a name="l01587"></a>01587         <span class="keyword">const</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> boxx=(bx-ax)/nx,boxy=(by-ay)/ny,boxz=(bz-az)/nz;
<a name="l01588"></a>01588         <span class="keyword">const</span> <a class="code" href="config_8hh.html#4c955c75e3ddea6e5dad265b52103a0b">fpoint</a> bxsq=boxx*boxx+boxy*boxy+boxz*boxz;
<a name="l01589"></a>01589         <span class="keywordflow">if</span>(di&gt;0) {
<a name="l01590"></a>01590                 xlo=di*boxx-fx;
<a name="l01591"></a>01591                 crs=xlo*xlo;
<a name="l01592"></a>01592                 <span class="keywordflow">if</span>(dj&gt;0) {
<a name="l01593"></a>01593                         ylo=dj*boxy-fy;
<a name="l01594"></a>01594                         crs+=ylo*ylo;
<a name="l01595"></a>01595                         <span class="keywordflow">if</span>(dk&gt;0) {
<a name="l01596"></a>01596                                 zlo=dk*boxz-fz;
<a name="l01597"></a>01597                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01598"></a>01598                                 crs+=bxsq+2*(boxx*xlo+boxy*ylo+boxz*zlo);
<a name="l01599"></a>01599                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;0) {
<a name="l01600"></a>01600                                 zlo=(dk+1)*boxz-fz;
<a name="l01601"></a>01601                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01602"></a>01602                                 crs+=bxsq+2*(boxx*xlo+boxy*ylo-boxz*zlo);
<a name="l01603"></a>01603                         } <span class="keywordflow">else</span> {
<a name="l01604"></a>01604                                 <span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01605"></a>01605                                 crs+=boxx*(2*xlo+boxx)+boxy*(2*ylo+boxy)+gzs;
<a name="l01606"></a>01606                         }
<a name="l01607"></a>01607                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dj&lt;0) {
<a name="l01608"></a>01608                         ylo=(dj+1)*boxy-fy;
<a name="l01609"></a>01609                         crs+=ylo*ylo;
<a name="l01610"></a>01610                         <span class="keywordflow">if</span>(dk&gt;0) {
<a name="l01611"></a>01611                                 zlo=dk*boxz-fz;
<a name="l01612"></a>01612                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01613"></a>01613                                 crs+=bxsq+2*(boxx*xlo-boxy*ylo+boxz*zlo);
<a name="l01614"></a>01614                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;0) {
<a name="l01615"></a>01615                                 zlo=(dk+1)*boxz-fz;
<a name="l01616"></a>01616                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01617"></a>01617                                 crs+=bxsq+2*(boxx*xlo-boxy*ylo-boxz*zlo);
<a name="l01618"></a>01618                         } <span class="keywordflow">else</span> {
<a name="l01619"></a>01619                                 <span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01620"></a>01620                                 crs+=boxx*(2*xlo+boxx)+boxy*(-2*ylo+boxy)+gzs;
<a name="l01621"></a>01621                         }
<a name="l01622"></a>01622                 } <span class="keywordflow">else</span> {
<a name="l01623"></a>01623                         <span class="keywordflow">if</span>(dk&gt;0) {
<a name="l01624"></a>01624                                 zlo=dk*boxz-fz;
<a name="l01625"></a>01625                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01626"></a>01626                                 crs+=boxz*(2*zlo+boxz);
<a name="l01627"></a>01627                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;0) {
<a name="l01628"></a>01628                                 zlo=(dk+1)*boxz-fz;
<a name="l01629"></a>01629                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01630"></a>01630                                 crs+=boxz*(-2*zlo+boxz);
<a name="l01631"></a>01631                         } <span class="keywordflow">else</span> {
<a name="l01632"></a>01632                                 <span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01633"></a>01633                                 crs+=gzs;
<a name="l01634"></a>01634                         }
<a name="l01635"></a>01635                         crs+=gys+boxx*(2*xlo+boxx);
<a name="l01636"></a>01636                 }
<a name="l01637"></a>01637         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(di&lt;0) {
<a name="l01638"></a>01638                 xlo=(di+1)*boxx-fx;
<a name="l01639"></a>01639                 crs=xlo*xlo;
<a name="l01640"></a>01640                 <span class="keywordflow">if</span>(dj&gt;0) {
<a name="l01641"></a>01641                         ylo=dj*boxy-fy;
<a name="l01642"></a>01642                         crs+=ylo*ylo;
<a name="l01643"></a>01643                         <span class="keywordflow">if</span>(dk&gt;0) {
<a name="l01644"></a>01644                                 zlo=dk*boxz-fz;
<a name="l01645"></a>01645                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01646"></a>01646                                 crs+=bxsq+2*(-boxx*xlo+boxy*ylo+boxz*zlo);
<a name="l01647"></a>01647                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;0) {
<a name="l01648"></a>01648                                 zlo=(dk+1)*boxz-fz;
<a name="l01649"></a>01649                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01650"></a>01650                                 crs+=bxsq+2*(-boxx*xlo+boxy*ylo-boxz*zlo);
<a name="l01651"></a>01651                         } <span class="keywordflow">else</span> {
<a name="l01652"></a>01652                                 <span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01653"></a>01653                                 crs+=boxx*(-2*xlo+boxx)+boxy*(2*ylo+boxy)+gzs;
<a name="l01654"></a>01654                         }
<a name="l01655"></a>01655                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dj&lt;0) {
<a name="l01656"></a>01656                         ylo=(dj+1)*boxy-fy;
<a name="l01657"></a>01657                         crs+=ylo*ylo;
<a name="l01658"></a>01658                         <span class="keywordflow">if</span>(dk&gt;0) {
<a name="l01659"></a>01659                                 zlo=dk*boxz-fz;
<a name="l01660"></a>01660                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01661"></a>01661                                 crs+=bxsq+2*(-boxx*xlo-boxy*ylo+boxz*zlo);
<a name="l01662"></a>01662                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;0) {
<a name="l01663"></a>01663                                 zlo=(dk+1)*boxz-fz;
<a name="l01664"></a>01664                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01665"></a>01665                                 crs+=bxsq+2*(-boxx*xlo-boxy*ylo-boxz*zlo);
<a name="l01666"></a>01666                         } <span class="keywordflow">else</span> {
<a name="l01667"></a>01667                                 <span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01668"></a>01668                                 crs+=boxx*(-2*xlo+boxx)+boxy*(-2*ylo+boxy)+gzs;
<a name="l01669"></a>01669                         }
<a name="l01670"></a>01670                 } <span class="keywordflow">else</span> {
<a name="l01671"></a>01671                         <span class="keywordflow">if</span>(dk&gt;0) {
<a name="l01672"></a>01672                                 zlo=dk*boxz-fz;
<a name="l01673"></a>01673                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01674"></a>01674                                 crs+=boxz*(2*zlo+boxz);
<a name="l01675"></a>01675                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;0) {
<a name="l01676"></a>01676                                 zlo=(dk+1)*boxz-fz;
<a name="l01677"></a>01677                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01678"></a>01678                                 crs+=boxz*(-2*zlo+boxz);
<a name="l01679"></a>01679                         } <span class="keywordflow">else</span> {
<a name="l01680"></a>01680                                 <span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01681"></a>01681                                 crs+=gzs;
<a name="l01682"></a>01682                         }
<a name="l01683"></a>01683                         crs+=gys+boxx*(-2*xlo+boxx);
<a name="l01684"></a>01684                 }
<a name="l01685"></a>01685         } <span class="keywordflow">else</span> {
<a name="l01686"></a>01686                 <span class="keywordflow">if</span>(dj&gt;0) {
<a name="l01687"></a>01687                         ylo=dj*boxy-fy;
<a name="l01688"></a>01688                         crs=ylo*ylo;
<a name="l01689"></a>01689                         <span class="keywordflow">if</span>(dk&gt;0) {
<a name="l01690"></a>01690                                 zlo=dk*boxz-fz;
<a name="l01691"></a>01691                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01692"></a>01692                                 crs+=boxz*(2*zlo+boxz);
<a name="l01693"></a>01693                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;0) {
<a name="l01694"></a>01694                                 zlo=(dk+1)*boxz-fz;
<a name="l01695"></a>01695                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01696"></a>01696                                 crs+=boxz*(-2*zlo+boxz);
<a name="l01697"></a>01697                         } <span class="keywordflow">else</span> {
<a name="l01698"></a>01698                                 <span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01699"></a>01699                                 crs+=gzs;
<a name="l01700"></a>01700                         }
<a name="l01701"></a>01701                         crs+=boxy*(2*ylo+boxy);
<a name="l01702"></a>01702                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dj&lt;0) {
<a name="l01703"></a>01703                         ylo=(dj+1)*boxy-fy;
<a name="l01704"></a>01704                         crs=ylo*ylo;
<a name="l01705"></a>01705                         <span class="keywordflow">if</span>(dk&gt;0) {
<a name="l01706"></a>01706                                 zlo=dk*boxz-fz;
<a name="l01707"></a>01707                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01708"></a>01708                                 crs+=boxz*(2*zlo+boxz);
<a name="l01709"></a>01709                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;0) {
<a name="l01710"></a>01710                                 zlo=(dk+1)*boxz-fz;
<a name="l01711"></a>01711                                 crs+=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01712"></a>01712                                 crs+=boxz*(-2*zlo+boxz);
<a name="l01713"></a>01713                         } <span class="keywordflow">else</span> {
<a name="l01714"></a>01714                                 <span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01715"></a>01715                                 crs+=gzs;
<a name="l01716"></a>01716                         }
<a name="l01717"></a>01717                         crs+=boxy*(-2*ylo+boxy);
<a name="l01718"></a>01718                 } <span class="keywordflow">else</span> {
<a name="l01719"></a>01719                         <span class="keywordflow">if</span>(dk&gt;0) {
<a name="l01720"></a>01720                                 zlo=dk*boxz-fz;crs=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01721"></a>01721                                 crs+=boxz*(2*zlo+boxz);
<a name="l01722"></a>01722                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dk&lt;0) {
<a name="l01723"></a>01723                                 zlo=(dk+1)*boxz-fz;crs=zlo*zlo;<span class="keywordflow">if</span>(radius.cutoff(crs)&gt;mrs) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01724"></a>01724                                 crs+=boxz*(-2*zlo+boxz);
<a name="l01725"></a>01725                         } <span class="keywordflow">else</span> {
<a name="l01726"></a>01726                                 crs=0;
<a name="l01727"></a>01727                                 cout &lt;&lt; <span class="stringliteral">"Can't happen ... happened\n"</span>;
<a name="l01728"></a>01728                         }
<a name="l01729"></a>01729                         crs+=gys;
<a name="l01730"></a>01730                 }
<a name="l01731"></a>01731                 crs+=gxs;
<a name="l01732"></a>01732         }
<a name="l01733"></a>01733         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01734"></a>01734 }
<a name="l01735"></a>01735 
<a name="l01736"></a>01736 <span class="preprocessor">#include "<a class="code" href="worklist_8cc.html" title="The table of block worklists that are used during the cell computation.">worklist.cc</a>"</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Mar 23 16:52:34 2009 for Voro++ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
